"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4788],{64788:function(e,t,o){o.d(t,{b:function(){return eh}});var r=o(71576),n=o(34491),i=o(66084),a=o(52921);class s extends n.PN{onViewCreate(){let e=this.props.duration||0;this.timer=setInterval(()=>{let e=Math.round(Math.random()*(this.progress>85?.6:1.5)),t=this.progress+e;if(t>99){this.progress=99,this.timer&&(clearInterval(this.timer),this.timer=null);return}this.progress=t},Math.round(1e3*e/100))}onViewDestroy(){this.timer&&(clearInterval(this.timer),this.timer=null)}constructor(...e){super(...e),(0,i._)(this,"props",void 0),(0,i._)(this,"progress",0),(0,i._)(this,"timer",null)}}(0,a.gn)([n.SB],s.prototype,"progress",void 0);let l=n._Y.createComponent("AgentStatusProgress",s,e=>e.props.duration?(0,r.jsxs)("span",{className:"agent-status-progress--VIA5l",children:["\xa0(",e.progress,"%)"]}):null);var c=o(46731),m=o(33381),d=o(5404),h=o(53040),p=o(92235),u=o(78716),g=o.n(u);class y extends n.PN{onViewCreate(){}onViewDestroy(){}constructor(...e){super(...e),(0,i._)(this,"props",void 0),(0,i._)(this,"showToolbar",!1)}}(0,a.gn)([n.SB],y.prototype,"showToolbar",void 0);let C=n._Y.createComponent("DrawImgResult",y,e=>{var t,o,n,i,a;let{className:s,status:l,chatController:c,useInAction:m}=e.props,u=null===(o=l.metadata)||void 0===o?void 0:null===(t=o.imageSize)||void 0===t?void 0:t.split("x"),y=(null==u?void 0:u[0])?Number.parseInt(null==u?void 0:u[0])/2:324,C=(null==u?void 0:u[1])?Number.parseInt(null==u?void 0:u[1])/2:324;if(y>324||C>450){let e=324/y,t=450/C;e<t?(y=324,C*=e):(C=450,y*=t)}y=Math.min(y,324),C=Math.min(C,450);let v=(null===(n=l.metadata)||void 0===n?void 0:n.thumbnailImageUrl)||(null===(i=l.metadata)||void 0===i?void 0:i.imageUrl),x=c.forSharePreview;return(0,r.jsx)("div",{className:s,onMouseEnter:()=>{x||(e.showToolbar=!0)},onMouseLeave:()=>{e.showToolbar=!1},style:{width:x||m?"auto":"max-content"},children:(0,r.jsxs)("div",{className:"ai-draw-img--GZU8C",style:{width:m?"100%":"unset"},children:[(0,r.jsx)(h.E,{className:g()("ai-draw-img-result--Cfiz6"),skeleton:!0,src:v,style:x||m?{maxWidth:"100%"}:{height:C,width:y},previewUrl:null===(a=l.metadata)||void 0===a?void 0:a.imageUrl,allowPreview:!0}),e.showToolbar&&(0,r.jsx)(d.f,{allowEdit:!0,allowSaveToMemo:!0,imageUrl:v,allowQuote:!m,onDownload:()=>{var e;p.m.downloadFile((null===(e=l.metadata)||void 0===e?void 0:e.imageUrl)||"")},onSetQuote:()=>{c.setQuote({imgUrl:v})}})]})})});var v=o(44469),x=o(95782),S=o(51018),w=o(88882),j=o(56607),f=o(69662),N=o.n(f),M=o(42357),b=o(73047),T=o(62499),k=o(75087),D=o(3379),A=o(39936),_=o(37013),I=o(63623),V=o(40658),F=o(67061),B=o(919),L=o(44016),U=o(23701),z=o(5058),P=o(73296),E=o(98560),R=o(68104),W=o(27534),O=o(48023),Y=o(82005),Z={dataAnalysisDialog:"data-analysis-dialog--fatAZ",title:"title--ORw45",codeArea:"code-area--yHNSF",codeHeader:"code-header--c4oD5",lang:"lang--ug0h5",action:"action--OP2sD",codeCont:"code-cont--Wd6RQ",codeEnhanceBox:"code-enhance-box--ee8aR",codeFooter:"code-footer--lOEZX",stdText:"std-text--gcdUq",stdOut:"std-out--OJrI4",stdErr:"std-err--Nmy0q",icon:"icon--t1Dx0",tipText:"tip-text--eNYDr"},H=o(15851),G=o(11502);class J extends n.PN{get S(){return w.S.Global.components.ChatComponents.ChatMessage.ChatReply.DataAnalysisDialog}get codeText(){try{var e;return(null===(e=JSON.parse(this.props.sourceCode||""))||void 0===e?void 0:e.code)||""}catch(e){return""}}get sourceCodeText(){var e;return e=this.codeText,"````".concat("python","\n").concat(e,"\n````\n")}onViewCreate(){this.reportShow()}onViewDestroy(){}handleDownload(){if(this.downloaded)return;let e="code.py",t=new File([this.codeText],e,{type:"text/plain"}),o=URL.createObjectURL(t);this.downloaded=!0,p.m.downloadFile(o,e),H.M.success(this.S.downloaded,"mainWindow"),setTimeout(()=>{this.downloaded=!1},5e3)}handleCopy(){this.copied||(p.m.copyToClipboard(this.codeText),this.copied=!0,H.M.success(this.S.copied,"mainWindow"),setTimeout(()=>{this.copied=!1},5e3))}reportShow(){G.M.createUserBehaviorEvent({eventName:"data_analysis_dialog_show"})}reportClick(e){G.M.createUserBehaviorEvent({eventName:"data_analysis_dialog_click",extData:{button:e}})}constructor(...e){super(...e),(0,i._)(this,"props",void 0),(0,i._)(this,"copied",!1),(0,i._)(this,"downloaded",!1)}}(0,a.gn)([n.SB],J.prototype,"copied",void 0),(0,a.gn)([n.SB],J.prototype,"downloaded",void 0),(0,a.gn)([n.Fl],J.prototype,"S",null),(0,a.gn)([n.Fl],J.prototype,"codeText",null),(0,a.gn)([n.Fl],J.prototype,"sourceCodeText",null);let q=n._Y.createComponent("DataAnalysisDialog",J,e=>{let{stdOut:t,stdErr:o}=e.props,n=!!(t||o);return(0,r.jsxs)(R.u,{className:Z.dataAnalysisDialog,onDispose:e.props.onDisposed,style:{width:"fit-content",maxWidth:"80%",minWidth:388},closeOffset:20,children:[(0,r.jsx)("div",{className:Z.title,children:e.S.title}),(0,r.jsxs)("div",{className:Z.codeArea,children:[(0,r.jsxs)("div",{className:Z.codeHeader,children:[(0,r.jsx)("span",{className:Z.lang,children:"python"}),(0,r.jsxs)("div",{className:Z.action,children:[(0,r.jsx)(W.h,{iconName:e.downloaded?"check":"desktopDownload",iconSize:14,color:e.downloaded?"var(--theme-function-success)":"currentColor",title:e.downloaded?e.S.downloaded:e.S.download,onClick:()=>{e.reportClick("download"),e.handleDownload()}}),(0,r.jsx)(W.h,{iconName:e.copied?"check":"a70",iconSize:14,color:e.copied?"var(--theme-function-success)":"currentColor",title:e.copied?e.S.copied:e.S.copy,onClick:()=>{e.reportClick("copy"),e.handleCopy()}})]})]}),(0,r.jsx)("div",{className:Z.codeCont,children:(0,r.jsx)(I.U,{codeEnhanceClassName:Z.codeEnhanceBox,children:e.sourceCodeText})}),n&&(0,r.jsxs)("div",{className:Z.codeFooter,children:[!!t&&(0,r.jsxs)("div",{className:Z.stdOut,children:[(0,r.jsx)("label",{className:Z.label,children:e.S.result}),(0,r.jsx)(Q,{text:t})]}),!!o&&(0,r.jsxs)("div",{className:Z.stdErr,children:[(0,r.jsx)(c.J,{className:Z.icon,name:"exclamation",size:14,color:"var(--theme-function-error)"}),(0,r.jsx)(Q,{text:o})]})]})]})]})}),Q=(0,T.Pi)(e=>{let{text:t}=e;return(0,r.jsx)(O.u,{overlayClassName:Z.tipText,title:t||"",children:(0,r.jsx)("div",{className:Z.stdText,children:t})})}),X=Y.t.createOpener(q);var K=o(40485),$={skillDebug:"skill-debug--OZd7I",title:"title--bQBCz",icon:"icon--MbTij",expand:"expand--h2Ian",content:"content--Exq2B",badge:"badge--ukkh9",dataAnalysis:"data-analysis--Zdsg3",headerCont:"header-cont--SWmDD",sourceCode:"source-code--JB3gI",imageBox:"image-box--aQ2px",thinkingDetails:"thinking-details--aAlvx",thinkingDetailSummary:"thinking-detail-summary--rp7Hl",thinkingDetailLabel:"thinking-detail-label--zWArp",markdownTitle:"markdown-title--Ubq6X",arrowDownIcon:"arrow-down-icon--JchIH",summaryText:"summary-text--jraqA",thinkingDetail:"thinking-detail--acD7n",thinkingDetailText:"thinking-detail-text--MbDgf",aiForm:"ai-form--gpMxE",aiFormLabel:"ai-form-label--crYoY",aiFormContainer:"ai-form-container--msrNJ",aiFormContent:"ai-form-content--rkhU3",aiFormInfo:"ai-form-info--e1Bbi",aiFormTitle:"ai-form-title--p5vMB",aiFormDescription:"ai-form-description--xpd9k"};class ee extends n.PN{get S(){return w.S.Global.modules.ChatBox}onViewCreate(){}onViewDestroy(){}calcAgentStatus(){if(!this.props.replyData.agentStatus)return{finallyAgentStatus:[],thinkingDetails:[],dataAnalysisStatus:[]};let e=[];for(let l=0;l<this.props.replyData.agentStatus.length;l++){let c=this.props.replyData.agentStatus[l];if(c.uid){let l=e.findIndex(e=>e.uid===c.uid);if(l>-1){let m=(0,b.ZN)(e.find(e=>e.uid===c.uid));if(m&&"thinking_detail_stream"===m.type){var t,o,r,n,i,a,s;m.metadata||(m.metadata={}),(null===(t=c.metadata)||void 0===t?void 0:t.title)&&(m.metadata.title=(m.metadata.title||"")+c.metadata.title),(null===(o=c.metadata)||void 0===o?void 0:o.description)&&(m.metadata.description=(m.metadata.description||"")+(null===(i=c.metadata)||void 0===i?void 0:i.description)),(null===(r=c.metadata)||void 0===r?void 0:r.reasoningDetail)&&(m.metadata.reasoningDetail=(m.metadata.reasoningDetail||"")+(null===(a=c.metadata)||void 0===a?void 0:a.reasoningDetail)),(null===(n=c.metadata)||void 0===n?void 0:n.reasoningReflection)&&(m.metadata.reasoningReflection=(m.metadata.reasoningReflection||"")+(null===(s=c.metadata)||void 0===s?void 0:s.reasoningReflection)),e[l]=m}else e[l]=c}else e.push(c)}else e.push(c)}return{finallyAgentStatus:e.filter(e=>"thinking_detail_stream"!==e.type&&"code_interpreter"!==e.type),thinkingDetails:e.filter(e=>"thinking_detail_stream"===e.type),dataAnalysisStatus:e.filter(e=>"code_interpreter"===e.type),thinking:e.find(e=>"thinking"===e.type),aiForm:e.findLast(e=>"ai_form"===e.type||"text_status"===e.type&&"Call: survey"===e.text)}}getExpandThinkingDetail(e){let t=new Set;return e.forEach(e=>{t.add(e.uid)}),Object.keys(this.manualHandleThinkingDetail).forEach(e=>{"fold"===this.manualHandleThinkingDetail[e]?t.delete(e):t.add(e)}),t}constructor(...e){super(...e),(0,i._)(this,"props",void 0),(0,i._)(this,"mindMapDataUpdater",void 0),(0,i._)(this,"lastDetailId",""),(0,i._)(this,"manualHandleThinkingDetail",{})}}(0,a.gn)([n.SB],ee.prototype,"manualHandleThinkingDetail",void 0),(0,a.gn)([b.Fl],ee.prototype,"S",null);var et=o(29921),eo=o(24630),er=o(75372),en=o(38172);class ei extends n.PN{get S(){return w.S.Global.components.ChatComponents.ChatMessage.ChatReply.AgentStatus.MemoryAgentStatus}handleOpenManageMemoryDrawer(){en.W.createUserBehaviorEvent({eventName:"agentstatus_click",source:"memory"}),(0,z.B)({chatController:this.props.chatBotController,insertTarget:"mainWindow",defaultTab:"manageMemory"}),this.open=!1}onViewCreate(){}onViewDestroy(){}constructor(...e){super(...e),(0,i._)(this,"props",void 0),(0,i._)(this,"open",!1)}}(0,a.gn)([n.SB],ei.prototype,"open",void 0),(0,a.gn)([b.Fl],ei.prototype,"S",null);let ea=n._Y.createComponent("MemoryAgentStatus",ei,e=>{let{children:t,summary:o}=e.props;return o?(0,r.jsx)("div",{className:"memory-agent-status--BbljH",children:(0,r.jsx)(er.x,{open:e.open,onOpenChange:t=>{e.open=t},trigger:["hover","click"],placement:"bottomLeft",content:(0,r.jsx)(es,{vm:e,summary:o}),children:(0,r.jsx)(E.r,{iconName:"a41",iconColor:"var(--theme-icon-brand)",iconSize:16,className:"content--wKz86",children:t})})}):null}),es=(0,T.Pi)(function(e){let{vm:t,summary:o}=e;return(0,r.jsxs)("div",{className:"memory-content--OSlsO",children:[(0,r.jsx)("div",{className:"memory-content-summary--CXw1H",children:(0,r.jsx)(I.U,{children:o})}),(0,r.jsxs)("div",{className:"manage-memory--uBosp",onClick:()=>{t.handleOpenManageMemoryDrawer()},children:[(0,r.jsxs)("div",{className:"manage-memory-left--ZyJ1b",children:[(0,r.jsx)(et.O,{size:16,color:"var(--theme-icon-primary)"}),(0,r.jsx)("span",{children:t.S.manageMemory})]}),(0,r.jsx)(eo.X,{size:16,color:"var(--theme-icon-tertiary)"})]})]})});var el={thinkWrapper:"think-wrapper--XYawu",thinkText:"think-text--Nygkw",thinkDesc:"think-desc--Gojqf"};let ec={};class em extends n.PN{get S(){return w.S.Global.modules.ChatBox}onViewCreate(){this.initDuration()}onViewDestroy(){this.clearDuration()}initDuration(){this.props.itemId&&(this.duration=ec[this.props.itemId]||0,this.props.hasContent||(this.clearDuration(),this.durationTimer=setInterval(()=>{if(this.props.hasContent){this.clearDuration();return}this.duration+=1},1e3)))}clearDuration(){this.durationTimer&&clearInterval(this.durationTimer),this.durationTimer=null}constructor(...e){super(...e),(0,i._)(this,"props",void 0),(0,i._)(this,"duration",0),(0,i._)(this,"durationTimer",null)}}(0,a.gn)([n.SB],em.prototype,"duration",void 0),(0,a.gn)([n.Fl],em.prototype,"S",null);let ed=n._Y.createComponent("ThinkAgentStatus",em,e=>{var t;let{agentStatus:o,hideThinkingTooLong:n}=e.props,i=(null===(t=o.metadata)||void 0===t?void 0:t.thinkingTime)||e.duration;return(0,r.jsxs)("div",{className:el.thinkWrapper,children:[(0,r.jsx)("span",{className:el.thinkText,children:(0,w.x)(e.S.thinkFor,{time:i})}),i>=10&&!e.props.hasContent&&!n&&(0,r.jsxs)("span",{className:g()(el.thinkDesc,el.thinkText),children:[(0,r.jsx)(c.J,{color:"currentColor",name:"info-pure",size:16}),e.S.thinkForDesc]})]})}),eh=n._Y.createComponent("AgentStatus",ee,e=>{var t,o,n;let{replyData:i,chatBotController:a,isLoading:s,parentQuestion:c,useInAction:d}=e.props;if(!i.agentStatus)return null;let h=!!i.content,{finallyAgentStatus:u,dataAnalysisStatus:y,thinkingDetails:v,aiForm:j}=e.calcAgentStatus(),f=e.getExpandThinkingDetail(v);if(j)return(0,r.jsx)(ey,{vm:e,text:j.text});let N=null===(n=i.agentStatus)||void 0===n?void 0:null===(o=n.find(e=>"refer_links"===e.type))||void 0===o?void 0:null===(t=o.metadata)||void 0===t?void 0:t.citations;return(0,r.jsxs)(r.Fragment,{children:[u.map((t,o)=>{var n,g,y,j,f,N,M,b,T,_;let I=null===(n=t.icon)||void 0===n?void 0:n.iconName,V=null===(g=t.icon)||void 0===g?void 0:g.url,F=(null===(j=t.progress)||void 0===j?void 0:null===(y=j.currentStage)||void 0===y?void 0:y.expectedDuration)||0,B=o===u.length-1,U=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.Z,{S:t.text,components:{b:e=>(0,r.jsx)("b",{children:e})}}),B&&!h&&s&&(0,r.jsx)(l,{duration:F},null===(f=i.agentStatus)||void 0===f?void 0:f.length)]}),P=null===(N=t.metadata)||void 0===N?void 0:N.eventType;if("mind_map"===t.type){let n=i.type;return"read_enhance"===i.type?n=L.$.UserEventSource.WebSummary:(null==c?void 0:c.data.type)==="file_with_text"&&(n=L.$.UserEventSource.ReadSummary),(0,r.jsx)(eu,{vm:e,replyData:i,status:t,source:n},t.type+o)}if("ai_form"===t.type){let n=null;try{n=S.c.parsePartialJson(t.text||"")}catch(e){}return n?(0,r.jsx)("div",{className:$.aiFormContainer,onClick:()=>{window.open("".concat(p.m.genWebAIFormUrl(null==n?void 0:n.uid),"&source=chat"),"_blank","noopener noreferrer")},children:(0,r.jsxs)("div",{className:$.aiFormContent,children:[(0,r.jsx)("div",{children:(0,r.jsx)(D.i,{className:$.aiFormIcon,size:36})}),(0,r.jsxs)("div",{className:$.aiFormInfo,children:[(0,r.jsx)("div",{className:$.aiFormTitle,children:null==n?void 0:n.title}),(0,r.jsx)("div",{className:$.aiFormDescription,children:e.S.ChatSkill.AIFormSkillCard.jumpToWeb})]})]})},t.type+o):null}if("thinking"===t.type)return(0,r.jsx)(ed,{itemId:e.props.itemId,hasContent:h||e.props.chatBotController.isFinished||(null===(M=e.props.chatBotController.lastRenderItem)||void 0===M?void 0:M.itemId)!==e.props.itemId,hideThinkingTooLong:v.length>0,agentStatus:t},t.type+o);if("debug_skill_request"===P||"debug_skill_response"===P){let n=(null===(b=t.metadata)||void 0===b?void 0:b.invokeSkillDetail)||"",i=n;try{i=JSON.stringify(S.c.parsePartialJson(n),null,2)}catch(e){}return(0,r.jsxs)(k.Fragment,{children:[(0,r.jsx)(E.r,{iconName:I,imgUrl:V,iconSize:16,children:(0,r.jsx)("span",{children:U})}),!!i&&(0,r.jsx)(ep,{vm:e,title:"debug_skill_request"===P?e.S.request:e.S.response,detail:i})]},t.type+o)}if("web_search"===t.type){let n=t.quotaInfo,{sources:s}=A.C.transformReplyContent("web_search",i.content,i.sources||null,!0);return I||V||(I="monicaWebsite"),(0,r.jsxs)(k.Fragment,{children:[(0,r.jsxs)(E.r,{iconName:I,imgUrl:V,iconColor:"var(--theme-icon-brand)",iconSize:16,children:[(0,r.jsx)("span",{children:t.text}),(null===(T=m.userController.userVipStatus)||void 0===T?void 0:T.vipVersion)==="free"&&n&&(0,r.jsxs)("span",{className:$.agentStatusQuota,children:["\xa0(",e.S.freeQueries," ",n.used,"/",n.total,")"]})]}),(0,r.jsx)(K.Z,{chatBotController:a,sources:s},a.isSelectMode?"selectMode":"normal")]},t.type+o)}return"reading_url"===t.type?(0,r.jsxs)(E.r,{iconName:"urlReading",iconSize:18,children:[e.S.linkReader,U]},t.type+o):"read_img"===t.type?(0,r.jsx)(E.r,{iconName:"imageChat",iconSize:18,children:e.S.imageReader},t.type+o):"search_memo"===t.type?(0,r.jsx)(E.r,{iconName:"memoLine",iconSize:16,iconColor:"var(--theme-icon-brand)",children:U},t.type+o):"draw_img"===t.type?(0,r.jsx)(E.r,{iconName:"imageGenerator",iconSize:16,iconColor:"var(--theme-icon-brand)",children:U},t.type+o):"draw_img_result"===t.type||"gen_image"===P?(0,r.jsx)(C,{status:t,chatController:a,useInAction:d},t.type+o):"calendar"===t.type?(0,r.jsx)(E.r,{iconName:I,iconSize:16,imgUrl:V,children:U},t.type+o):"update_memory"===t.type?(0,r.jsx)(ea,{chatBotController:a,summary:(null===(_=t.metadata)||void 0===_?void 0:_.updateMemorySummary)||"",children:U},t.type+o):"update_memory_suggestion"===t.type?(0,r.jsxs)(E.r,{iconName:"a41",iconSize:16,iconColor:"var(--theme-icon-brand)",children:[e.S.memorySuggestion,a.clientConfig.memorySuggestionTotal>0&&(0,r.jsx)("span",{className:$.badge,onClick:()=>{(0,z.B)({chatController:a,insertTarget:"mainWindow",defaultTab:"suggestion",enableHorizontalStyle:!0})},children:(0,w.x)(e.S.pending,{count:a.clientConfig.memorySuggestionTotal})})]},t.type+o):"search_knowledge"===t.type?(0,r.jsx)(E.r,{iconName:"coins",iconSize:16,iconColor:"var(--theme-function-success)",children:U},t.type+o):"text_status"===t.type?(0,r.jsx)(E.r,{iconName:I,imgUrl:V,iconSize:16,children:U},t.type+o):null}),v.length>0&&(0,r.jsx)("div",{className:$.thinkingDetails,children:(0,r.jsx)(_.U,{ghost:!0,items:v.map(t=>{var o,n,i,a;return{key:t.uid,label:(0,r.jsxs)("div",{className:$.thinkingDetailSummary,onClick:()=>{e.manualHandleThinkingDetail[t.uid]=f.has(t.uid)?"fold":"expand"},children:[(0,r.jsxs)("div",{className:$.thinkingDetailLabel,children:[(0,r.jsx)(I.U,{className:$.markdownTitle,citationsData:N,children:(null===(o=t.metadata)||void 0===o?void 0:o.title)||""}),(0,r.jsx)(V.W,{size:16,color:"var(--theme-icon-quaternary)",className:g()($.arrowDownIcon,{[$.expand]:f.has(t.uid)})})]}),!f.has(t.uid)&&(0,r.jsx)(I.U,{className:$.summaryText,citationsData:N,children:(null===(n=t.metadata)||void 0===n?void 0:n.description)||""})]}),children:(0,r.jsx)("div",{className:g()($.thinkingDetail),children:f.has(t.uid)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(I.U,{className:$.thinkingDetailText,citationsData:N,children:(null===(i=t.metadata)||void 0===i?void 0:i.reasoningDetail)||""}),(0,r.jsx)("br",{}),(0,r.jsx)(I.U,{className:$.thinkingDetailText,citationsData:N,children:(null===(a=t.metadata)||void 0===a?void 0:a.reasoningReflection)||""})]})})}}),activeKey:Array.from(f),expandIcon:()=>null})}),y.length>0&&(0,r.jsx)(eg,{vm:e,statusList:y,isLoading:s})]})}),ep=(0,T.Pi)(function(e){let{detail:t,title:o}=e,[n,i]=(0,k.useState)(!1);return(0,r.jsxs)("div",{className:$.skillDebug,children:[(0,r.jsxs)("div",{className:$.title,onClick:()=>{i(!n)},children:[(0,r.jsx)(c.J,{name:"arrow-y",size:12,className:g()($.icon,{[$.expand]:n})}),o]}),n&&(0,r.jsx)("div",{className:$.content,children:t})]})}),eu=(0,T.Pi)(function(e){var t;let{vm:o,status:n,source:i}=e,a=B.Qp.getMidMapDataFromAgentStatus(n);return a?(null===(t=o.mindMapDataUpdater)||void 0===t||t.call(o,(0,b.ZN)(a)),(0,r.jsx)(U.h,{data:a,onFullscreen:()=>{var e,t;if("ext-sidebar"===j.o.entryType||"horizontal"===F.L.mainWindowMode){let t=null!==(e=B.Qp.getMidMapDataFromAgentStatus(n))&&void 0!==e?e:void 0;o.props.chatBotController.openMindMapDialog({insertTarget:"dialogRoot",isOutsideContentRoot:!0,data:t,source:i,dataUpdater:e=>{o.mindMapDataUpdater=e}})}else v.T3.openMonicaChatTabPageV2({tab:"chat",botName:null===(t=o.props.chatBotController.botData.botItem)||void 0===t?void 0:t.name,botUid:o.props.chatBotController.botData.botId,convId:o.props.convId,itemId:o.props.itemId,action:"openMindMap"})}})):null}),eg=(0,T.Pi)(e=>{let{vm:t,statusList:o,isLoading:n}=e,i=n?t.S.analyzing:t.S.analyzed,a=[];o.forEach(e=>{if(!e.metadata)return;if("source_code"===e.metadata.eventType){a.push({sourceCode:e.text||""});return}let t=(0,M.Z)(a);t&&("std_out"===e.metadata.eventType&&(t.stdOut=e.text||""),"std_err"===e.metadata.eventType&&(t.stdErr=e.text||""),"exec_result"===e.metadata.eventType&&(t.execResult=e.text||""))});let s=o.filter(e=>{var t;return(null===(t=e.metadata)||void 0===t?void 0:t.eventType)==="gen_image"});return(0,r.jsxs)("div",{className:$.dataAnalysis,children:[(0,r.jsx)(E.r,{iconName:"dataAnalysis",iconColor:"var(--theme-function-success)",iconSize:16,children:(0,r.jsxs)("div",{className:$.headerCont,children:[i,a.map((e,t)=>(0,r.jsx)("span",{className:$.sourceCode,onClick:()=>{X({insertTarget:"mainWindow",sourceCode:e.sourceCode,stdOut:e.execResult||e.stdOut,stdErr:e.stdErr})},children:(0,r.jsx)(c.J,{className:$.icon,name:"terminal",size:16,color:"currentColor"})},"code_block_".concat(t)))]})},"dataAnalysis"),!!s.length&&s.map((e,o)=>{var n;if(!(null===(n=e.metadata)||void 0===n?void 0:n.imageUrl))return null;let i=e.metadata.imageUrl;return(0,r.jsx)(P.e,{className:$.imageBox,imageUrl:i,isShareMode:t.props.chatBotController.forSharePreview,onSetQuote:()=>{t.props.chatBotController.setQuote({imgUrl:i})},onDownload:()=>{p.m.fetchWithDownload(i,"Monica_".concat(N()().format("YYYY-MM-DD_HH-mm-ss"),".png"))}},"".concat(i,"_").concat(o))})]})}),ey=(0,T.Pi)(function(e){let{vm:t,text:o}=e,n=null;try{n=S.c.parsePartialJson(o||"")}catch(e){}return(0,r.jsxs)("div",{className:$.aiForm,children:[(0,r.jsxs)("div",{className:$.aiFormLabel,children:[(0,r.jsx)(c.J,{name:"agentStatusSkill",size:16,color:"var(--theme-icon-brand)"}),t.S.generateForm]}),n&&(0,r.jsx)("a",{className:$.aiFormContainer,href:"".concat(p.m.genWebAIFormUrl(null==n?void 0:n.uid),"&source=chat"),target:"_blank",rel:"noreferrer",children:(0,r.jsxs)("div",{className:$.aiFormContent,children:[(0,r.jsx)("div",{children:(0,r.jsx)(D.i,{className:$.aiFormIcon,size:36})}),(0,r.jsxs)("div",{className:$.aiFormInfo,children:[(0,r.jsx)("div",{className:$.aiFormTitle,children:null==n?void 0:n.title}),(0,r.jsx)("div",{className:$.aiFormDescription,children:t.S.ChatSkill.AIFormSkillCard.jumpToWeb})]})]})})]})})},98560:function(e,t,o){o.d(t,{r:function(){return u}});var r=o(71576),n=o(34491),i=o(46731),a=o(53040),s=o(78716),l=o.n(s),c=o(53489),m={agentStatusHead:"agent-status-head--k6xwq",agentStatusIcon:"agent-status-icon--jtY8t",imgIcon:"img-icon--U4jOW"},d=o(66084),h=o(52921);class p extends n.PN{onViewCreate(){}onViewDestroy(){}constructor(...e){super(...e),(0,d._)(this,"props",void 0),(0,d._)(this,"someState",!0)}}(0,h.gn)([n.SB],p.prototype,"someState",void 0);let u=n._Y.createComponent("AgentStatusHead",p,e=>{let{children:t,iconColor:o,iconName:n,iconSize:s=16,imgSize:d=16,imgUrl:h,className:p}=e.props,u={audioToText:(0,r.jsx)(c.j,{size:s,color:o,className:m.agentStatusIcon})},g=null;return!n||(g=u[n])||(g=(0,r.jsx)(i.J,{name:n,size:s,color:o,className:m.agentStatusIcon})),(0,r.jsxs)("div",{className:l()(m.agentStatusHead,p),children:[g,!g&&h&&(0,r.jsx)(a.E,{allowPreview:!0,src:h,className:m.imgIcon,style:{width:d,height:d}}),t]})})},40485:function(e,t,o){o.d(t,{Z:function(){return S}});var r=o(71576),n=o(34491),i=o(22046),a=o(4461),s=o(56607),l=o(92235),c=o(95782),m=o(78716),d=o.n(m),h=o(89322),p=o(18312),u=o(46731),g={sourcesFolder:"sources-folder--OOfiH",fold:"fold--waoFA",hidden:"hidden--gXJkq",title:"title--OToSX",linkAvatars:"link-avatars--Rwr0W",avatar:"avatar--gQqN2",line:"line--CcjWm",rt:"rt--G_FuK",rotate:"rotate--XV1Og",linkWrapper:"link-wrapper--_QvAj",rightArrow:"right-arrow--z7lRz",leftArrow:"left-arrow--cPUG0",lShadow:"l-shadow--vWHkx",rShadow:"r-shadow--iboyp",scrollWrapper:"scroll-wrapper--vQ2nk",linkListWrapper:"link-list-wrapper--gEOS_",linkListInner:"link-list-inner--hMrkO",linkItem:"link-item--B_BcC",linkTitleWrapper:"link-title-wrapper--x7Ezd",icon:"icon--IPJFK",linkText:"link-text--GbgOs"},y=o(66084),C=o(52921),v=o(88882);class x extends n.PN{get S(){return v.S.Global.components.ChatComponents.ChatMessage.SourcesFolder}onViewCreate(){if(this.scrollRef){this.observer=new ResizeObserver(e=>{for(let o of e){var t;let e=o.contentRect;if((null===(t=this.props.sources)||void 0===t?void 0:t.length)===0)return;if(o.target.scrollWidth===o.target.clientWidth)this.showRightArrow=!1,this.showLeftArrow=!1;else if(o.target.scrollWidth>o.target.clientWidth){if(o.target.scrollLeft+o.target.clientWidth===o.target.scrollWidth)return;this.showRightArrow=!0}let{width:r}=e;r<this.changedWidth?this.isTwoLine=!0:this.isTwoLine=!1}}),this.scrollRef.getBoundingClientRect().width<this.changedWidth?this.isTwoLine=!0:this.isTwoLine=!1;let e=this.scrollRef;this.observer.observe(e)}}onViewDestroy(){if(this.scrollRef){var e;null===(e=this.observer)||void 0===e||e.unobserve(this.scrollRef)}}formatData(e){let t=[],o=[];return e.forEach(e=>{t.length>o.length?o.push(e):t.push(e)}),this.isTwoLine?[t,o]:[e]}onScroll(e){if(!this.scrollRef)return;let{scrollLeft:t}=e.currentTarget,o=this.scrollRef.scrollWidth,r=this.scrollRef.clientWidth;t+r>=o-1?(this.showRightArrow=!1,this.showLeftArrow=!0):0===t?(this.showLeftArrow=!1,this.showRightArrow=!0):t>0&&t+r<o&&(this.showRightArrow=!0,this.showLeftArrow=!0)}scrollByLeft(e){this.scrollRef&&this.scrollRef.scrollBy({left:e?this.scrollRef.clientWidth:-this.scrollRef.clientWidth,behavior:"smooth"})}constructor(...e){super(...e),(0,y._)(this,"props",void 0),(0,y._)(this,"scrollRef",null),(0,y._)(this,"observer",null),(0,y._)(this,"changedWidth",400),(0,y._)(this,"folded",!0),(0,y._)(this,"isTwoLine",!1),(0,y._)(this,"showRightArrow",!0),(0,y._)(this,"showLeftArrow",!1)}}(0,C.gn)([n.SB],x.prototype,"folded",void 0),(0,C.gn)([n.SB],x.prototype,"isTwoLine",void 0),(0,C.gn)([n.SB],x.prototype,"showRightArrow",void 0),(0,C.gn)([n.SB],x.prototype,"showLeftArrow",void 0),(0,C.gn)([n.Fl],x.prototype,"S",null);let S=n._Y.createComponent("SourcesFolder",x,e=>{let{sources:t,className:o,chatBotController:n}=e.props;if(s.o.isWeb&&i.S.location.href.includes("share/chat-image")||0===t.length||"web_search"!==t[0].sourceType)return null;let m=/\[.*?\]\((https?:\/\/[^\s)"']+).*?\)/,y=e.props.sources.map(e=>{let t=e.data.text.match(m),o=(null==t?void 0:t[1])||"";return l.m.getMainDomain(o)}),C=[...new Set(y)].slice(0,5);return(0,r.jsxs)("div",{className:d()(g.sourcesFolder,o,{[g.hidden]:e.props.sources.length<=0,[g.fold]:e.folded}),onClick:()=>{"chat"!==p.J.activeTabKey||n.isSelectMode||"web-share-page"===s.o.entryType?e.folded=!e.folded:h.p.openWindow("search",t)},children:[(0,r.jsxs)("div",{className:g.title,children:[(0,r.jsx)(c.Z,{S:e.S.basedOnByNumber,data:{count:t.length}}),(0,r.jsx)("div",{className:g.linkAvatars,children:C.map((e,t,o)=>(0,r.jsx)(a.E,{style:{left:"".concat(-4*t,"px"),zIndex:o.length-t},className:g.avatar,src:l.m.getFaviconFromOrigin(e),alt:""},e))}),(0,r.jsx)("div",{className:g.line}),(0,r.jsx)(u.J,{className:d()(g.rt,{[g.rotate]:!e.folded}),size:16,name:"arrow-right"})]}),(0,r.jsxs)("div",{className:d()(g.linkWrapper,{[g.fold]:e.folded}),children:[e.showLeftArrow&&(0,r.jsx)("div",{className:g.lShadow}),e.showRightArrow&&(0,r.jsx)("div",{className:g.rShadow}),e.showLeftArrow&&(0,r.jsx)("div",{className:g.leftArrow,onClick:t=>{t.stopPropagation(),e.scrollByLeft(!1)},children:(0,r.jsx)(u.J,{name:"arrow-right",size:12,color:"currentColor",style:{color:"var(--theme-icon-quaternary)",transform:"rotate(180deg)"}})}),e.showRightArrow&&(0,r.jsx)("div",{className:g.rightArrow,onClick:t=>{t.stopPropagation(),e.scrollByLeft(!0)},children:(0,r.jsx)(u.J,{name:"arrow-right",size:12,color:"currentColor",style:{color:"var(--theme-icon-quaternary)"}})}),(0,r.jsx)("div",{className:g.scrollWrapper,ref:t=>e.scrollRef=t,onScroll:t=>e.onScroll(t),children:(0,r.jsx)("div",{className:g.linkListWrapper,children:e.formatData(t).map((t,o)=>(0,r.jsx)("div",{className:g.linkListInner,children:t.map((t,o)=>{if("article"===t.sourceType||"web_search"===t.sourceType){let{data:n}=t,i=n.text.match(/\[.*?\]\((https?:\/\/[^\s)"']+).*?\)/),s=n.text.match(/\[([^\]]+)]\([^)]+\)/),c=i?i[1]:"",m=s?s[1]:"";return(0,r.jsxs)("div",{className:g.linkItem,onClick:()=>{c?window.open(c):e.props.chatBotController.handleReplySourceClick(t.data)},children:[(0,r.jsxs)("div",{className:g.linkTitleWrapper,children:[(0,r.jsx)(a.E,{className:g.icon,src:l.m.getFaviconFromOrigin(c),alt:""}),(0,r.jsx)("span",{children:m})]}),(0,r.jsx)("div",{className:g.linkText,children:m})]},o)}return null})},o))})})]})]})})},73296:function(e,t,o){o.d(t,{e:function(){return g}});var r=o(71576),n=o(34491),i=o(5404),a=o(78716),s=o.n(a),l=o(53040),c={imagePreview:"image-preview--_HRpF",share:"share--kl73N",img:"img--LrtaM",tools:"tools--_KTO0"},m=o(66084),d=o(52921),h=o(88882),p=o(73047);class u extends n.PN{get S(){return h.S.Global.components.ChatComponents.ImagePreview}onViewCreate(){}onViewDestroy(){}constructor(...e){super(...e),(0,m._)(this,"props",void 0),(0,m._)(this,"someState",!0)}}(0,d.gn)([n.SB],u.prototype,"someState",void 0),(0,d.gn)([p.Fl],u.prototype,"S",null);let g=n._Y.createComponent("ImagePreview",u,e=>{let{imageUrl:t,allowEdit:o,allowSaveToMemo:n,isShareMode:a,className:m,imgClassName:d,responsive:h,maxWidth:p,maxHeight:u,onDownload:g,onSetQuote:y,hideTools:C}=e.props;return(0,r.jsxs)("div",{className:s()(c.imagePreview,{[c.share]:a},m),children:[(0,r.jsx)(l.E,{className:s()(c.img,d),skeleton:!0,allowPreview:!0,src:t,responsive:h,maxWidth:p,maxHeight:u}),!a&&!C&&(0,r.jsx)(i.f,{allowEdit:o,allowSaveToMemo:n,onDownload:g,onSetQuote:y,className:c.tools,imageUrl:t})]})})},5404:function(e,t,o){o.d(t,{f:function(){return C}});var r=o(71576),n=o(34491),i=o(27534),a=o(51782),s=o(90230),l=o(35978),c=o(78716),m=o.n(c),d={imageTools:"image-tools--RZ5bF",actionButton:"action-button--qLJTI",memo:"memo--KhW0c"},h=o(66084),p=o(52921),u=o(88882),g=o(73047);class y extends n.PN{get S(){return u.S.Global.components.ChatComponents.ImagePreview.ImageTools}onViewCreate(){}onViewDestroy(){}constructor(...e){super(...e),(0,h._)(this,"props",void 0),(0,h._)(this,"someState",!0)}}(0,p.gn)([n.SB],y.prototype,"someState",void 0),(0,p.gn)([g.Fl],y.prototype,"S",null);let C=n._Y.createComponent("ImageTools",y,e=>{let{imageUrl:t,allowEdit:o,allowSaveToMemo:n,className:c,onDownload:h,onSetQuote:p,allowQuote:u=!0}=e.props;return(0,r.jsxs)("div",{className:m()(d.imageTools,c),children:[u&&(0,r.jsx)(i.h,{iconName:"quote",title:e.S.quote,iconSize:16,color:"var(--theme-icon-white-primary)",className:d.actionButton,onClick:()=>{null==p||p()}}),n&&(0,r.jsx)(a.f,{className:m()(d.actionButton,d.memo),onClick:async()=>{let e=await s.a.createTextMemo({content:"![](".concat(t,")"),isMarkdown:!0});s.a.saveToMemoSuccess(e.item.uid)}}),(0,r.jsx)(i.h,{iconName:"sDownload",title:e.S.download,iconSize:16,className:d.actionButton,color:"var(--theme-icon-white-primary)",onClick:()=>{null==h||h()}}),o&&(0,r.jsx)(l.Y,{imgUrl:t,triggerNode:(0,r.jsx)(i.h,{iconName:"readingMore",title:e.S.edit,iconSize:16,className:d.actionButton,color:"var(--theme-icon-white-primary)",onClick:()=>{}})})]})})},37013:function(e,t,o){o.d(t,{U:function(){return c}});var r=o(71576),n=o(34491),i=o(27011),a=o(66084),s=o(52921);class l extends n.PN{onViewCreate(){}onViewDestroy(){}constructor(...e){super(...e),(0,a._)(this,"props",void 0),(0,a._)(this,"someState",!0)}}(0,s.gn)([n.SB],l.prototype,"someState",void 0);let c=n._Y.createComponent("Collapse",l,e=>(0,r.jsx)(i.default,{className:"collapse--CU6rY",...e.props}))},40658:function(e,t,o){o.d(t,{W:function(){return c}});var r=o(71576),n=o(58812),i=o(34491),a=o(66084);class s extends i.PN{constructor(...e){super(...e),(0,a._)(this,"props",void 0)}}var l=JSON.parse('{"fill":"none","content":"\\n<g id=\\"Line/&#230;&#150;&#185;&#229;&#144;&#145;/&#231;&#174;&#173;&#229;&#164;&#180;-&#228;&#184;&#139;\\">\\n<path id=\\"Vector 457\\" d=\\"M10.5 4.5L6 9L1.5 4.5\\" stroke=\\"#868692\\" stroke-width=\\"1.5\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\"/>\\n</g>\\n\\n","viewBox":"0 0 12 13"}');let c=i._Y.createComponent("ArrowDownV2Icon",s,e=>(0,r.jsx)(n.s,{...e.props,name:"ArrowDownV2Icon",iconData:l}))},24630:function(e,t,o){o.d(t,{X:function(){return c}});var r=o(71576),n=o(58812),i=o(34491),a=o(66084);class s extends i.PN{constructor(...e){super(...e),(0,a._)(this,"props",void 0)}}var l=JSON.parse('{"fill":"none","content":"\\n<g id=\\"chevron-right\\">\\n<path id=\\"Vector\\" fill-rule=\\"evenodd\\" clip-rule=\\"evenodd\\" d=\\"M4.6318 2.6318C4.80754 2.45607 5.09246 2.45607 5.2682 2.6318L8.2682 5.6318C8.44393 5.80754 8.44393 6.09246 8.2682 6.2682L5.2682 9.2682C5.09246 9.44393 4.80754 9.44393 4.6318 9.2682C4.45607 9.09246 4.45607 8.80754 4.6318 8.6318L7.3136 5.95L4.6318 3.2682C4.45607 3.09246 4.45607 2.80754 4.6318 2.6318Z\\" fill=\\"#3D3D43\\"/>\\n</g>\\n\\n","viewBox":"0 0 12 12"}');let c=i._Y.createComponent("ChevronRightIcon",s,e=>(0,r.jsx)(n.s,{...e.props,name:"ChevronRightIcon",iconData:l}))},10249:function(e,t,o){o.d(t,{T:function(){return c}});var r=o(71576),n=o(58812),i=o(34491),a=o(66084);class s extends i.PN{constructor(...e){super(...e),(0,a._)(this,"props",void 0)}}var l=JSON.parse('{"fill":"none","content":"\\n<path fill-rule=\\"evenodd\\" clip-rule=\\"evenodd\\" d=\\"M8 2.625C5.03147 2.625 2.625 5.03147 2.625 8C2.625 10.9685 5.03147 13.375 8 13.375C10.9685 13.375 13.375 10.9685 13.375 8C13.375 5.03147 10.9685 2.625 8 2.625ZM1.375 8C1.375 4.34111 4.34111 1.375 8 1.375C11.6589 1.375 14.625 4.34111 14.625 8C14.625 11.6589 11.6589 14.625 8 14.625C4.34111 14.625 1.375 11.6589 1.375 8ZM8 3.775C8.34518 3.775 8.625 4.05482 8.625 4.4V7.61373L10.6795 8.64098C10.9882 8.79535 11.1134 9.17077 10.959 9.47951C10.8046 9.78825 10.4292 9.91339 10.1205 9.75902L7.72049 8.55902C7.50875 8.45315 7.375 8.23673 7.375 8V4.4C7.375 4.05482 7.65482 3.775 8 3.775Z\\" fill=\\"#868692\\"/>\\n\\n","viewBox":"0 0 16 16"}');let c=i._Y.createComponent("ClockIcon",s,e=>(0,r.jsx)(n.s,{...e.props,name:"ClockIcon",iconData:l}))},66395:function(e,t,o){o.d(t,{k:function(){return c}});var r=o(71576),n=o(58812),i=o(34491),a=o(66084);class s extends i.PN{constructor(...e){super(...e),(0,a._)(this,"props",void 0)}}var l=JSON.parse('{"fill":"none","content":"\\n<g id=\\"light\\">\\n<g id=\\"Vector\\">\\n<path d=\\"M8.72415 5.4022L10.3815 6.02363C10.5322 6.08015 10.5769 6.28025 10.4689 6.39598L7.24799 9.84655C7.09257 10.0131 6.81116 9.85958 6.8542 9.64448L7.27597 7.53592L5.61862 6.91449C5.47079 6.85906 5.42106 6.66014 5.53121 6.54214L8.75212 3.09157C8.90755 2.92507 9.18893 3.07855 9.14592 3.29364L8.72415 5.4022Z\\" fill=\\"#222226\\"/>\\n<path fill-rule=\\"evenodd\\" clip-rule=\\"evenodd\\" d=\\"M7.99996 1.8333C5.33518 1.8333 3.18541 3.97001 3.18541 6.59294C3.18541 7.48994 3.43584 8.32758 3.87143 9.04315C4.08634 9.3962 4.29566 9.61985 4.52736 9.86742C4.56692 9.9097 4.60714 9.95268 4.64816 9.99711C4.93566 10.3086 5.23119 10.6645 5.44016 11.2506C5.59633 11.6886 5.93428 11.9362 6.25253 11.9362L9.79531 11.9362L9.80779 11.9361C9.80979 11.9361 9.81123 11.9361 9.81123 11.9361C10.0264 11.9336 10.1595 11.8821 10.2472 11.8188C10.3349 11.7555 10.4258 11.6454 10.496 11.4421C10.496 11.4421 10.4963 11.4412 10.4968 11.4395C10.4985 11.4344 10.5028 11.4216 10.5108 11.3974L10.5555 11.263C10.5935 11.1486 10.661 11.032 10.7106 10.9506C10.7685 10.8554 10.8401 10.7478 10.9172 10.6366C11.0718 10.4135 11.2636 10.1544 11.4479 9.91137C11.633 9.66729 11.8139 9.43475 11.9484 9.26355C12.0157 9.17784 12.0715 9.10727 12.1106 9.05803L12.1475 9.01165C12.5714 8.30304 12.8145 7.47681 12.8145 6.59294C12.8145 3.97001 10.6647 1.8333 7.99996 1.8333ZM13.1095 9.73004L13.0944 9.74888L13.0505 9.80405C13.0125 9.85191 12.958 9.92084 12.8922 10.0047C12.7603 10.1726 12.5838 10.3994 12.4042 10.6363C12.2238 10.8742 12.0438 11.1178 11.9034 11.3203C11.8329 11.4219 11.7762 11.5079 11.7355 11.5747C11.7029 11.6283 11.6913 11.6524 11.69 11.6542L11.6858 11.6669C11.6529 11.766 11.6341 11.8226 11.6304 11.8334C11.4971 12.2197 11.2773 12.5553 10.9494 12.7919C10.9275 12.8077 10.9054 12.8228 10.8831 12.8374L10.851 12.9748C10.8123 13.1407 10.7808 13.3981 10.7447 13.692C10.7352 13.77 10.7253 13.8505 10.7149 13.9326C10.714 13.9396 10.7131 13.947 10.7121 13.9547C10.6991 14.0592 10.6793 14.2186 10.6206 14.3716C10.5463 14.5655 10.4278 14.7153 10.2775 14.8478C10.114 14.9918 9.93847 15.0867 9.72918 15.132C9.56672 15.1671 9.39693 15.1669 9.27191 15.1667C9.26326 15.1667 9.25482 15.1667 9.24661 15.1667L7.16745 15.1667C6.9164 15.1667 6.67655 15.1667 6.47734 15.1423C6.25482 15.115 6.00887 15.0502 5.79069 14.8665C5.5705 14.6811 5.46518 14.4458 5.40076 14.2304C5.34252 14.0356 5.30101 13.795 5.25716 13.5409L5.25205 13.5112C5.2138 13.2897 5.17746 13.0972 5.14891 12.9748L5.09429 12.7407C4.72701 12.462 4.45694 12.0661 4.30986 11.6536C4.17944 11.2878 4.00699 11.0717 3.76633 10.811C3.73267 10.7745 3.69719 10.7367 3.66019 10.6974C3.42575 10.4478 3.13015 10.1332 2.84641 9.66711C2.29992 8.76937 1.98541 7.71677 1.98541 6.59294C1.98541 3.29577 4.684 0.633301 7.99996 0.633301C11.3159 0.633301 14.0145 3.29577 14.0145 6.59294C14.0145 7.71677 13.7 8.76937 13.1535 9.66711L13.1335 9.69997L13.1095 9.73004ZM6.4044 13.1362C6.41455 13.1923 6.42463 13.2496 6.43454 13.307C6.4854 13.6015 6.51542 13.7694 6.55047 13.8866C6.55799 13.9118 6.56448 13.9299 6.56954 13.9426C6.58207 13.9453 6.5996 13.9483 6.6234 13.9512C6.74061 13.9656 6.90523 13.9667 7.19757 13.9667L9.24661 13.9667C9.32407 13.9667 9.37397 13.9665 9.41597 13.9646C9.44402 13.9634 9.4601 13.9616 9.46856 13.9603C9.47213 13.9576 9.47727 13.9535 9.48408 13.9475C9.49237 13.9402 9.49847 13.9344 9.50282 13.93C9.50365 13.9261 9.5046 13.9213 9.50567 13.9154C9.51116 13.8851 9.51605 13.8478 9.52443 13.7817C9.53218 13.7206 9.54016 13.6549 9.54846 13.5867C9.56605 13.442 9.58507 13.2857 9.60623 13.1362L6.4044 13.1362Z\\" fill=\\"#222226\\"/>\\n</g>\\n</g>\\n\\n","viewBox":"0 0 16 16"}');let c=i._Y.createComponent("LightIcon",s,e=>(0,r.jsx)(n.s,{...e.props,name:"LightIcon",iconData:l}))},12410:function(e,t,o){o.d(t,{e:function(){return c}});var r=o(71576),n=o(58812),i=o(34491),a=o(66084);class s extends i.PN{constructor(...e){super(...e),(0,a._)(this,"props",void 0)}}var l=JSON.parse('{"fill":"none","content":"\\n<g clip-path=\\"url(#clip0_873_8810)\\">\\n<path fill-rule=\\"evenodd\\" clip-rule=\\"evenodd\\" d=\\"M4.00005 14.5504C5.00797 14.5504 5.82505 13.7333 5.82505 12.7254C5.82505 11.7175 5.00797 10.9004 4.00005 10.9004C2.99213 10.9004 2.17505 11.7175 2.17505 12.7254C2.17505 13.7333 2.99213 14.5504 4.00005 14.5504ZM7.10315 13.4004C6.79371 14.8296 5.52192 15.9004 4.00005 15.9004C2.24655 15.9004 0.82505 14.4789 0.825051 12.7254C0.825051 10.9719 2.24655 9.55039 4.00005 9.55039C5.52192 9.55039 6.79371 10.6211 7.10315 12.0504L16.5 12.0504C16.8728 12.0504 17.175 12.3526 17.175 12.7254C17.175 13.0982 16.8728 13.4004 16.5 13.4004L7.10315 13.4004ZM14 7.13372C15.008 7.13372 15.825 6.31664 15.825 5.30872C15.825 4.3008 15.008 3.48373 14 3.48373C12.9921 3.48373 12.175 4.3008 12.175 5.30872C12.175 6.31664 12.9921 7.13372 14 7.13372ZM17.175 5.30872C17.175 7.06223 15.7536 8.48372 14 8.48372C12.4782 8.48372 11.2064 7.41297 10.897 5.98372L1.50005 5.98372C1.12726 5.98372 0.825051 5.68151 0.825051 5.30872C0.825051 4.93593 1.12726 4.63372 1.50005 4.63372L10.897 4.63372C11.2064 3.20448 12.4782 2.13373 14.0001 2.13373C15.7536 2.13373 17.175 3.55522 17.175 5.30872Z\\" fill=\\"black\\"/>\\n</g>\\n<defs>\\n<clipPath id=\\"clip0_873_8810\\">\\n<rect width=\\"18\\" height=\\"18\\" fill=\\"white\\" transform=\\"translate(18 18) rotate(-180)\\"/>\\n</clipPath>\\n</defs>\\n\\n","viewBox":"0 0 18 18"}');let c=i._Y.createComponent("SettingsIcon",s,e=>(0,r.jsx)(n.s,{...e.props,name:"SettingsIcon",iconData:l}))},53489:function(e,t,o){o.d(t,{j:function(){return c}});var r=o(71576),n=o(58812),i=o(34491),a=o(66084);class s extends i.PN{constructor(...e){super(...e),(0,a._)(this,"props",void 0)}}var l=JSON.parse('{"fill":"none","content":"\\n<g id=\\"Voice to 2\\">\\n<path id=\\"Star 4\\" d=\\"M3.52196 6.85586C3.61595 6.60371 3.97259 6.60371 4.06658 6.85586L4.69179 8.5332C4.78997 8.79661 4.99774 9.00438 5.26115 9.10256L6.93849 9.72777C7.19064 9.82176 7.19064 10.1784 6.9385 10.2724L5.26115 10.8976C4.99774 10.9958 4.78997 11.2035 4.69179 11.467L4.06658 13.1443C3.97259 13.3965 3.61595 13.3965 3.52196 13.1443L2.89675 11.467C2.79857 11.2036 2.5908 10.9958 2.32739 10.8976L0.650047 10.2724C0.397901 10.1784 0.397901 9.82176 0.650046 9.72777L2.32739 9.10256C2.5908 9.00438 2.79857 8.79661 2.89675 8.5332L3.52196 6.85586Z\\" fill=\\"white\\"/>\\n<path id=\\"Vector\\" d=\\"M10.7387 2.74316L10.7387 18.0904M7.12756 6.35428L7.1276 7.25705M7.12756 13.5765L7.1276 14.4793M14.3498 6.35428L14.3498 14.4793M17.9609 9.514L17.9609 11.3196\\" stroke=\\"white\\" stroke-width=\\"1.5\\" stroke-linecap=\\"round\\"/>\\n</g>\\n\\n","viewBox":"0 0 20 20"}');let c=i._Y.createComponent("VoiceToIcon",s,e=>(0,r.jsx)(n.s,{...e.props,name:"VoiceToIcon",iconData:l}))},35978:function(e,t,o){o.d(t,{Y:function(){return w}});var r=o(71576),n=o(34491),i=o(20995),a=o(69645),s=o(46731),l=o(75372),c=o(48023),m=o(11502),d=o(96522),h=o(88882),p=o(56607),u=o(62499),g=o(24900),y=o(44469),C=o(66084),v=o(52921),x=o(73047);class S extends n.PN{get S(){return h.S.Global.modules.ChatBox.ChatImageToolbar}onViewCreate(){}onViewDestroy(){}constructor(...e){super(...e),(0,C._)(this,"props",void 0),(0,C._)(this,"someState",!0)}}(0,v.gn)([n.SB],S.prototype,"someState",void 0),(0,v.gn)([x.Fl],S.prototype,"S",null);let w=n._Y.createComponent("ChatImageToolbar",S,e=>{let{className:t,triggerNode:o}=e.props;return(0,r.jsx)(l.x,{trigger:"click",placement:"bottomRight",closeAfterContentClick:!0,content:(0,r.jsx)(j,{vm:e}),triggerNode:o,children:!o&&(0,r.jsx)(c.u,{trigger:["hover","click"],title:e.S.edit,placement:"bottom",mouseEnterDelay:.3,children:(0,r.jsx)("div",{className:t,onClick:()=>{m.M.createUserBehaviorEvent({eventName:"artist_image_action",source:"preview",extData:{module:"more"}})},children:(0,r.jsx)(s.J,{name:"quickActionMore",color:"currentColor"})})})})}),j=(0,u.Pi)(function(e){let{vm:t}=e;return(0,r.jsx)(i.h,{children:(0,d.X)(h.S.Global.services.extensionService).map(e=>(0,r.jsx)(a.X,{content:e.name(),icon:e.icon,onClick:()=>{m.M.createUserBehaviorEvent({eventName:"artist_image_action",source:"preview",extData:{module:e.key}}),p.o.isDesktop?g.Tn.contextMenuClick({menuItemId:e.key,srcUrl:t.props.imgUrl}):y.T3.imageToolsMenuClick({menuItemId:e.key,srcUrl:t.props.imgUrl},!0)}},e.key))})})},5058:function(e,t,o){o.d(t,{B:function(){return e5}});var r=o(71576),n=o(34491),i=o(43939),a=o(62499),s=o(46731),l=o(56105),c=o(36307),m=o(58812),d=o(66084);class h extends n.PN{constructor(...e){super(...e),(0,d._)(this,"props",void 0)}}var p=JSON.parse('{"fill":"none","content":"\\n<g id=\\"file-text-ai\\">\\n<g id=\\"Vector\\">\\n<path d=\\"M18.493 16.312C18.6034 15.7719 19.3751 15.7719 19.4854 16.312C19.7292 17.5048 20.6614 18.437 21.8542 18.6808C22.3943 18.7911 22.3943 19.5628 21.8542 19.6732C20.6614 19.917 19.7292 20.8491 19.4854 22.0419C19.3751 22.582 18.6034 22.582 18.493 22.0419C18.2492 20.8491 17.3171 19.917 16.1243 19.6732C15.5842 19.5628 15.5842 18.7911 16.1243 18.6808C17.3171 18.437 18.2492 17.5048 18.493 16.312Z\\" fill=\\"black\\"/>\\n<path fill-rule=\\"evenodd\\" clip-rule=\\"evenodd\\" d=\\"M3.09998 4.99998C3.09998 2.84606 4.84607 1.09998 6.99998 1.09998H17C19.1539 1.09998 20.9 2.84607 20.9 4.99998V13C20.9 13.497 20.497 13.9 20 13.9C19.5029 13.9 19.1 13.497 19.1 13V4.99998C19.1 3.84018 18.1598 2.89998 17 2.89998H6.99998C5.84018 2.89998 4.89998 3.84018 4.89998 4.99998V19C4.89998 20.1598 5.84018 21.1 6.99998 21.1H13C13.497 21.1 13.9 21.5029 13.9 22C13.9 22.497 13.497 22.9 13 22.9H6.99998C4.84606 22.9 3.09998 21.1539 3.09998 19V4.99998ZM6.90002 8.53355C6.90002 8.03649 7.30297 7.63354 7.80002 7.63354H16.2684C16.7654 7.63354 17.1684 8.03649 17.1684 8.53355C17.1684 9.0306 16.7654 9.43355 16.2684 9.43355H7.80002C7.30297 9.43355 6.90002 9.0306 6.90002 8.53355ZM6.90002 13.0324C6.90002 12.5353 7.30297 12.1324 7.80002 12.1324H16.2684C16.7654 12.1324 17.1684 12.5353 17.1684 13.0324C17.1684 13.5294 16.7654 13.9324 16.2684 13.9324H7.80002C7.30297 13.9324 6.90002 13.5294 6.90002 13.0324Z\\" fill=\\"black\\"/>\\n</g>\\n</g>\\n\\n","viewBox":"0 0 24 24"}');let u=n._Y.createComponent("FileTextAiIcon",h,e=>(0,r.jsx)(m.s,{...e.props,name:"FileTextAiIcon",iconData:p}));var g=o(19221),y=o(66395),C=o(26120),v=o(82005),x={drawerTitle:"drawer-title--x0TfG",memoryDrawerTitle:"memory-drawer-title--kYTwc",memoryDrawerTitleLeft:"memory-drawer-title-left--Yle5x",title:"title--cZ8ci",memoryDrawerTitleRight:"memory-drawer-title-right--WYKvR",proIco:"pro-ico--BwdCu",backIcon:"back-icon--qnYSD",memoryDrawer:"memory-drawer--Zm4et",memoryDrawerBody:"memory-drawer-body--F8jQV",acceptWarning:"accept-warning--kLG7h",tipsHd:"tips-hd--wyty5",tipsTitle:"tips-title--OY9tM",manageBtn:"manage-btn--lCi5Z",tipsSubtitle:"tips-subtitle--OWyEU"},S=o(95782),w=o(92235),j=o(92660),f=o(88882),N=o(21320),M=o(78716),b=o.n(M),T=o(26025),k=o(12410),D=o(24630),A=o(48023),_=o(10249),I=o(5857),V=o(33381),F=o(25449),B=o(47720),L={subscribeButton:"subscribe-button--s4mYj",offBadge:"off-badge--c4JC4"},U=o(52921),z=o(73047);class P extends n.PN{get S(){return f.S.Global.components.SubscribeButton}onViewCreate(){}onViewDestroy(){}constructor(...e){super(...e),(0,d._)(this,"props",void 0),(0,d._)(this,"someState",!0)}}(0,U.gn)([n.SB],P.prototype,"someState",void 0),(0,U.gn)([z.Fl],P.prototype,"S",null);let E=n._Y.createComponent("SubscribeButton",P,e=>{let{className:t,type:o="primary",source:n="subscribe_button",onClick:i,hideBadge:a,extData:s,customText:l}=e.props;return(0,r.jsxs)(I.z,{className:b()(L.subscribeButton,t),type:o,size:"large",loading:V.userController.resubscribeLoading,onClick:async()=>{if(V.userController.canResubscribe){await V.userController.resubscribe(n),null==i||i(!0);return}V.userController.upgrade(n,void 0,s),null==i||i()},children:[l||F.promotionController.subscribeButtonText,F.promotionController.hasPromotion&&!a&&(0,r.jsx)("span",{className:L.offBadge,children:(0,f.x)(e.S.off,{discount:B.serverConfigController.recommendPlan.yearlyDiscountPercent})})]})});var R=o(90180),W=o(14084),O=o(38172),Y=o(34891),Z=o(15851);class H extends n.PN{constructor(...e){super(...e),(0,d._)(this,"props",void 0)}}var G=JSON.parse('{"fill":"none","content":"\\n<g id=\\"alert-circle\\">\\n<path id=\\"Vector\\" fill-rule=\\"evenodd\\" clip-rule=\\"evenodd\\" d=\\"M12 1.10059C5.98007 1.10059 1.09998 5.98068 1.09998 12.0006C1.09998 18.0205 5.98007 22.9006 12 22.9006C18.0199 22.9006 22.9 18.0205 22.9 12.0006C22.9 5.98068 18.0199 1.10059 12 1.10059ZM12.9 8.00059C12.9 7.50353 12.497 7.10059 12 7.10059C11.5029 7.10059 11.1 7.50353 11.1 8.00059V13.0006C11.1 13.4976 11.5029 13.9006 12 13.9006C12.497 13.9006 12.9 13.4976 12.9 13.0006V8.00059ZM12 15.0006C11.4477 15.0006 11 15.4483 11 16.0006C11 16.5529 11.4477 17.0006 12 17.0006H12.01C12.5623 17.0006 13.01 16.5529 13.01 16.0006C13.01 15.4483 12.5623 15.0006 12.01 15.0006H12Z\\" fill=\\"#FFAB00\\"/>\\n</g>\\n\\n","viewBox":"0 0 24 24"}');let J=n._Y.createComponent("AlertCircleFillIcon",H,e=>(0,r.jsx)(m.s,{...e.props,name:"AlertCircleFillIcon",iconData:G}));var q=o(68104),Q=o(90683),X=o(92347),K=o(11989),$=o(81131),ee=o(92020),et={contentInfoLeft:"content-info-left--Uynfs",limitTips:"limit-tips--ZZrQp",tipsContent:"tips-content--UjSca",textareaValueCount:"textarea-value-count--N33QT",current:"current--OTBuE",error:"error--CNI7M",link:"link--m3UGl"};class eo extends n.PN{get S(){return f.S.Global.modules.ChatBox.MemoryDrawer.MemoryTextarea}onViewCreate(){}onViewDestroy(){}constructor(...e){super(...e),(0,d._)(this,"props",void 0)}}(0,U.gn)([n.Fl],eo.prototype,"S",null);let er=n._Y.createComponent("MemoryTextarea",eo,e=>{let{maxLength:t,onChange:o,value:n,autoFocus:i,disabled:a,placeholder:s,onEnter:l}=e.props,c=t===1/0,m=!c&&n.length>t;return(0,r.jsx)($.W,{rowsData:{min:4,max:7},disabled:a,value:n,getTextAreaRef:e=>{i&&(null==e||e.focus())},onChange:e=>{o(e.target.value)},placeholder:s,toolbar:{leftContent:m?(0,r.jsxs)("div",{className:et.contentInfoLeft,children:[(0,r.jsx)("span",{className:et.limitTips,children:e.S.limitTips}),(0,r.jsx)(A.u,{title:(0,r.jsx)(S.Z,{S:e.S.limitTipsContent,components:{link:e=>(0,r.jsx)("span",{className:et.link,onClick:()=>{O.W.createUserBehaviorEvent({eventName:"memory_limit_tips_click"}),ee.ll.openMonicaOptionsPage({menuKey:"general"})},children:e})}}),children:(0,r.jsx)("div",{className:et.tipsContent,children:(0,r.jsx)(T.B,{size:12,color:"var(--theme-icon-quaternary)"})})})]}):(0,r.jsx)(r.Fragment,{}),rightContent:n.length>0?(0,r.jsx)("div",{className:et.textareaValueCount,children:c?(0,r.jsxs)(r.Fragment,{children:[" ",n.length]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:b()(et.current,{[et.error]:m}),children:n.length}),"/",t]})}):(0,r.jsx)(r.Fragment,{})},onKeyDown:e=>{K.t.isHotkey(e,["enter"])&&(null==l||l(),e.preventDefault(),e.stopPropagation())}})});var en={editMemoryDialog:"edit-memory-dialog--bxCUx",dialogTitle:"dialog-title--mlYj2",footer:"footer--EAPcq",btn:"btn--mu0vP"},ei=o(1396);class ea extends n.PN{get monicaClientConfig(){return ei.Mp.getMonicaChatController().clientConfig}get S(){return f.S.Global.modules.ChatBox.MemoryDrawer.EditMemoryDialog}get isEdit(){return!!this.props.item}onViewCreate(){let e=this.props.item;e&&(this.isSuggestion(e)?this.value=e.newContent||"":this.value=e.content||"")}onViewDestroy(){}async handleSave(){let e=this.value.trim();if(!e)return;this.isSaving=!0;let t=this.props.item;try{this.isEdit?this.isSuggestion(t)?await this.monicaClientConfig.acceptMemorySuggestion({content:e,suggestionId:t.id}):await this.monicaClientConfig.updateMemoryItem({itemId:null==t?void 0:t.id,content:e}):await this.monicaClientConfig.createMemoryItem(e),this.props.onDisposed()}catch(e){var o,r,n;(null==e?void 0:null===(o=e.data)||void 0===o?void 0:o.code)===33001?null===(r=(n=this.props).openMemoryStorageFullToast)||void 0===r||r.call(n):Z.M.error(w.m.formatErrorMsg(e))}this.isSaving=!1}isSuggestion(e){return!!this.props.isSuggestion}constructor(...e){super(...e),(0,d._)(this,"props",void 0),(0,d._)(this,"maxMemoryLength",100),(0,d._)(this,"value",""),(0,d._)(this,"isSaving",!1)}}(0,U.gn)([n.SB],ea.prototype,"value",void 0),(0,U.gn)([n.SB],ea.prototype,"isSaving",void 0),(0,U.gn)([n.Fl],ea.prototype,"S",null),(0,U.gn)([n.Fl],ea.prototype,"isEdit",null);let es=n._Y.createComponent("EditMemoryDialog",ea,e=>{let{onDisposed:t,insertTarget:o}=e.props;return(0,r.jsxs)(q.u,{width:360,className:en.editMemoryDialog,onDispose:()=>{t()},fixed:"dialogRoot"===o,children:[(0,r.jsx)("div",{className:en.dialogTitle,children:e.isEdit?e.S.dialogTitleForEdit:e.S.dialogTitle}),(0,r.jsx)(er,{autoFocus:!0,value:e.value,placeholder:e.S.editPlaceholder,maxLength:Q.T.ctxMode===X.p5.Custom?1/0:e.maxMemoryLength,onChange:t=>{e.value=t},onEnter:()=>{e.handleSave()}}),(0,r.jsxs)("div",{className:en.footer,children:[(0,r.jsx)(I.z,{type:"gray",size:"overMedium",onClick:t,className:en.btn,children:e.S.cancel}),(0,r.jsx)(I.z,{disabled:!e.value.trim(),loading:e.isSaving,type:"primary",size:"overMedium",className:en.btn,onClick:()=>{e.handleSave()},children:e.isEdit?e.isSuggestion(e.props.item)?e.S.saveAndAdopt:e.S.save:e.S.create})]})]})}),el=v.t.createOpener(es);class ec extends n.PN{get monicaClientConfig(){return this.props.chatController.clientConfig}get S(){return f.S.Global.modules.ChatBox.MemoryDrawer}get modelList(){return((null===B.serverConfigController||void 0===B.serverConfigController?void 0:B.serverConfigController.getStaticConfig("monicaModelList"))||[]).filter(e=>e.capabilities.includes("memory"))}get showBackIcon(){return!!this.tabHistory.length}get isMemoryStorageFull(){var e,t;return((null===(t=this.monicaClientConfig.memoryInfo)||void 0===t?void 0:null===(e=t.itemList)||void 0===e?void 0:e.length)||0)>=this.monicaClientConfig.maxMemoryItems}toggleTab(e){"homeView"===e?this.tabHistory=[]:this.tabHistory.push(this.tab),this.tab=e}handleBack(){if(0===this.tabHistory.length){this.props.onDisposed();return}this.tab=this.tabHistory.pop()}toggleMemory(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.monicaClientConfig.toggleSkill("memory",e,!0,t)}handleClearMemory(){(0,Y.B)({title:this.S.clearMemoryTitle,content:this.S.clearMemoryContent,okText:this.S.clear,okBtnType:"danger",onOk:async()=>(await this.monicaClientConfig.clearMemoryItems(),!0),insertTarget:"mainWindow"})}handleCreateMemory(){if(this.isMemoryStorageFull){this.openMemoryStorageFullToast();return}el({insertTarget:this.props.insertTarget,openMemoryStorageFullToast:()=>{this.openMemoryStorageFullToast()}})}onViewCreate(){this.shouldShowUpdateTag=this.monicaClientConfig.enableAutoLearnForChat&&this.monicaClientConfig.hasNewMemorySuggestion,this.shouldShowUpdateTag&&(this.lastMemoryViewedAt=R.A.memorySuggestionLastViewedAt),this.monicaClientConfig.memoryMarkRead(),this.monicaClientConfig.fetchMemoryData({useCache:!1})}clearUpdateTag(){this.shouldShowUpdateTag=!1,this.lastMemoryViewedAt=null}onBeforeMount(){this.props.defaultTab&&(this.tab=this.props.defaultTab)}onViewDestroy(){}upgrade(){V.userController.upgrade("memory_unlock")}handleRejectAllSuggestion(){(0,Y.B)({title:this.S.rejectSuggestionTitle,content:this.S.rejectSuggestionContent,okText:this.S.reject,okBtnType:"danger",onOk:async()=>{try{return await this.monicaClientConfig.rejectAllMemorySuggestion(),!0}catch(e){Z.M.error(w.m.formatErrorMsg(e))}return!1},insertTarget:"mainWindow"})}openMemoryStorageFullToast(){let{close:e}=Z.M.info((0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:x.tipsHd,children:[(0,r.jsx)(J,{size:24}),(0,r.jsx)("div",{className:x.tipsTitle,children:this.S.storageFull}),(0,r.jsxs)("span",{className:x.manageBtn,onClick:()=>{this.toggleTab("manageMemory"),e()},children:[(0,r.jsx)(k.e,{size:16,color:"var(--theme-icon-tertiary)"}),this.S.manage]})]}),(0,r.jsx)("div",{className:x.tipsSubtitle,children:this.S.storageFullSubtitle})]}),this.props.insertTarget||"mainWindow",3,{className:x.acceptWarning,icon:(0,r.jsx)(r.Fragment,{})})}constructor(...e){super(...e),(0,d._)(this,"props",void 0),(0,d._)(this,"tab","homeView"),(0,d._)(this,"tabHistory",[]),(0,d._)(this,"shouldShowUpdateTag",!1),(0,d._)(this,"lastMemoryViewedAt",null)}}(0,U.gn)([n.SB],ec.prototype,"tab",void 0),(0,U.gn)([n.SB],ec.prototype,"tabHistory",void 0),(0,U.gn)([n.SB],ec.prototype,"shouldShowUpdateTag",void 0),(0,U.gn)([n.SB],ec.prototype,"lastMemoryViewedAt",void 0),(0,U.gn)([z.Fl],ec.prototype,"S",null),(0,U.gn)([z.Fl],ec.prototype,"modelList",null),(0,U.gn)([z.Fl],ec.prototype,"showBackIcon",null),(0,U.gn)([z.Fl],ec.prototype,"isMemoryStorageFull",null),ec=(0,U.gn)([n.Tt],ec);class em extends n.PN{get monicaClientConfig(){return this.memoryDrawerVm.monicaClientConfig}get S(){return f.S.Global.modules.ChatBox.MemoryDrawer.MemorySwitch}get isVipUser(){return V.userController.isVipUser}onViewCreate(){}onViewDestroy(){}constructor(...e){super(...e),(0,d._)(this,"props",void 0),(0,d._)(this,"memoryDrawerVm",(0,n.qp)(ec))}}(0,U.gn)([n.Do],em.prototype,"memoryDrawerVm",void 0),(0,U.gn)([n.Fl],em.prototype,"S",null),(0,U.gn)([n.Fl],em.prototype,"isVipUser",null);let ed=n._Y.createComponent("MemorySwitch",em,e=>{let{type:t,size:o}=e.props;if("memory"===t){let t=!!e.isVipUser&&e.monicaClientConfig.enableAutoLearnForChat;return(0,r.jsx)(W.r,{size:o,enabled:t,tooltip:e.isVipUser?void 0:e.S.upgrade,disabled:!e.isVipUser,onChange:t=>{O.W.createUserBehaviorEvent({eventName:"memory_drawer_switch",extData:{module:"auto_learn",value:t}}),e.monicaClientConfig.toggleAutoLearn(t)}})}if("personalized"===t){let t=!!e.isVipUser&&e.monicaClientConfig.enablePersonalizedMemory;return(0,r.jsx)(W.r,{size:o,enabled:t,tooltip:e.isVipUser?void 0:e.S.upgrade,disabled:!e.isVipUser,onChange:t=>{O.W.createUserBehaviorEvent({eventName:"memory_drawer_switch",extData:{module:"personalized_memory",value:t}}),e.monicaClientConfig.toggleEnablePersonalizedMemory(t)}})}return null});var eh={memoryDrawerHomeView:"memory-drawer-home-view--ERTmo",subtitle:"subtitle--ZG_eb",memoryContentWrapper:"memory-content-wrapper--iCIVR",freeUserWrapper:"free-user-wrapper--KAeYQ",cardContainer:"card-container--LPY4b",cardSwitch:"card-switch--G9FVp",cardSwitchLabel:"card-switch-label--WlFQ9",cardSwitchLabelText:"card-switch-label-text--WhjGP",divider:"divider--Govcr",cardFooter:"card-footer--yptLF",cardFooterLeft:"card-footer-left--XSdQ3",cardFooterRight:"card-footer-right--kGyzv",memoryUpdateTag:"memory-update-tag--izUD7",memoryListCard:"memory-list-card--haozB",personalizeMemoryCard:"personalize-memory-card--AcerI",customInstructionTitle:"custom-instruction-title--qmKFp",recentUpdates:"recent-updates--XVy9y",suggestionCard:"suggestion-card--zvYwC",suggestionCardLeft:"suggestion-card-left--VOqgW",newMemoryTag:"new-memory-tag--_1EMl",upgradeBox:"upgrade-box--hJfEX",benefitText:"benefit-text--_ZdZ3",upgradeButton:"upgrade-button--UfewP",link:"link--ylzEr"},ep=o(20978);class eu extends n.PN{get monicaClientConfig(){return this.memoryDrawerVm.monicaClientConfig}get S(){return f.S.Global.modules.ChatBox.MemoryDrawer.MemoryDrawerHomeView}get isVipUser(){return V.userController.isVipUser}get showMemoryUpdateTag(){return this.memoryDrawerVm.shouldShowUpdateTag}get modelList(){return((null===B.serverConfigController||void 0===B.serverConfigController?void 0:B.serverConfigController.getStaticConfig("monicaModelList"))||[]).filter(e=>e.capabilities.includes("memory"))}get memoryItems(){var e;return(null===(e=this.monicaClientConfig.memoryInfo)||void 0===e?void 0:e.itemList)||[]}get enableCustomContext(){return Q.T.ctxMode===X.p5.Custom}toggleMemory(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.monicaClientConfig.toggleSkill("memory",e,!0,t)}onViewCreate(){var e,t;this.instructionValue=(null===(e=this.monicaClientConfig.memoryInfo)||void 0===e?void 0:e.instruction)||"",this.responsePreferenceValue=(null===(t=this.monicaClientConfig.memoryInfo)||void 0===t?void 0:t.responsePreference)||"",this.monicaClientConfig.updateMemorySuggestions("refresh")}onViewDestroy(){}constructor(...e){super(...e),(0,d._)(this,"props",void 0),(0,d._)(this,"memoryDrawerVm",(0,n.qp)(ec)),(0,d._)(this,"debouncedUpdateInstruction",(0,ep.Z)(()=>{this.monicaClientConfig.updateMemoryInstructionAndResponsePreference({instruction:this.instructionValue,responsePreference:this.responsePreferenceValue})},200)),(0,d._)(this,"instructionValue",""),(0,d._)(this,"responsePreferenceValue","")}}(0,U.gn)([n.Do],eu.prototype,"memoryDrawerVm",void 0),(0,U.gn)([n.SB],eu.prototype,"instructionValue",void 0),(0,U.gn)([n.SB],eu.prototype,"responsePreferenceValue",void 0),(0,U.gn)([n.Fl],eu.prototype,"S",null),(0,U.gn)([n.Fl],eu.prototype,"isVipUser",null),(0,U.gn)([n.Fl],eu.prototype,"showMemoryUpdateTag",null),(0,U.gn)([n.Fl],eu.prototype,"modelList",null),(0,U.gn)([n.Fl],eu.prototype,"memoryItems",null),(0,U.gn)([n.Fl],eu.prototype,"enableCustomContext",null);var eg=o(4461),ey=o(53040),eC={src:"https://assets.monica.im/home-web/_next/static/media/bigStar.c1112244.png",height:104,width:97,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAICAMAAAAC2hU0AAAAG1BMVEVMaXGsrOXNye3SzOuvtOugp+Sws+t/g9CHitakJO/NAAAACXRSTlMACiJlGU1YSGtmXkbzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAJElEQVR4nGNgQAAWRgjNxgQiGVmZmUEMRnYOiAADK4SCqwNxAAf9AEA/+cDmAAAAAElFTkSuQmCC",blurWidth:7,blurHeight:8},ev={src:"https://assets.monica.im/home-web/_next/static/media/smallStar.1ab9d264.png",height:62,width:59,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAADFBMVEVMaXGfo92foNze2OUna/gCAAAABHRSTlMAEzs6V01NOQAAAAlwSFlzAAALEwAACxMBAJqcGAAAACBJREFUeJxjYEAGjDCaCUYzM4PFGJmYmCCSMCmEYjAAAAPtABuB1eiCAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8},ex=o(93270),eS={memoryExample:"memory-example--z6zsY",starWrapper:"star-wrapper--MF4Ad",one:"one--FQ4WU",two:"two--TjsyR",header:"header--_4UIA",headerIcon:"header-icon--R8PGj",chat:"chat--AdT74",chatArrow:"chat-arrow--cNWJa",chatItem:"chat-item--Z7xqz",user:"user--j7ReQ",avatar:"avatar--r7__q",message:"message--m_Uqa",memoryUpdate:"memory-update--augQO",chatMemoryList:"chat-memory-list--TATMT",chatMemoryTitle:"chat-memory-title--WNC4E",chatMemoryItem:"chat-memory-item--AQPgQ",active:"active--QjCi_"};class ew extends n.PN{get S(){return f.S.Global.modules.ChatBox.MemoryDrawer.MemoryDrawerHomeView.MemoryExample}onViewCreate(){}onViewDestroy(){}constructor(...e){super(...e),(0,d._)(this,"props",void 0)}}(0,U.gn)([n.Fl],ew.prototype,"S",null);let ej=n._Y.createComponent("MemoryExample",ew,e=>(0,r.jsxs)("div",{className:eS.memoryExample,children:[(0,r.jsxs)("div",{className:eS.starWrapper,children:[(0,r.jsx)(ey.E,{src:(0,eg.Q)(eC),className:eS.one,alt:""}),(0,r.jsx)(ey.E,{src:(0,eg.Q)(ev),className:eS.two,alt:""})]}),(0,r.jsxs)("div",{className:eS.header,children:[(0,r.jsx)(ey.E,{className:eS.headerIcon,src:(0,eg.Q)(ex.Z),alt:""}),(0,r.jsx)("span",{className:eS.headerTitle,children:e.S.title})]}),(0,r.jsxs)("div",{className:eS.chat,children:[(0,r.jsx)("div",{className:eS.chatArrow,children:(0,r.jsx)(s.J,{name:"memoryLeftArrow",size:40})}),(0,r.jsxs)("div",{className:eS.chatItem,children:[(0,r.jsxs)("div",{className:eS.user,children:[(0,r.jsx)("div",{className:eS.avatar,children:(0,r.jsx)(s.J,{name:"person-d7gn9ah4",size:12,color:"currentColor",style:{color:"var(--theme-icon-brand)"}})}),(0,r.jsx)("span",{children:e.S.you})]}),(0,r.jsx)("div",{className:eS.message,children:e.S.userText})]}),(0,r.jsxs)("div",{className:eS.chatItem,children:[(0,r.jsxs)("div",{className:eS.user,children:[(0,r.jsx)(ey.E,{className:eS.avatar,src:(0,eg.Q)(ex.Z),alt:""}),(0,r.jsx)("span",{children:e.S.monica})]}),(0,r.jsxs)("div",{className:eS.message,children:[(0,r.jsxs)("div",{className:eS.memoryUpdate,children:[(0,r.jsx)(s.J,{name:"a41",size:12,color:"currentColor"}),(0,r.jsx)("span",{children:e.S.monicaUpdate})]}),(0,r.jsx)("span",{children:e.S.monicaText2})]})]})]}),(0,r.jsxs)("div",{className:eS.chatMemoryList,children:[(0,r.jsx)("div",{className:eS.chatMemoryTitle,children:e.S.memoryTitle}),(0,r.jsx)("div",{className:b()(eS.chatMemoryItem,eS.active),children:e.S.memoryContent1})]})]})),ef=n._Y.createComponent("MemoryDrawerHomeView",eu,e=>(0,r.jsxs)("div",{className:eh.memoryDrawerHomeView,children:[(0,r.jsx)(S.Z,{S:e.S.subtitle,components:{link:e=>(0,r.jsx)("a",{href:w.m.getHelpCenterPageUrl({},j.Qq),target:"_blank",className:eh.link,rel:"noreferrer",children:e})},className:eh.subtitle}),(0,r.jsx)(eN,{vm:e})]})),eN=(0,a.Pi)(function(e){let{vm:t}=e;return(0,r.jsxs)("div",{className:b()(eh.memoryContentWrapper,{[eh.freeUserWrapper]:!t.isVipUser}),children:[(0,r.jsx)(ek,{vm:t}),(0,r.jsx)(eb,{vm:t}),(0,r.jsx)(eT,{vm:t}),!t.isVipUser&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ej,{}),(0,r.jsx)(eM,{vm:t})]})]})}),eM=(0,a.Pi)(e=>{let{vm:t}=e;return(0,r.jsxs)("div",{className:eh.upgradeBox,children:[(0,r.jsx)("div",{className:eh.benefitText,children:(0,r.jsx)("span",{children:t.S.lockTips})}),(0,r.jsx)(E,{source:"memory",className:eh.upgradeButton})]})}),eb=(0,a.Pi)(function(e){let{vm:t}=e;return(0,r.jsxs)("div",{className:eh.memoryListCard,children:[(0,r.jsx)("div",{className:eh.cardContainer,children:(0,r.jsxs)("div",{className:eh.cardSwitch,children:[(0,r.jsxs)("div",{className:eh.cardSwitchLabel,children:[(0,r.jsx)("span",{className:eh.cardSwitchLabelText,children:t.S.learnFromChat}),(0,r.jsx)(T.B,{title:(0,r.jsx)(S.Z,{data:{models:t.modelList.map(e=>e.shortName).join(",")},S:t.S.memoryInfo,components:{b:e=>(0,r.jsx)("span",{style:{fontWeight:500},children:e})}}),size:16,color:"var(--theme-icon-quaternary)",style:{cursor:"help"}})]}),(0,r.jsx)(ed,{type:"memory",size:"l"})]})}),t.isVipUser&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:eh.cardFooter,onClick:()=>{t.memoryDrawerVm.toggleTab("manageMemory")},children:[(0,r.jsxs)("div",{className:eh.cardFooterLeft,children:[(0,r.jsx)(k.e,{size:16,color:"var(--theme-text-primary)"}),(0,r.jsx)("span",{children:t.S.manageMemory})]}),(0,r.jsxs)("div",{className:eh.cardFooterRight,children:[t.showMemoryUpdateTag&&(0,r.jsx)("div",{className:eh.memoryUpdateTag,children:t.S.memoryUpdated}),(0,r.jsx)("span",{className:eh.footerText,children:(0,f.x)(t.S.items,{count:t.memoryItems.length})}),(0,r.jsx)(D.X,{size:16,color:"var(--theme-icon-tertiary)"})]})]}),(0,r.jsx)("div",{className:eh.divider})]})]})}),eT=(0,a.Pi)(function(e){var t,o;let{vm:n}=e;return(0,r.jsxs)("div",{className:eh.personalizeMemoryCard,children:[(0,r.jsx)("div",{className:eh.cardContainer,children:(0,r.jsxs)("div",{className:eh.cardSwitch,children:[(0,r.jsxs)("div",{className:eh.cardSwitchLabel,children:[(0,r.jsx)("span",{className:eh.cardSwitchLabelText,children:n.S.personalized}),(0,r.jsx)(T.B,{title:n.S.personalizedDesc,size:16,color:"var(--theme-icon-quaternary)",style:{cursor:"help"}})]}),(0,r.jsx)(ed,{type:"personalized",size:"l"})]})}),n.isVipUser&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:eh.customInstructionTitle,children:[n.S.aboutYou,(0,r.jsx)(A.u,{title:n.S.aboutYouTips,children:(0,r.jsx)("span",{style:{display:"inline-flex",cursor:"help"},children:(0,r.jsx)(T.B,{size:16,color:"var(--theme-icon-quaternary)"})})})]}),(0,r.jsx)(er,{value:n.instructionValue,disabled:!n.monicaClientConfig.enablePersonalizedMemory,maxLength:n.enableCustomContext?1/0:n.monicaClientConfig.instructionMaxLength,onChange:e=>{n.instructionValue=e,n.debouncedUpdateInstruction()},placeholder:n.S.personalizedPlaceholder}),(null===(t=n.monicaClientConfig.memoryInfo)||void 0===t?void 0:t.instructionUpdatedTime)&&(0,r.jsxs)("div",{className:eh.recentUpdates,children:[(0,r.jsx)(_.T,{size:14,color:"var(--theme-icon-quaternary)"}),(0,f.x)(n.S.recentUpdate,{date:N.L.fromNow((null===(o=n.monicaClientConfig.memoryInfo)||void 0===o?void 0:o.instructionUpdatedTime)*1e3)})]}),(0,r.jsxs)("div",{className:eh.customInstructionTitle,children:[n.S.howRespond,(0,r.jsx)(A.u,{title:n.S.howRespondTips,children:(0,r.jsx)("span",{style:{display:"inline-flex",cursor:"help"},children:(0,r.jsx)(T.B,{size:16,color:"var(--theme-icon-quaternary)"})})})]}),(0,r.jsx)(er,{value:n.responsePreferenceValue,disabled:!n.monicaClientConfig.enablePersonalizedMemory,maxLength:n.enableCustomContext?1/0:n.monicaClientConfig.instructionMaxLength,onChange:e=>{n.responsePreferenceValue=e,n.debouncedUpdateInstruction()},placeholder:n.S.responsePreferencePlaceholder}),R.A.memoryResponsePreferenceUpdatedTime&&(0,r.jsxs)("div",{className:eh.recentUpdates,children:[(0,r.jsx)(_.T,{size:14,color:"var(--theme-icon-quaternary)"}),(0,f.x)(n.S.recentUpdate,{date:N.L.fromNow(1e3*R.A.memoryResponsePreferenceUpdatedTime)})]})]})]})}),ek=(0,a.Pi)(function(e){let{vm:t}=e,o=t.monicaClientConfig.memorySuggestionTotal;return 0===o?null:(0,r.jsxs)("div",{className:eh.suggestionCard,onClick:()=>{t.memoryDrawerVm.toggleTab("suggestion")},children:[(0,r.jsxs)("div",{className:eh.suggestionCardLeft,children:[(0,r.jsx)(u,{size:16,color:"var(--theme-icon-primary)"}),(0,r.jsx)("span",{children:t.S.memorySuggestion}),(0,r.jsx)("div",{className:eh.newMemoryTag,children:(0,f.x)(t.S.pending,{count:o})})]}),(0,r.jsx)("div",{className:eh.suggestionCardRight,children:t.S.view})]})});var eD=o(75372),eA=o(20995),e_=o(69645),eI=o(39052),eV=o(19393),eF=o(8209),eB={memoryManageView:"memory-manage-view--A12cR",header:"header--SzJAC",memoryItems:"memory-items--JwlrB",memoryItem:"memory-item--ezJvq",memoryContent:"memory-content--Vv6rz",memoryFt:"memory-ft--mcTWN",createdAt:"created-at--eABjm",empty:"empty--pb0HL",emptyIcon:"empty-icon--SH0V1",emptyText:"empty-text--GmZk2",dropdownMenu:"dropdown-menu--Vjc0T",deleteItem:"delete-item--NDp2Q",memoryContentBox:"memory-content-box--_BhX4"};class eL extends n.PN{get S(){return f.S.Global.modules.ChatBox.MemoryDrawer.MemoryMangeView}get memoryLimit(){return this.memoryItems.length>=this.monicaClientConfig.maxMemoryItems}get monicaClientConfig(){return this.memoryDrawerContentVm.monicaClientConfig}get memoryItems(){var e;return(null===(e=this.monicaClientConfig.memoryInfo)||void 0===e?void 0:e.itemList)||[]}get isEmptyMemoryItems(){return 0===this.memoryItems.length}handleEditMemoryItem(e){el({item:e,insertTarget:this.memoryDrawerContentVm.props.insertTarget||"mainWindow",openMemoryStorageFullToast:()=>{this.memoryDrawerContentVm.openMemoryStorageFullToast()}})}onViewCreate(){this.memoryDrawerContentVm.shouldShowUpdateTag&&this.memoryDrawerContentVm.lastMemoryViewedAt&&setTimeout(()=>{this.memoryDrawerContentVm.clearUpdateTag()},3e3)}onViewDestroy(){}constructor(...e){super(...e),(0,d._)(this,"props",void 0),(0,d._)(this,"memoryDrawerContentVm",(0,n.qp)(ec))}}(0,U.gn)([n.Do],eL.prototype,"memoryDrawerContentVm",void 0),(0,U.gn)([z.Fl],eL.prototype,"S",null),(0,U.gn)([z.Fl],eL.prototype,"memoryLimit",null),(0,U.gn)([z.Fl],eL.prototype,"monicaClientConfig",null),(0,U.gn)([z.Fl],eL.prototype,"memoryItems",null),(0,U.gn)([z.Fl],eL.prototype,"isEmptyMemoryItems",null);let eU=n._Y.createComponent("MemoryManageView",eL,e=>(0,r.jsxs)("div",{className:eB.memoryManageView,children:[(0,r.jsx)("div",{className:eB.header,children:(0,f.x)(e.S.memoryMangeDesc,{maxMemoryItems:e.monicaClientConfig.maxMemoryItems})}),(0,r.jsx)(ez,{vm:e})]})),ez=(0,a.Pi)(function(e){let{vm:t}=e;return t.isEmptyMemoryItems?(0,r.jsxs)("div",{className:eB.empty,children:[(0,r.jsx)(ey.E,{src:(0,eg.Q)(eF.Z),className:eB.emptyIcon}),(0,r.jsx)("span",{className:eB.emptyText,children:t.S.noMemory})]}):(0,r.jsx)("div",{className:eB.memoryItems,children:t.memoryItems.map(e=>(0,r.jsxs)("div",{className:b()(eB.memoryItem),children:[(0,r.jsx)("div",{className:eB.memoryContent,children:e.content}),(0,r.jsxs)("div",{className:eB.memoryFt,children:[(0,r.jsx)("div",{className:eB.createdAt,children:e.updatedTime&&N.L.fromNow(e.updatedTime)}),(0,r.jsx)(eD.x,{trigger:"click",placement:"bottomRight",closeAfterContentClick:!0,content:(0,r.jsxs)(eA.h,{width:120,className:eB.dropdownMenu,children:[(0,r.jsx)(e_.X,{icon:(0,r.jsx)(eI.a,{size:16,color:"currentColor"}),content:t.S.edit,onClick:()=>{t.handleEditMemoryItem(e)}}),(0,r.jsx)(e_.X,{className:eB.deleteItem,icon:(0,r.jsx)(l.X,{size:16,color:"currentColor"}),content:t.S.delete,onClick:()=>{(0,Y.B)({title:t.S.deleteMemoryTitle,content:(0,r.jsxs)(r.Fragment,{children:[t.S.deleteMemoryContent,(0,r.jsx)("div",{className:eB.memoryContentBox,children:e.content})]}),okText:t.S.delete,okBtnType:"danger",onOk:async()=>(await t.monicaClientConfig.deleteMemoryItem(e.id),!0),insertTarget:"mainWindow"})}})]}),children:(0,r.jsx)("div",{className:eB.actionItem,children:(0,r.jsx)(eV.X,{button:!0,size:16,color:"var(--theme-icon-tertiary)"})})})]})]},e.id))})});var eP=o(41672),eE=o(61658),eR=o(48994),eW=o(63134),eO={memorySuggestionItem:"memory-suggestion-item--wT5Hf",memorySuggestionContent:"memory-suggestion-content--rN5ef",memorySuggestionFt:"memory-suggestion-ft--szyRG",memorySuggestionTime:"memory-suggestion-time--v224V",danger:"danger--CUR1l",actionList:"action-list--M7NoE"},eY={regenerateMemoryDialog:"regenerate-memory-dialog--im1P4",dialogTitle:"dialog-title--CYxu_",dialogSubtitle:"dialog-subtitle--iQim1",footer:"footer--rkPe8",btn:"btn--lF6OI"},eZ=o(46756);class eH extends n.PN{get S(){return f.S.Global.modules.ChatBox.MemoryDrawer.RegenerateMemoryDialog}onViewCreate(){}onViewDestroy(){}async generate(){let e=this.value.trim();if(e){this.loading=!0;try{let{data:t}=await eZ.y.regenerateMemorySuggestion({comment:e,suggestionId:this.props.item.id});el({insertTarget:this.props.insertTarget,isSuggestion:!0,openMemoryStorageFullToast:()=>{var e,t;null===(e=(t=this.props).openMemoryStorageFullToast)||void 0===e||e.call(t)},item:{...this.props.item,newContent:t.newContent}}),this.props.onDisposed()}catch(e){Z.M.error(w.m.formatErrorMsg(e))}finally{this.loading=!1}}}constructor(...e){super(...e),(0,d._)(this,"props",void 0),(0,d._)(this,"promptMaxLength",200),(0,d._)(this,"value",""),(0,d._)(this,"loading",!1)}}(0,U.gn)([n.SB],eH.prototype,"value",void 0),(0,U.gn)([n.SB],eH.prototype,"loading",void 0),(0,U.gn)([n.Fl],eH.prototype,"S",null);let eG=n._Y.createComponent("RegenerateMemoryDialog",eH,e=>{let{onDisposed:t,insertTarget:o}=e.props;return(0,r.jsxs)(q.u,{width:360,className:eY.regenerateMemoryDialog,onDispose:()=>{t()},fixed:"dialogRoot"===o,children:[(0,r.jsx)("div",{className:eY.dialogTitle,children:e.S.dialogTitle}),(0,r.jsx)("div",{className:eY.dialogSubtitle,children:e.S.dialogSubtitle}),(0,r.jsx)($.W,{autoFocus:!0,value:e.value,onChange:t=>{e.value=t.target.value},rowsData:{min:6,max:6},placeholder:e.S.pleaseEnter,toolbar:{rightContent:(0,r.jsxs)("div",{className:eY.textCount,children:[e.value.length,"/",e.promptMaxLength]})}}),(0,r.jsxs)("div",{className:eY.footer,children:[(0,r.jsx)(I.z,{type:"gray",className:eY.btn,onClick:t,children:e.S.cancel}),(0,r.jsx)(I.z,{type:"primary",className:eY.btn,loading:e.loading,disabled:!e.value.trim(),onClick:()=>{e.generate()},children:e.S.regenerate})]})]})}),eJ=v.t.createOpener(eG);class eq extends n.PN{get S(){return f.S.Global.modules.ChatBox.MemoryDrawer.MemorySuggestionView}get monicaClientConfig(){return this.memoryDrawerContentVm.monicaClientConfig}onViewCreate(){}onViewDestroy(){}async handleRejectMemorySuggestion(){this.rejecting=!0;try{await this.monicaClientConfig.rejectMemorySuggestion({suggestionId:this.props.item.id}),Z.M.error(this.S.rejectSuccess,"mainWindow")}catch(e){Z.M.error(w.m.formatErrorMsg(e))}finally{this.rejecting=!1}}handleRegenerateMemorySuggestion(){eJ({insertTarget:this.memoryDrawerContentVm.props.insertTarget||"mainWindow",item:this.props.item,openMemoryStorageFullToast:()=>{this.memoryDrawerContentVm.openMemoryStorageFullToast()}})}handleEditMemorySuggestion(){el({insertTarget:this.memoryDrawerContentVm.props.insertTarget||"mainWindow",item:this.props.item,isSuggestion:!0,openMemoryStorageFullToast:()=>{this.memoryDrawerContentVm.openMemoryStorageFullToast()}})}async handleAdoptMemorySuggestion(){if(this.memoryDrawerContentVm.isMemoryStorageFull){this.memoryDrawerContentVm.openMemoryStorageFullToast();return}this.accepting=!0;try{await this.monicaClientConfig.acceptMemorySuggestion({content:this.props.item.newContent,suggestionId:this.props.item.id}),Z.M.success(this.S.adoptSuccess)}catch(e){Z.M.error(w.m.formatErrorMsg(e))}finally{this.accepting=!1}}constructor(...e){super(...e),(0,d._)(this,"props",void 0),(0,d._)(this,"memoryDrawerContentVm",(0,n.qp)(ec)),(0,d._)(this,"accepting",!1),(0,d._)(this,"rejecting",!1)}}(0,U.gn)([n.Do],eq.prototype,"memoryDrawerContentVm",void 0),(0,U.gn)([n.SB],eq.prototype,"accepting",void 0),(0,U.gn)([n.SB],eq.prototype,"rejecting",void 0),(0,U.gn)([n.Fl],eq.prototype,"S",null);let eQ=n._Y.createComponent("MemorySuggestionItem",eq,e=>{let{item:t}=e.props,o="add"===t.action,n="delete"===t.action,i="update"===t.action;return(0,r.jsxs)("div",{className:eO.memorySuggestionItem,children:[(0,r.jsx)("div",{className:eO.memorySuggestionContent,children:i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:e.S.before}),t.oldContent]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:e.S.after}),t.newContent]})]}):n?(0,r.jsx)("p",{children:t.oldContent}):o?(0,r.jsx)("p",{children:t.newContent}):null}),(0,r.jsxs)("div",{className:eO.memorySuggestionFt,children:[t.createdAt&&(0,r.jsx)("div",{className:eO.memorySuggestionTime,children:(0,r.jsx)(S.Z,{S:o?e.S.addedTime:n?e.S.forgetTime:e.S.updatedTime,data:{date:N.L.fromNow(t.createdAt)},components:{danger:e=>(0,r.jsx)("span",{className:eO.danger,children:e})}})}),(0,r.jsxs)("div",{className:eO.actionList,children:[!n&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eR.D,{button:!0,title:e.S.regenerate,size:16,color:"var(--theme-icon-tertiary)",onClick:()=>{e.handleRegenerateMemorySuggestion()}}),(0,r.jsx)(eI.a,{button:!0,title:e.S.edit,size:16,color:"var(--theme-icon-tertiary)",onClick:()=>{e.handleEditMemorySuggestion()}})]}),(0,r.jsx)(g.w,{button:!0,title:e.S.reject,size:16,color:"var(--theme-icon-tertiary)",onClick:()=>{e.handleRejectMemorySuggestion()}}),(0,r.jsx)(eW.n,{button:!0,title:e.S.adopt,size:16,isLoading:e.accepting,color:"var(--theme-function-success)",onClick:()=>{e.handleAdoptMemorySuggestion()}})]})]})]})});var eX={memorySuggestionView:"memory-suggestion-view--mzgvt",header:"header--oIzd7",bold:"bold--qbb_G",empty:"empty--p1IAL",emptyIcon:"empty-icon--MkKo6",emptyText:"empty-text--a334d",memorySuggestionItems:"memory-suggestion-items--JB5tx"};class eK extends n.PN{handleMemoryItemsChange(){0===this.memoryItems.length&&this.memoryDrawerContentVm.handleBack()}get S(){return f.S.Global.modules.ChatBox.MemoryDrawer.MemorySuggestionView}get monicaClientConfig(){return this.memoryDrawerContentVm.monicaClientConfig}get memoryItems(){return this.monicaClientConfig.memorySuggestionList}get isEmptyMemoryItems(){return 0===this.monicaClientConfig.memorySuggestionTotal}onViewCreate(){}onViewDestroy(){}constructor(...e){super(...e),(0,d._)(this,"props",void 0),(0,d._)(this,"memoryDrawerContentVm",(0,n.qp)(ec))}}(0,U.gn)([n.Do],eK.prototype,"memoryDrawerContentVm",void 0),(0,U.gn)([(0,n.YP)(e=>[e.memoryItems])],eK.prototype,"handleMemoryItemsChange",null),(0,U.gn)([n.Fl],eK.prototype,"S",null),(0,U.gn)([n.Fl],eK.prototype,"monicaClientConfig",null),(0,U.gn)([n.Fl],eK.prototype,"memoryItems",null),(0,U.gn)([n.Fl],eK.prototype,"isEmptyMemoryItems",null);let e$=n._Y.createComponent("MemorySuggestionView",eK,e=>(0,r.jsxs)("div",{className:eX.memorySuggestionView,children:[(0,r.jsx)("div",{className:eX.header,children:(0,r.jsx)(S.Z,{S:e.S.memorySuggestionDesc,components:{b:e=>(0,r.jsx)("span",{className:eX.bold,children:e})}})}),(0,r.jsx)(e0,{vm:e})]})),e0=(0,a.Pi)(function(e){let{vm:t}=e;return t.isEmptyMemoryItems?(0,r.jsxs)("div",{className:eX.empty,children:[(0,r.jsx)(ey.E,{src:(0,eg.Q)(eF.Z),className:eX.emptyIcon}),(0,r.jsx)("span",{className:eX.emptyText,children:t.S.noMemorySuggestion})]}):(0,r.jsx)(eP.v,{hasMore:t.monicaClientConfig.memorySuggestionTotal>t.memoryItems.length,dataLength:t.memoryItems.length,className:eX.memorySuggestionItems,next:()=>{t.monicaClientConfig.updateMemorySuggestions("append")},loader:(0,r.jsx)(eE.g,{type:"geist"}),children:t.memoryItems.map(e=>(0,r.jsx)(eQ,{item:e},e.id))})}),e1=n._Y.createComponent("MemoryDrawer",ec,e=>(0,r.jsx)(i.d,{closeWhenEsc:!0,visible:!0,onDispose:()=>{e.props.onDisposed()},height:"max-content",className:x.memoryDrawer,bodyClassName:x.memoryDrawerBody,title:(0,r.jsx)(e2,{vm:e}),titleClassName:x.drawerTitle,headerStyle:{paddingBottom:8,gap:12},enableHorizontalStyle:!0,closeIconProps:{size:20,color:"var(--theme-icon-secondary)"},children:(0,r.jsx)(e9,{vm:e})})),e9=(0,a.Pi)(function(e){let{vm:t}=e;return"homeView"===t.tab?(0,r.jsx)(ef,{}):"manageMemory"===t.tab?(0,r.jsx)(eU,{}):"suggestion"===t.tab?(0,r.jsx)(e$,{}):null}),e2=(0,a.Pi)(function(e){let{vm:t}=e;if("homeView"===t.tab)return(0,r.jsx)(e4,{vm:t,title:t.S.title,leftSlot:(0,r.jsxs)("div",{className:x.proIco,children:[(0,r.jsx)(s.J,{name:"memory-pro",size:12}),(0,r.jsx)("span",{children:"Pro"})]})});if("manageMemory"===t.tab){var o,n;let e=(null===(n=t.monicaClientConfig.memoryInfo)||void 0===n?void 0:null===(o=n.itemList)||void 0===o?void 0:o.length)===0;return(0,r.jsx)(e4,{vm:t,title:t.S.manageMemory,rightSlot:(0,r.jsxs)(r.Fragment,{children:[!e&&(0,r.jsx)(l.X,{title:t.S.clearMemory,button:!0,size:20,color:"var(--theme-icon-secondary)",onClick:()=>{t.handleClearMemory()}}),(0,r.jsx)(c.a,{size:20,color:"var(--theme-icon-secondary)",title:t.S.createMemory,button:!0,onClick:()=>{t.handleCreateMemory()}})]})})}if("suggestion"===t.tab){let e=0===t.monicaClientConfig.memorySuggestionTotal;return(0,r.jsx)(e4,{vm:t,title:t.S.memorySuggestion,icon:(0,r.jsx)(u,{size:24,color:"var(--theme-icon-primary)"}),rightSlot:(0,r.jsxs)(r.Fragment,{children:[!e&&(0,r.jsx)(g.w,{button:!0,title:t.S.rejectAll,size:20,color:"var(--theme-icon-secondary)",onClick:()=>{t.handleRejectAllSuggestion()}}),(0,r.jsx)(y.k,{button:!0,title:t.S.manageMemory,size:20,color:"var(--theme-icon-secondary)",onClick:()=>{t.toggleTab("manageMemory")}})]})})}return null}),e4=(0,a.Pi)(function(e){let{vm:t,leftSlot:o,rightSlot:n,title:i,icon:a}=e;return(0,r.jsxs)("div",{className:x.memoryDrawerTitle,children:[(0,r.jsxs)("div",{className:x.memoryDrawerTitleLeft,children:[t.showBackIcon?(0,r.jsx)("div",{className:x.backIcon,onClick:()=>{t.handleBack()},children:(0,r.jsx)(C.w,{size:24,color:"var(--theme-icon-secondary)"})}):a,(0,r.jsx)("span",{className:x.title,children:i}),o]}),n&&(0,r.jsx)("div",{className:x.memoryDrawerTitleRight,children:n})]})}),e5=v.t.createOpener(e1)},23701:function(e,t,o){o.d(t,{h:function(){return u}});var r=o(71576),n=o(34491),i=o(92386),a=o(78716),s=o.n(a),l=o(35076),c={mindMapForChat:"mind-map-for-chat--Pt9_T",loading:"loading--tynHZ",fullWidth:"full-width--BOrbi",inner:"inner--_VjgO",sub:"sub--xr8A7",rootLine:"root-line--fENYU",subLine:"sub-line--RWjC8",node:"node--6cU0u"},m=o(66084),d=o(52921),h=o(93724);class p extends n.PN{onViewCreate(){}onViewDestroy(){}constructor(...e){super(...e),(0,m._)(this,"props",void 0),(0,m._)(this,"mindMapEditorManager",new h.nC),(0,m._)(this,"someState",!0)}}(0,d.gn)([n.SB],p.prototype,"someState",void 0);let u=n._Y.createComponent("MindMapForChat",p,e=>{let{data:t,className:o,allowFullWidth:n,onFullscreen:a}=e.props,m=!(null==t?void 0:t.data.text);return t&&e.mindMapEditorManager.setData(t),(0,r.jsxs)("div",{className:s()(c.mindMapForChat,o,{[c.fullWidth]:n,[c.loading]:m}),onClick:()=>{m||null==a||a()},children:[m&&(0,r.jsx)("div",{className:c.loading,children:(0,r.jsxs)("div",{className:c.inner,children:[(0,r.jsx)(i.Z.Button,{active:!0,block:!0,className:s()(c.node)}),(0,r.jsx)("div",{className:c.rootLine}),(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"31",height:"114",viewBox:"0 0 31 114",fill:"none",className:c.subLine,children:(0,r.jsx)("path",{d:"M31 2H10C5.58172 2 2 5.58172 2 10V104C2 108.418 5.58172 112 10 112H31",stroke:"#E9E9E9",strokeWidth:"3"})}),(0,r.jsxs)("div",{className:c.sub,children:[(0,r.jsx)(i.Z.Button,{active:!0,block:!0,className:s()(c.node)}),(0,r.jsx)(i.Z.Button,{active:!0,block:!0,className:s()(c.node)}),(0,r.jsx)(i.Z.Button,{active:!0,block:!0,className:s()(c.node)})]})]})}),(0,r.jsx)(l.c,{readonly:!0,autoFit:!0,disableMouse:!0,noControls:!0,manager:e.mindMapEditorManager})]})})}}]);