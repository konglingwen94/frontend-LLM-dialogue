"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4604],{71376:function(e,t){t.Z={tooltip:"tooltip--XrkP6","light-mode":"light-mode--DbpHV",lightMode:"light-mode--DbpHV","ignore-max-width":"ignore-max-width--L1ENM",ignoreMaxWidth:"ignore-max-width--L1ENM"}},77233:function(e,t,a){a.d(t,{T:function(){return o}});var n=a(66084),i=a(37067);class o{init(e){var t;this.options=e,i.I.getProxy(this,document).addEventListener("keydown",e=>{var t,a;null===(t=(a=this.options).handleKeydown)||void 0===t||t.call(a,e)},{capture:!0}),null===(t=e.keydownContainer)||void 0===t||t.forEach(e=>{i.I.getProxy(this,e).addEventListener("keydown",e=>{var t,a;null===(t=(a=this.options).handleKeydown)||void 0===t||t.call(a,e)})})}destroy(){var e;i.I.getProxy(this,document).removeAllListeners(),null===(e=this.options.keydownContainer)||void 0===e||e.forEach(e=>{i.I.getProxy(this,e).removeAllListeners()})}constructor(){(0,n._)(this,"options",void 0)}}},71528:function(e,t,a){a.d(t,{M:function(){return i}});var n=a(66084);class i{addWindowEventListener(e,t,a){window.addEventListener(e,t,a),this.windowEventListeners.push({event:e,func:t,options:a})}addDocumentEventListener(e,t,a){document.addEventListener(e,t,a),this.documentListeners.push({event:e,func:t,options:a})}removeAll(){this.documentListeners.forEach(e=>{let{event:t,func:a,options:n}=e;document.removeEventListener(t,a,n)}),this.windowEventListeners.forEach(e=>{let{event:t,func:a,options:n}=e;window.removeEventListener(t,a,n)}),this.documentListeners=[],this.windowEventListeners=[]}constructor(){(0,n._)(this,"documentListeners",[]),(0,n._)(this,"windowEventListeners",[])}}},28901:function(e,t,a){a.d(t,{x:function(){return l}});var n=a(52354),i=a(56554),o=a(92660),r=a(56607);class s{getPossibleElementByQuerySelector(e){for(let t of e){let e=document.querySelector(t);if(e)return e}return null}getScrollableRoot(){return"scroll"===getComputedStyle(document.body).overflowY?document.body:document.documentElement}setInlineStyle(e,t){Object.assign(e.style,t)}removeAllNodeAfterTarget(e,t){let a=!1,n=(e,t)=>{if(a){e.remove();return}if(e.className===t.className){a=!0,e.remove();return}0!==e.childNodes.length&&e.childNodes.forEach(e=>{n(e,t)})};n(e,t)}triggerInputEvent(e,t,a){switch(e){case"textarea":this.triggerTextareaInputEvent(t,a);break;case"contenteditable":this.triggerContentEditableInputEvent(t,a)}}triggerTextareaInputEvent(e,t){let a=e.ownerDocument;e.select(),(0!==e.selectionStart||e.selectionEnd!==e.value.length)&&e.select(),a.execCommand("insertText",!1,t)}getParents(e,t,a){if(e.matches(t))return e;let n=1;for(;e.parentElement;){if(e.parentElement.matches(t))return e.parentElement;if(e=e.parentElement,n++,a&&n>a)break}return null}findCommonParentsElByNodes(e){if(0===e.length)return null;if(1===e.length)return e[0].parentElement;let t=e[0].parentElement;for(;t&&!e.every(e=>null==t?void 0:t.contains(e));)t=t.parentElement;return t}escapeHTML(e){let t=["SUB","SUP","PRE","CODE","MATH","AIO-CODE"];try{let a={},n=0,i=e;return["SCRIPT","IMG","SVG"].forEach(e=>{let t=RegExp("<".concat(e,"[^>]*>.*?</").concat(e,">|<").concat(e,"[^>]*/>"),"gis");i=i.replace(t,e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"))}),i.replace(RegExp("(<(?:".concat(t.join("|"),")(?:\\s[^>]*)?>)[\\s\\S]*?(</(?:").concat(t.join("|"),")>)"),"gi"),e=>{let t="__PRESERVED_".concat(n,"__");return a[t]=e,n++,t}).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/__PRESERVED_\d+__/g,e=>a[e])}catch(t){return e}}updateTDK(e){if(r.o.isChatPDF)return;let t=document.querySelector("title");if(t&&(t.innerHTML=e.title),e.description||""===e.description){let t=document.querySelector('meta[name="description"]');t&&t.setAttribute("content",e.description)}}preventDefault(e){e.preventDefault()}stopPropagation(e){e.stopPropagation()}onSafeScroll(e,t){let a=e=>{t(e)};return e.addEventListener("scroll",a),()=>{e.removeEventListener("scroll",a)}}syncScroll(e,t){if(!e||!t)return i.Z;e.scrollTop=t.scrollTop=Math.max(e.scrollTop,t.scrollTop);let a=this.onSafeScroll(e,()=>{t.scrollTo({top:e.scrollTop,left:e.scrollLeft})}),n=this.onSafeScroll(t,()=>{e.scrollTo({top:t.scrollTop,left:t.scrollLeft})});return()=>{a(),n()}}checkTooltip(e){let t=e.target;t.clientWidth>=t.scrollWidth&&t.clientHeight>=t.scrollHeight&&(t.style.pointerEvents="none")}triggerContentEditableInputEvent(e,t){}findAccessibleDocuments(){let e=[];return document.querySelectorAll("iframe").forEach(t=>{try{var a;let n=null===(a=t.contentWindow)||void 0===a?void 0:a.document;n&&e.push(n)}catch(e){}}),[document,...e]}calculateIframePosition(e){let t=e.ownerDocument.defaultView;if(null==t?void 0:t.parent){let t=(e=>{let t=document.querySelectorAll("iframe");for(let a=0;a<t.length;a++){let n=t[a],i=n.contentDocument;if(null==i?void 0:i.contains(e))return n}return null})(e);if(t){let{left:e,right:a,top:n,bottom:i}=t.getBoundingClientRect();return{left:e,right:a,top:n,bottom:i}}}return{left:0,right:0,top:0,bottom:0}}getTextContent(e){let t="",a=[],n=["style","script","template","link","data","picture","meta","noscript"],i=[o.rA.WRITING_ENTRY_BTN_ROOT_ID];return!function e(o){let r=o.childNodes;for(let o=0;o<r.length;o++){let s=r[o];if(s.nodeType===Node.TEXT_NODE){let e=t.length,n=(t+=s.textContent).length-1;n>e&&a.push({el:s,position:[e,n]})}else if(s.nodeType===Node.ELEMENT_NODE){if(n.some(e=>e.toLocaleUpperCase()===s.tagName)||n.some(e=>e===s.id)||s.dataset.monicaIgnore||i.includes(s.id))continue;"BR"===s.tagName?t+="\n":getComputedStyle(s).display.includes("inline")?e(s):(t+="\n",e(s),t+="\n")}}}(e),{text:t,textElements:a}}checkVisibility(e){let{checkOpacity:t=!1,checkVisibilityCSS:a=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("function"==typeof e.checkVisibility)return e.checkVisibility({checkOpacity:t,checkVisibilityCSS:a});if(!e.isConnected)return!1;let n=getComputedStyle(e);if("contents"===n.getPropertyValue("display")||a&&"visible"!==n.getPropertyValue("visibility"))return!1;let i=e;for(;i;){let a=i===e?n:getComputedStyle(i);if("none"===a.getPropertyValue("display")||t&&"0"===a.getPropertyValue("opacity")||i!==e&&"hidden"===a.getPropertyValue("content-visibility"))return!1;i=!i.parentElement&&i.getRootNode() instanceof ShadowRoot?i.getRootNode().host:i.parentElement}return!0}calculateOverlapPosition(e,t){return function(e,t){let a=(e,t)=>e-t<0?0:e-t;return{left:t.left-e.left,top:a(t.top,e.top),right:e.right-t.right,bottom:a(e.bottom,t.bottom)}}(e.getBoundingClientRect(),t.getBoundingClientRect())}getScrollbarWidth(e){return e.offsetWidth-e.clientWidth}checkElIsInViewport(e){return new Promise(t=>{new IntersectionObserver((e,a)=>{t(e.some(e=>e.intersectionRatio>0&&(a.disconnect(),!0)))}).observe(e)})}readSvgFileAsText(e){return new Promise((t,a)=>{let n=new FileReader;n.onload=()=>t(n.result),n.onerror=()=>a(Error("Failed to read file")),n.readAsText(e)})}async escapeSvg(e){let t=await this.readSvgFileAsText(e),a=n.Z.sanitize(t,{USE_PROFILES:{svg:!0,svgFilters:!0}});return new File([a],e.name,{type:"image/svg+xml",lastModified:new Date().getTime()})}}let l=new s},51018:function(e,t,a){a.d(t,{c:function(){return r}});var n=a(3147),i=a.n(n);class o{parsePartialJson(e){try{return JSON.parse(e)}catch(e){}let t="",a=[],n=!1,o=!1;for(let i=0;i<e.length;i++){let r=e[i];if(n)'"'!==r||o?"\n"!==r||o?o="\\"===r&&!o:r="\\n":n=!1;else if('"'===r)n=!0,o=!1;else if("{"===r)a.push("}");else if("["===r)a.push("]");else if("}"===r||"]"===r){if(!a||a[a.length-1]!==r)return;a.pop()}t+=r}n&&(t+='"');for(let e=a.length-1;e>=0;e--)t+=a[e];try{return i().parse(t)}catch(e){return}}}let r=new o},37067:function(e,t,a){a.d(t,{I:function(){return o}});var n=a(66084);class i{getProxy(e,t,a){if(!t&&!a)throw Error("must specify target or targetLabel");let n=this.getStore(e),i=a||this.getTargetId(n,t);return t&&!n.targets[i]&&(n.targets[i]=t,n.listeners[i]=[]),{addEventListener(e,t){for(var a=arguments.length,o=Array(a>2?a-2:0),r=2;r<a;r++)o[r-2]=arguments[r];n.listeners[i].push({event:e,handler:t,extra:o}),n.targets[i].addEventListener(e,t,...o)},removeAllListeners(){n.listeners[i].forEach(e=>{let{event:t,handler:a,extra:o}=e;n.targets[i].removeEventListener(t,a,...o)}),delete n.targets[i],delete n.listeners[i]}}}getTargetId(e,t){for(let a of Object.keys(e.targets))if(e.targets[a]===t)return a;return"_".concat(++i.idCounter)}getStore(e){let t="__listenerHelperStore";if(e[t])return e[t];let a={listeners:{},targets:{}};return e[t]=a,a}}(0,n._)(i,"idCounter",0);let o=new i},95782:function(e,t,a){a.d(t,{Z:function(){return d}});var n=a(71576),i=a(34491),o=a(75087),r=a(88882),s=a(66084),l=a(52921);class c extends i.PN{onViewCreate(){}onViewDestroy(){}getRenderFragment(e){let t=[],a=[],n=this.props.components;if(n){let t=Object.keys(n);for(let n=0;n<t.length;n++){let i;let o=t[n],r=RegExp("<".concat(o,">([\\s\\S]*?)</").concat(o,">"),"g");for(;i=r.exec(e);)a.push({startIndex:i.index,endIndex:i.index+i[0].length,compName:o,renderText:i[1]})}a.sort((e,t)=>e.startIndex-t.startIndex)}if(0===a.length)t.push({type:"text",text:e});else{let n=0;for(let i=0;i<a.length;i++){let{startIndex:o,endIndex:r,compName:s,renderText:l}=a[i];o>n&&t.push({type:"text",text:e.slice(n,o)}),t.push({type:"component",compName:s,renderText:l}),n=r}n<e.length&&t.push({type:"text",text:e.slice(n)})}return t}constructor(...e){super(...e),(0,s._)(this,"props",void 0),(0,s._)(this,"someState",!0)}}(0,l.gn)([i.SB],c.prototype,"someState",void 0);let d=i._Y.createComponent("Translations",c,e=>{let{S:t,components:a,className:i,style:s}=e.props,l=(0,r.x)(t,e.props.data||{}),c=e.getRenderFragment(l),d=e=>{if("text"===e.type)return e.text;if("component"===e.type){let t=null==a?void 0:a[e.compName];return t?t(e.renderText):"<".concat(e.compName,">").concat(e.renderText,"</").concat(e.compName,">")}return null};return i||s?(0,n.jsx)("div",{className:i,style:s,children:c.map((e,t)=>(0,n.jsx)(o.Fragment,{children:d(e)},t))}):(0,n.jsx)(n.Fragment,{children:c.map((e,t)=>(0,n.jsx)(o.Fragment,{children:d(e)},t))})})},5857:function(e,t,a){a.d(t,{z:function(){return m}});var n=a(71576),i=a(34491),o=a(46731),r=a(88882),s=a(78716),l=a.n(s),c=a(61658),d={"monica-btn":"monica-btn--ucd8b",monicaBtn:"monica-btn--ucd8b",icon:"icon--htncs",show:"show--vM_wi","end-icon":"end-icon--P2DsG",endIcon:"end-icon--P2DsG","loading-circle":"loading-circle--B6lda",loadingCircle:"loading-circle--B6lda",circle:"circle--O_olb","geist-loading":"geist-loading--kJfq6",geistLoading:"geist-loading--kJfq6","size-default":"size-default--CD739",sizeDefault:"size-default--CD739","size-medium":"size-medium--bUzGp",sizeMedium:"size-medium--bUzGp","size-overMedium":"size-overMedium--MRqsn",sizeOverMedium:"size-overMedium--MRqsn","size-large":"size-large--iaJCW",sizeLarge:"size-large--iaJCW","size-extraLarge":"size-extraLarge--bXRTQ",sizeExtraLarge:"size-extraLarge--bXRTQ","size-small":"size-small--eF0i7",sizeSmall:"size-small--eF0i7","size-text-btn":"size-text-btn--WVPra",sizeTextBtn:"size-text-btn--WVPra","shape-round":"shape-round--cUvZu",shapeRound:"shape-round--cUvZu","no-border":"no-border--wDJ92",noBorder:"no-border--wDJ92",rtl:"rtl--bzep5",primary:"primary--xcgg3",disabled:"disabled--comji",loading:"loading--y1xdl",outline:"outline--OX7gI","primary-outline":"primary-outline--ELJt9",primaryOutline:"primary-outline--ELJt9","brand-outline":"brand-outline--Y5zQR",brandOutline:"brand-outline--Y5zQR",black:"black--jFvrf","black-outline":"black-outline--QYp7f",blackOutline:"black-outline--QYp7f",gray:"gray--l5obh","disable-click":"disable-click--nLDDE",disableClick:"disable-click--nLDDE",brand:"brand--Cq_2w","light-gray":"light-gray--tnVxw",lightGray:"light-gray--tnVxw","text-gray":"text-gray--FMmhK",textGray:"text-gray--FMmhK",danger:"danger--s5gqA","danger-outline":"danger-outline--xN_JX",dangerOutline:"danger-outline--xN_JX","text-primary":"text-primary--_2zgH",textPrimary:"text-primary--_2zgH",orange:"orange--_tSa0","green-outline":"green-outline--znNjt",greenOutline:"green-outline--znNjt","primary-gradient":"primary-gradient--OokxO",primaryGradient:"primary-gradient--OokxO","purple-outline":"purple-outline--msi6x",purpleOutline:"purple-outline--msi6x","black-gradient":"black-gradient--TpC5U",blackGradient:"black-gradient--TpC5U","gray-blue8":"gray-blue8--KDALp",grayBlue8:"gray-blue8--KDALp","gray-outline":"gray-outline--ksph4",grayOutline:"gray-outline--ksph4","purple-gradient":"purple-gradient--lsU88",purpleGradient:"purple-gradient--lsU88","link-primary":"link-primary--PMaCg",linkPrimary:"link-primary--PMaCg",default:"default--axhr9",text:"text--El6LZ",soft:"soft--E9NP8",link:"link--mdnYg",active:"active--bkU8j",secondary:"secondary--SPS0n","ani-sheen":"ani-sheen--CVtPu",aniSheen:"ani-sheen--CVtPu",sheen:"sheen--fEO3x"},u=a(66084),h=a(52921);class p extends i.PN{onViewCreate(){var e,t;null===(e=(t=this.props).onCreate)||void 0===e||e.call(t)}onViewDestroy(){}constructor(...e){super(...e),(0,u._)(this,"props",void 0),(0,u._)(this,"someState",!0)}}(0,h.gn)([i.SB],p.prototype,"someState",void 0);let m=i._Y.createComponent("Button",p,e=>{let{disabled:t,loading:a,type:i="default",size:s="default",color:u="secondary",shape:h="default",animation:p,icon:m,endIcon:g,onClick:v,onMouseDown:f,onMouseEnter:y,onMouseLeave:b,disableClick:C=!1,noBorder:S,geistLoading:I,geistLoadingColor:k,iconSize:w,loadingCls:T,getRef:x}=e.props,P="text-gray"===i||"text-primary"===i,_=I?(0,n.jsx)("span",{className:d.geistLoading,children:(0,n.jsx)(c.g,{type:"geist",color:k||"var(--theme-icon-white-primary)"})}):(0,n.jsx)("span",{className:l()(d.icon,d.loadingCircle,{[d.show]:a},T)});return(0,n.jsxs)("div",{className:l()(d.monicaBtn,d[i],d[u],{[d["size-".concat(s)]]:!P,[d.sizeTextBtn]:P,[d.disabled]:t,[d.loading]:a,[d.disableClick]:C,[d.noBorder]:S,[d.shapeRound]:"round"===h,[d["ani-".concat(p)]]:p,[d.rtl]:r.a.rtl},e.props.className),ref:x,style:e.props.style,onClick:e=>{t||a||C||null==v||v(e)},onMouseDown:e=>{null==f||f(e)},onMouseEnter:y,onMouseLeave:b,children:[a?_:m?(0,n.jsx)("span",{className:l()(d.icon,{[d.show]:!a&&m}),style:{marginRight:e.props.children?void 0:0,...e.props.iconStyle},children:"string"==typeof m?(0,n.jsx)(o.J,{color:"currentColor",size:w,name:m}):m}):null,e.props.children,g?(0,n.jsx)("span",{className:d.endIcon,children:"string"==typeof g?(0,n.jsx)(o.J,{color:"currentColor",size:w,name:g}):g}):null]})})},27534:function(e,t,a){a.d(t,{h:function(){return h}});var n=a(71576),i=a(34491),o=a(78716),r=a.n(o),s=a(46731),l=a(48023),c=a(66084),d=a(52921);class u extends i.PN{onViewCreate(){}onViewDestroy(){}constructor(...e){super(...e),(0,c._)(this,"props",void 0),(0,c._)(this,"someState",!0)}}(0,d.gn)([i.SB],u.prototype,"someState",void 0);let h=i._Y.createComponent("IconButton",u,e=>{let{iconName:t,onClick:a,onMousedown:i,title:o,iconSize:c=16,className:d,color:u="var(--theme-icon-quaternary)",padding:h=3,iconClassName:p,isActive:m,style:g,disabled:v,useParentContainer:f,placement:y,mouseLeaveDelay:b}=e.props;return(0,n.jsx)(l.u,{title:o,mouseLeaveDelay:null!=b?b:0,useParentContainer:f,placement:y,children:(0,n.jsx)("span",{className:r()("icon-button--t0FB2",{"active--r2rdt":m,"disabled--vRtXq":v},d),style:{...g,color:u,padding:h},onMouseDown:e=>{v||null==i||i(e)},onClick:e=>{v||null==a||a(e)},children:(0,n.jsx)(s.J,{name:t,color:"currentColor",size:c,className:p})})})})},92128:function(e,t,a){a.d(t,{M:function(){return O}});var n=a(71576),i=a(34491),o=a(68104),r=a(75372),s=a(46731),l=a(48023),c=a(87291),d=a(61658),u=a(5857),h=a(27534),p=a(663),m=a(18918),g=a(82005),v=a(47720),f=a(21320),y=a(92660),b=a(88882),C=a(95782),S=a(92235),I=a(60445),k=a(90175),w=a(78716),T=a.n(w),x=a(62499),P={buySeatDialog:"buy-seat-dialog--qwNF3",dialogTitle:"dialog-title--DqiEm",formItemCategory:"form-item-category--r2IhR",currentSubscription:"current-subscription--PYQ1_",subscriptionInfo:"subscription-info--t6n2b",formItem:"form-item--E7h2R",formLabel:"form-label--KaVHc",formContent:"form-content--VvJwt",planSwitcher:"plan-switcher--BMrdV",open:"open--t5QWD",planSwitcherValue:"plan-switcher-value--uKMAq",planSwitcherArrow:"plan-switcher-arrow--XfqXk",dividerForTotal:"divider-for-total--zSlOC",total:"total--bP7bk",lt:"lt--ZdoTG",totalLabel:"total-label--CLVZ_",discountLabel:"discount-label--ycPvm",help:"help--TYz3S",rt:"rt--xKJzZ",footerTips:"footer-tips--hbqEl",footer:"footer--KtE1M",button:"button--KxHrA",planPopoverContent:"plan-popover-content--IemJ4",planItem:"plan-item--GN_S8",selected:"selected--xk3n2",seatInputWrap:"seat-input-wrap--FHaLI",seatInput:"seat-input--cKfYa",seatPrice:"seat-price--MMVCW",originPrice:"origin-price--Ih0QS",currentPrice:"current-price--yzxlF",acceptInviteCheckoutDialog:"accept-invite-checkout-dialog--HCGkc",dialogDesc:"dialog-desc--zCiJE",form:"form--pshuA",formHeader:"form-header--kBpbJ",plan:"plan--Ssxc2",commonDesc:"common-desc--c0StP",formBody:"form-body--pJrs6",formItemLabel:"form-item-label--ykiLu",totalPrice:"total-price--LAsWb",priceTips:"price-tips--rxP9X",confirmButton:"confirm-button--oQYI7"},_=a(66084),L=a(52921),M=a(33381),D=a(15851),A=a(92578),N=a(54560),E=a(7472),j=a(34891);class B extends i.PN{get S(){return b.S.Global.components.BuySeatDialog}get totalSeats(){var e,t;return"new_checkout"===this.props.type?(null===(t=m.teamController.uncreatedTeamInfo)||void 0===t?void 0:t.totalSeats)||0:(null===(e=m.teamController.currentTeamInfo)||void 0===e?void 0:e.totalSeats)||0}get unusedSeats(){var e;return this.totalSeats-((null===(e=m.teamController.currentTeamInfo)||void 0===e?void 0:e.usedSeats)||0)}get targetSeatCount(){return"from_invite"===this.props.upgradeCheckoutUiType?p.m.teamSeatCount-this.unusedSeats+this.totalSeats:"from_increase"===this.props.upgradeCheckoutUiType?p.m.teamSeatCount+this.totalSeats:p.m.teamSeatCount}get currentSubscriptionTeamInfo(){return"new_checkout"===this.props.type?m.teamController.uncreatedTeamInfo:m.teamController.currentTeamInfo}onViewCreate(){var e,t;A.l.manualLoadPaddle(),p.m.teamInterval=(null===(e=this.currentSubscriptionTeamInfo)||void 0===e?void 0:e.interval)||"year","from_upgrade_subscribe"===this.props.upgradeCheckoutUiType&&(p.m.teamInterval="year"),this.props.defaultMinSeatCount?p.m.teamSeatCountInputMinValue=this.props.defaultMinSeatCount:("from_increase"===this.props.upgradeCheckoutUiType?p.m.teamSeatCount=1:p.m.teamSeatCount=(null===(t=this.currentSubscriptionTeamInfo)||void 0===t?void 0:t.totalSeats)||1,this.updateSeatCount()),this.props.defaultSeatCount&&p.m.setSeatCount(this.props.defaultSeatCount),this.upgradePreviewPrice()}onViewDestroy(){"new_checkout"===this.props.type&&"from_locked"!==this.props.upgradeCheckoutUiType&&(0,E.L)({insertTarget:this.props.insertTarget,isNewTeam:!0}),"from_locked"===this.props.upgradeCheckoutUiType&&m.teamController.updateUnCreatedTeamInfo()}handleBack(){this.props.onDisposed()}async handleConfirm(){try{var e,t,a,n,i;if(this.btnLoading)return;let{upgradeCheckoutUiType:o="default"}=this.props;if(this.btnLoading=!0,"from_locked"!==this.props.upgradeCheckoutUiType&&!await this.confirmUpgrade()){this.btnLoading=!1;return}let r=await p.m.upgradeTeamSubscription({seatCount:this.targetSeatCount,ownerUserId:null===(e=this.currentSubscriptionTeamInfo)||void 0===e?void 0:e.ownerUserId,teamId:null===(t=this.currentSubscriptionTeamInfo)||void 0===t?void 0:t.teamId});"auto_modify"===r.type||"success"===r.type?("new_checkout"===this.props.type?(m.teamController.updateUnCreatedTeamInfo({...m.teamController.uncreatedTeamInfo,totalSeats:this.targetSeatCount,nextBillingTime:this.nextBillingDate/1e3,interval:p.m.teamInterval}),"default"===o?(0,E.L)({insertTarget:this.props.insertTarget,isNewTeam:!0}):"from_locked"===o&&(window.location.href=S.m.genFullUrl(I.Cl.teamBilling))):((null===(a=this.currentSubscriptionTeamInfo)||void 0===a?void 0:a.interval)!==p.m.teamInterval&&await M.userController.fetchVipStatus(),m.teamController.updateCurrentTeamInfo(),null===(n=(i=this.props).onSuccess)||void 0===n||n.call(i),"from_increase"===this.props.upgradeCheckoutUiType&&D.M.success(this.S.purchaseSuccessful)),this.props.onDisposed()):"canceled"===r.type?this.btnLoading=!1:"error"===r.type&&(this.btnLoading=!1,D.M.error(r.message,"dialogRoot"))}catch(e){this.btnLoading=!1,D.M.error(S.m.formatMonicaSdkError(e),"dialogRoot")}}async upgradePreviewPrice(){try{var e,t;this.previewLoading=!0,this.previewTaskId+=1;let a=this.previewTaskId,n="from_locked"===this.props.upgradeCheckoutUiType?void 0:null===(e=this.currentSubscriptionTeamInfo)||void 0===e?void 0:e.teamId,i="from_locked"===this.props.upgradeCheckoutUiType?void 0:null===(t=this.currentSubscriptionTeamInfo)||void 0===t?void 0:t.ownerUserId,o=await N.u.upgradePreview({planKey:p.m.teamPlanKey,teamSubscribeParams:{seatCount:this.targetSeatCount,teamId:n,ownerUserId:i}});if(a!==this.previewTaskId)return;this.nextBillingDate=o.nextChargeDate,this.amountDisplay=o.amountDisplay.replace("USD ","US$"),this.amount=o.amount,this.previewLoading=!1}catch(e){D.M.error(S.m.formatMonicaSdkError(e),"dialogRoot"),this.amountDisplay="-",this.previewLoading=!1}}handleIntervalChange(e){p.m.teamInterval=e,this.updateSeatCount(),this.upgradePreviewPrice()}updateSeatCount(){if("from_increase"===this.props.upgradeCheckoutUiType)p.m.teamSeatCountInputMinValue=1;else{var e;p.m.teamSeatCountInputMinValue=(null===(e=this.currentSubscriptionTeamInfo)||void 0===e?void 0:e.totalSeats)||1}p.m.setSeatCount(p.m.teamSeatCount)}async confirmUpgrade(){return new Promise(e=>{(0,j.B)({title:this.S.payConfirmTitle,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{children:this.S.payConfirmDesc1}),(0,n.jsx)("p",{children:this.S.payConfirmDesc2})]}),okText:this.S.payConfirmBtnText,insertTarget:this.props.insertTarget,onOk:()=>(e(!0),!0),onCancel:()=>{e(!1)}})})}constructor(...e){super(...e),(0,_._)(this,"props",void 0),(0,_._)(this,"nextBillingDate",0),(0,_._)(this,"planPopoverOpen",!1),(0,_._)(this,"btnLoading",!1),(0,_._)(this,"previewLoading",!1),(0,_._)(this,"amountDisplay","-"),(0,_._)(this,"amount",0),(0,_._)(this,"previewTaskId",0)}}(0,L.gn)([i.SB],B.prototype,"nextBillingDate",void 0),(0,L.gn)([i.SB],B.prototype,"planPopoverOpen",void 0),(0,L.gn)([i.SB],B.prototype,"btnLoading",void 0),(0,L.gn)([i.SB],B.prototype,"previewLoading",void 0),(0,L.gn)([i.SB],B.prototype,"amountDisplay",void 0),(0,L.gn)([i.SB],B.prototype,"amount",void 0),(0,L.gn)([i.Fl],B.prototype,"S",null),(0,L.gn)([i.Fl],B.prototype,"totalSeats",null),(0,L.gn)([i.Fl],B.prototype,"unusedSeats",null),(0,L.gn)([i.Fl],B.prototype,"targetSeatCount",null),(0,L.gn)([i.Fl],B.prototype,"currentSubscriptionTeamInfo",null);let R=i._Y.createComponent("BuySeatDialog",B,e=>{var t,a,i,h,g;if("from_invite"===e.props.upgradeCheckoutUiType)return(0,n.jsx)(F,{vm:e});let b=(0,n.jsx)("div",{className:P.planPopoverContent,children:v.serverConfigController.teamPlanList.map(t=>{let{key:a,interval:i}=t;return(0,n.jsx)("div",{className:T()(P.planItem,{[P.selected]:i===p.m.teamInterval}),onClick:()=>{e.handleIntervalChange(i)},children:m.teamController.getDisplayPlanName(i)},a)})}),C="from_locked"===e.props.upgradeCheckoutUiType,S="from_increase"===e.props.upgradeCheckoutUiType,I="new_checkout"===e.props.type||S||C;return(0,n.jsxs)(o.u,{fixed:!0,width:520,className:P.buySeatDialog,closeIconVisible:!I&&!e.btnLoading,onDispose:e.props.onDisposed,children:[(0,n.jsx)("div",{className:P.dialogTitle,children:C?e.S.dialogTitleForLocked:S?e.S.purchaseAdditionalSeats:e.S.dialogTitle}),(0,n.jsx)("div",{className:P.formItemCategory,children:C?e.S.expiredSubscription:e.S.currentSubscription}),(0,n.jsxs)("div",{className:P.currentSubscription,children:[(0,n.jsxs)("div",{className:P.formItem,children:[(0,n.jsx)("div",{className:P.formLabel,children:e.S.subscriptionPlan}),(0,n.jsx)("div",{className:P.formContent,children:(null===(t=e.currentSubscriptionTeamInfo)||void 0===t?void 0:t.interval)?m.teamController.getDisplayPlanName(null===(a=e.currentSubscriptionTeamInfo)||void 0===a?void 0:a.interval):"-"})]}),(0,n.jsxs)("div",{className:P.formItem,children:[(0,n.jsx)("div",{className:P.formLabel,children:C?e.S.expiredDate:e.S.nextBillingDate}),(0,n.jsx)("div",{className:P.formContent,children:(null===(i=e.currentSubscriptionTeamInfo)||void 0===i?void 0:i.nextBillingTime)?f.L.formatTime(1e3*e.currentSubscriptionTeamInfo.nextBillingTime,"MM/DD/YYYY"):"-"})]}),(0,n.jsxs)("div",{className:P.formItem,children:[(0,n.jsx)("div",{className:P.formLabel,children:S?e.S.existingTeamSeats:e.S.teamSeats}),(0,n.jsx)("div",{className:P.formContent,children:(null===(h=e.currentSubscriptionTeamInfo)||void 0===h?void 0:h.totalSeats)||"-"})]})]}),(0,n.jsx)("div",{className:P.formItemCategory,children:C?e.S.resubscribeSubscription:S?e.S.additionalPurchaseInformation:e.S.subscriptionInfo}),(0,n.jsxs)("div",{className:P.subscriptionInfo,children:[(0,n.jsxs)("div",{className:P.formItem,style:{alignItems:"center"},children:[(0,n.jsx)("div",{className:P.formLabel,children:e.S.subscriptionPlan}),(0,n.jsx)("div",{className:P.formContent,children:(null===(g=e.currentSubscriptionTeamInfo)||void 0===g?void 0:g.interval)!=="year"?(0,n.jsx)(r.x,{closeAfterContentClick:!0,trigger:"click",placement:"bottom",content:b,open:e.planPopoverOpen,onOpenChange:t=>{e.planPopoverOpen=t},triggerNode:(0,n.jsxs)("div",{className:T()(P.planSwitcher,{[P.open]:e.planPopoverOpen}),children:[(0,n.jsx)("span",{className:P.planSwitcherValue,children:m.teamController.getDisplayPlanName(p.m.teamInterval)}),(0,n.jsx)(s.J,{name:y.UZ.lineDirectionArrowDown,className:T()(P.planSwitcherArrow,{[P.open]:e.planPopoverOpen})})]})}):m.teamController.getDisplayPlanName(p.m.teamInterval)})]}),(0,n.jsxs)("div",{className:P.formItem,children:[(0,n.jsx)("div",{className:P.formLabel,children:S?e.S.addTamSeats:e.S.teamSeats}),(0,n.jsx)("div",{className:P.formContent,children:(0,n.jsx)(U,{vm:e})})]}),(0,n.jsxs)("div",{className:P.formItem,children:[(0,n.jsx)("div",{className:P.formLabel,children:e.S.nextBillingDate}),(0,n.jsx)("div",{className:P.formContent,children:e.nextBillingDate?f.L.formatTime(e.nextBillingDate,"MM/DD/YYYY"):"-"})]}),(0,n.jsxs)("div",{className:P.formItem,children:[(0,n.jsx)("div",{className:P.formLabel,children:e.S.seatPrice}),(0,n.jsx)("div",{className:P.formContent,children:(0,n.jsx)(z,{vm:e})})]})]}),(0,n.jsx)("div",{className:P.dividerForTotal}),(0,n.jsxs)("div",{className:P.total,children:[(0,n.jsxs)("div",{className:P.lt,children:[(0,n.jsx)("div",{className:P.totalLabel,children:e.S.total}),!C&&(0,n.jsxs)("span",{className:P.discountLabel,children:[e.S.discount,(0,n.jsx)(l.u,{title:e.S.totalTips,children:(0,n.jsx)("span",{className:P.help,children:(0,n.jsx)(c.b,{size:14})})})]})]}),(0,n.jsx)("div",{className:P.rt,children:e.previewLoading?(0,n.jsx)(d.g,{}):(0,n.jsx)("div",{className:P.totalPrice,children:e.amountDisplay})})]}),S&&(0,n.jsx)("p",{className:P.footerTips,children:e.S.purchaseTips}),(0,n.jsxs)("div",{className:P.footer,children:[I&&(0,n.jsx)(u.z,{size:"large",className:P.button,onClick:()=>{e.handleBack()},children:C||S?e.S.cancel:e.S.back}),(0,n.jsx)(u.z,{size:"large",type:"primary",className:P.button,disabled:e.btnLoading||0===e.amount,loading:e.btnLoading||p.m.teamPlanPreviewLoading,onClick:()=>{e.handleConfirm()},children:S?e.S.confirmPurchase:e.S.confirm})]})]})}),F=(0,x.Pi)(function(e){let{vm:t}=e,a=t.S.AcceptInviteCheckoutDialog;return(0,n.jsxs)(o.u,{fixed:!0,width:560,closeIconVisible:!t.btnLoading,className:P.acceptInviteCheckoutDialog,onDispose:t.props.onDisposed,children:[(0,n.jsx)("div",{className:P.dialogTitle,children:a.dialogTitle}),(0,n.jsx)("p",{className:P.dialogDesc,children:a.dialogDesc}),(0,n.jsxs)("div",{className:P.form,children:[(0,n.jsxs)("div",{className:P.formHeader,children:[(0,n.jsx)("div",{className:P.plan,children:m.teamController.getDisplayPlanName(p.m.teamInterval)}),(0,n.jsxs)("span",{className:P.commonDesc,children:[a.billingDate,t.nextBillingDate?f.L.formatTime(t.nextBillingDate,"MM/DD/YYYY"):"-"]})]}),(0,n.jsxs)("div",{className:P.formBody,children:[(0,n.jsxs)("div",{className:P.formItem,children:[(0,n.jsxs)("div",{className:P.formItemLabel,children:[(0,n.jsx)("div",{className:P.formLabel,children:a.addMember}),t.unusedSeats>0&&(0,n.jsxs)("div",{className:P.commonDesc,children:[a.freeSeats,Math.abs(t.unusedSeats),(0,n.jsx)(l.u,{title:(0,b.x)(a.freeSeatsTips,{count:t.unusedSeats}),children:(0,n.jsx)("span",{className:P.help,children:(0,n.jsx)(c.b,{size:14})})})]})]}),(0,n.jsx)("div",{className:P.formContent,children:(0,n.jsx)(U,{vm:t})})]}),(0,n.jsxs)("div",{className:P.formItem,children:[(0,n.jsx)("div",{className:P.formItemLabel,children:(0,n.jsx)("div",{className:P.formLabel,children:t.S.seatPrice})}),(0,n.jsx)("div",{className:P.formContent,children:(0,n.jsx)(z,{vm:t})})]}),(0,n.jsxs)("div",{className:P.total,children:[(0,n.jsxs)("div",{className:P.totalLabel,children:[(0,n.jsx)("div",{children:t.S.total}),(0,n.jsxs)("div",{className:P.commonDesc,children:[(0,n.jsx)("span",{children:a.discount}),(0,n.jsx)(l.u,{title:t.S.totalTips,children:(0,n.jsx)("span",{className:P.help,children:(0,n.jsx)(c.b,{size:14})})})]})]}),(0,n.jsx)("div",{className:P.totalPrice,children:t.previewLoading?(0,n.jsx)(d.g,{}):(0,n.jsx)("strong",{children:t.amountDisplay})})]})]})]}),(0,n.jsx)("p",{className:P.priceTips,children:(0,n.jsx)(C.Z,{S:a.priceTips,components:{a:e=>(0,n.jsx)("a",{href:S.m.genFullUrl(I.Cl.mailLanding),target:"_blank",rel:"noreferrer",children:e})}})}),(0,n.jsx)(u.z,{size:"large",type:"primary",className:P.confirmButton,disabled:t.btnLoading||0===t.amount,loading:t.btnLoading||p.m.teamPlanPreviewLoading,onClick:()=>{t.handleConfirm()},children:a.buySeat})]})}),U=(0,x.Pi)(function(e){let{vm:t}=e;return(0,n.jsxs)("div",{className:P.seatInputWrap,children:[(0,n.jsx)(h.h,{iconName:"patSub",title:"",disabled:p.m.decreaseSeatCountDisabled,onClick:()=>{p.m.setSeatCount(p.m.teamSeatCount-1),t.upgradePreviewPrice()}}),(0,n.jsx)(k.Z,{className:P.seatInput,type:"number",min:p.m.teamSeatCountInputMinValue,max:p.m.teamSeatCountInputMaxValue,controls:!1,value:p.m.teamSeatCount,onChange:e=>{null!==e&&(p.m.setSeatCount(e),t.upgradePreviewPrice())}}),(0,n.jsx)(h.h,{iconName:"patAdd",title:"",disabled:p.m.increaseSeatCountDisabled,color:"var(--theme-icon-secondary)",onClick:()=>{p.m.setSeatCount(p.m.teamSeatCount+1),t.upgradePreviewPrice()}})]})}),z=(0,x.Pi)(function(e){let{vm:t}=e;return(0,n.jsxs)("div",{className:P.seatPrice,children:["year"===p.m.teamInterval&&(0,n.jsx)("span",{className:P.originPrice,children:p.m.teamPriceInfo.originMoPrice}),(0,n.jsxs)("span",{className:P.currentPrice,children:[(0,n.jsx)("strong",{children:p.m.teamPriceInfo.moPrice}),t.S.monthPrice]})]})}),O=g.t.createOpener(R)},7472:function(e,t,a){a.d(t,{L:function(){return P}});var n=a(71576),i=a(34491),o=a(68104),r=a(46731),s=a(37231),l=a(5857),c=a(18918),d=a(82005),u=a(21320),h=a(78716),p=a.n(h),m=a(25157),g={createTeamDialog:"create-team-dialog--k7cLW",title:"title--tIPFz",desc:"desc--Nm4zU",logo:"logo--DbOhm",editIcon:"edit-icon--yAO64",logoPlaceholder:"logo-placeholder--SukkQ",formItem:"form-item--qjNYw",col:"col--P9_0c",formItemLabel:"form-item-label--pADsi",formItemContent:"form-item-content--SylLO",changePlan:"change-plan--h54o4",subscriptionForm:"subscription-form--E_KJm",primaryButton:"primary-button--hDBbv"},v=a(66084),f=a(52921),y=a(88882),b=a(92235),C=a(92660),S=a(15851),I=a(34889),k=a(57434),w=a(92128);class T extends i.PN{get S(){return y.S.Global.components.CreateTeamDialog}get createBtnDisabled(){return!this.name.trim()}onViewCreate(){c.teamController.uncreatedTeamInfo&&(this.name=c.teamController.uncreatedTeamInfo.teamName||c.teamController.createTeamInfo.name,this.teamLogo=c.teamController.uncreatedTeamInfo.teamAvatar||c.teamController.createTeamInfo.logoUrl)}onViewDestroy(){}handleSelectLogo(){let e=["image/jpeg","image/png","image/jpg"];b.m.selectFile(async t=>{let a=t[0];if(!e.includes(a.type)){console.warn("Not supported file type");return}let n=await b.m.compressImageSize(a,180);if(n.size>819200){S.M.error(this.S.uploadLimit);return}this.teamLogo=URL.createObjectURL(n)},{accept:e})}openModifySubscription(){c.teamController.createTeamInfo={logoUrl:this.teamLogo,name:this.name.trim()},this.props.onDisposed(),(0,w.M)({insertTarget:this.props.insertTarget,type:"new_checkout",upgradeCheckoutUiType:"from_upgrade_subscribe"})}async handleCreate(){if(c.teamController.uncreatedTeamInfo&&!this.createBtnDisabled){if(this.creating=!0,this.teamLogo&&!this.teamLogo.startsWith("https://"))try{let e=await fetch(this.teamLogo).then(e=>e.blob()),t="team_logo",a=new File([e],t,{type:e.type,lastModified:Date.now()}),{preSignedUrl:n,cdnUrl:i}=await I.Gi.getS3PreSignedModuleUrl({filename:t,module:"user_avatar"});await I.Gi.uploadFileToS3(n,a,()=>{}),this.teamLogo=i,c.teamController.createTeamInfo={logoUrl:"",name:""}}catch(e){S.M.error(b.m.formatErrorMsg(e)),this.creating=!1;return}try{let{data:e}=await k.Yl.createTeamComplete({teamId:c.teamController.uncreatedTeamInfo.teamId,teamName:this.name.trim(),teamAvatarUrl:this.teamLogo}),{teamId:t}=e.teamInfo;window.localStorage.removeItem(C.storageKeys.hasUncreatedTeam),await c.teamController.selectWorkspace({teamId:t,userId:e.ownerUserId});let a=c.teamController.genTeamMemberPageUrl({dialog:"credits"});window.location.href=a}catch(e){S.M.error(b.m.formatErrorMsg(e))}finally{this.creating=!1}}}constructor(...e){super(...e),(0,v._)(this,"props",void 0),(0,v._)(this,"name",""),(0,v._)(this,"teamLogo",""),(0,v._)(this,"creating",!1)}}(0,f.gn)([i.SB],T.prototype,"name",void 0),(0,f.gn)([i.SB],T.prototype,"teamLogo",void 0),(0,f.gn)([i.SB],T.prototype,"creating",void 0),(0,f.gn)([i.Fl],T.prototype,"S",null),(0,f.gn)([i.Fl],T.prototype,"createBtnDisabled",null);let x=i._Y.createComponent("CreateTeamDialog",T,e=>{let{onDisposed:t,isNewTeam:a}=e.props;return c.teamController.uncreatedTeamInfo?(0,n.jsxs)(o.u,{fixed:!0,width:480,onDispose:t,className:g.createTeamDialog,closeOnMaskClick:!1,closeIconVisible:!1,children:[(0,n.jsx)("div",{className:g.title,children:a?e.S.dialogTitle:e.S.dialogTitleForContinue}),(0,n.jsx)("p",{className:g.desc,children:a?e.S.dialogDesc:e.S.dialogDescForContinue}),(0,n.jsx)("div",{className:g.logo,onClick:()=>{e.handleSelectLogo()},children:e.teamLogo?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.I,{size:60,src:e.teamLogo,radius:60}),(0,n.jsx)("span",{className:g.editIcon,children:(0,n.jsx)(r.J,{name:"sPen",color:"currentColor",size:14})})]}):(0,n.jsx)("div",{className:g.logoPlaceholder,children:(0,n.jsx)(r.J,{name:"tupian-jia",color:"currentColor"})})}),(0,n.jsxs)("div",{className:p()(g.formItem,g.col),children:[(0,n.jsxs)("div",{className:g.formItemLabel,children:[e.S.teamName,"*"]}),(0,n.jsx)("div",{className:g.formContent,children:(0,n.jsx)(s.I,{className:g.teamNameInput,placeholder:e.S.placeholder,value:e.name,size:"large",originInputProps:{maxLength:100,autoFocus:!0},onChange:t=>{e.name=t},onEnterWithoutCtrl:()=>{e.handleCreate()}})})]}),(0,n.jsxs)("div",{className:p()(g.formItem,g.col),children:[(0,n.jsxs)("div",{className:g.formItemLabel,children:[e.S.subscriptionPlan,(0,n.jsx)("span",{className:g.changePlan,onClick:()=>{e.openModifySubscription()},children:e.S.changePlan})]}),(0,n.jsx)("div",{className:g.formContent,children:(0,n.jsxs)("div",{className:g.subscriptionForm,children:[(0,n.jsxs)("div",{className:g.formItem,children:[(0,n.jsx)("div",{className:g.formItemLabel,children:e.S.subscriptionPlan}),(0,n.jsx)("div",{className:g.formItemContent,children:c.teamController.uncreatedTeamInfo.interval?c.teamController.getDisplayPlanName(c.teamController.uncreatedTeamInfo.interval):"-"})]}),(0,n.jsxs)("div",{className:g.formItem,children:[(0,n.jsx)("div",{className:g.formItemLabel,children:e.S.nextBillingDate}),(0,n.jsx)("div",{className:g.formItemContent,children:c.teamController.uncreatedTeamInfo.nextBillingTime?u.L.formatTime(1e3*c.teamController.uncreatedTeamInfo.nextBillingTime,"MM/DD/YYYY"):"-"})]}),(0,n.jsxs)("div",{className:g.formItem,children:[(0,n.jsx)("div",{className:g.formItemLabel,children:e.S.teamSeats}),(0,n.jsx)("div",{className:g.formItemContent,children:c.teamController.uncreatedTeamInfo.totalSeats||"-"})]})]})})]}),(0,n.jsx)(l.z,{size:"large",type:"primary",disabled:e.createBtnDisabled,loading:e.creating,className:g.primaryButton,onClick:()=>{e.handleCreate()},children:e.S.next})]}):null}),P=d.t.createOpener(x)},53040:function(e,t,a){a.d(t,{E:function(){return C}});var n=a(71576),i=a(34491),o=a(4461),r=a(46731),s=a(82005),l=a(92235),c=a(92386),d=a(13763),u=a(51715),h=a(78716),p=a.n(h),m=a(75087),g={imgWrapper:"img-wrapper--qb9Cd",tools:"tools--zkP9o",skeleton:"skeleton--giuH5",toolItem:"tool-item--hhI1e",placeholder:"placeholder--Mg2dK",hideImage:"hide-image--O0W7T"},v=a(66084),f=a(52921),y=a(24900);class b extends i.PN{onViewCreate(){this.el&&this.props.lazyload?(this.inViewObserver=new IntersectionObserver(e=>{if(e[0].intersectionRatio>0){var t;if(this.inView=!0,null===(t=this.inViewObserver)||void 0===t||t.disconnect(),this.inViewObserver=null,!this.props.src){this.serverFetched=!0;return}this.props.useServiceFetch&&y.Tn.fetchMedia((0,o.Q)(this.props.src)).then(e=>{this.blobUrl="data:".concat(this.props.type||"image/png",";base64,").concat(e)}).catch(e=>{}).finally(()=>{this.serverFetched=!0})}}),this.inViewObserver.observe(this.el)):this.inView=!0,this.props.useServiceFetch||(this.serverFetched=!0)}onViewDestroy(){var e;null===(e=this.inViewObserver)||void 0===e||e.disconnect(),this.inViewObserver=null}getResponsiveStyle(){return this.props.responsive&&this.props.maxWidth&&this.props.maxHeight?this.aspect<1?{width:this.props.maxHeight*this.aspect,height:this.props.maxHeight}:{width:this.props.maxWidth,height:this.props.maxWidth/this.aspect}:{}}calcViewMode(e,t){e&&t&&(this.aspect=Math.min(Math.max(e/t,.5),2))}constructor(...e){super(...e),(0,v._)(this,"props",void 0),(0,v._)(this,"el",null),(0,v._)(this,"inViewObserver",null),(0,v._)(this,"inView",!1),(0,v._)(this,"blobUrl",""),(0,v._)(this,"isError",!1),(0,v._)(this,"imagLoaded",!1),(0,v._)(this,"serverFetched",!1),(0,v._)(this,"originImagLoaded",!1),(0,v._)(this,"aspect",1),(0,v._)(this,"imgEl",null),(0,v._)(this,"antdImgEl",null)}}(0,f.gn)([i.SB],b.prototype,"inView",void 0),(0,f.gn)([i.SB],b.prototype,"blobUrl",void 0),(0,f.gn)([i.SB],b.prototype,"isError",void 0),(0,f.gn)([i.SB],b.prototype,"imagLoaded",void 0),(0,f.gn)([i.SB],b.prototype,"serverFetched",void 0),(0,f.gn)([i.SB],b.prototype,"originImagLoaded",void 0),(0,f.gn)([i.SB],b.prototype,"aspect",void 0);let C=i._Y.createComponent("Image",b,e=>{let{className:t,skeletonCls:a,loadingCls:i,defaultSrc:h,thumbnailSrc:v,src:f,style:y,skeleton:b,allowPreview:C,allowDownload:S,previewUrl:I,onDownload:k,onErrorImageClick:w,previewOptions:T,usePlaceholder:x,responsive:P,lazyload:_,useServiceFetch:L,noReferrer:M,...D}=e.props;if((0,m.useEffect)(()=>{if(e.isError=!1,h||b){var t;if(null===(t=e.imgEl)||void 0===t?void 0:t.complete){e.imagLoaded=!0;return}}},[f,h,e,b]),e.imagLoaded&&e.isError&&x)return(0,n.jsx)("span",{className:p()(t,g.placeholder)});let A=e.getResponsiveStyle(),N=v?e.originImagLoaded?f:v:f,E=b&&!e.imagLoaded;return(0,n.jsxs)("span",{ref:t=>{e.el=t},style:{...A,...y,cursor:C?"pointer":void 0},className:p()(g.imgWrapper,t,E?i:""),children:[E&&(0,n.jsx)(c.Z.Image,{className:p()(g.skeleton,a),active:!0}),S&&e.imagLoaded&&!e.isError&&(0,n.jsx)("div",{className:g.tools,children:(0,n.jsx)("span",{className:g.toolItem,onClick:()=>{null==k||k()},children:(0,n.jsx)(r.J,{name:"download",size:16,color:"currentColor"})})}),e.inView&&e.serverFetched&&(0,n.jsxs)(n.Fragment,{children:[C&&!e.isError?(0,n.jsx)(d.Z,{preview:{getContainer:()=>s.t.dialogRoot,mask:null,src:I||f,toolbarRender:(t,a)=>{let{icons:i}=a;return(0,n.jsxs)(u.Z,{size:12,className:"toolbar-wrapper",children:[i.flipYIcon,i.flipXIcon,i.rotateLeftIcon,i.rotateRightIcon,i.zoomOutIcon,i.zoomInIcon,(0,n.jsx)(r.J,{name:"downloadMonica",size:22,color:"rgb(215, 215, 215)",onClick:()=>{let t=I||e.props.src;l.m.fetchWithDownload(I||t)},style:{cursor:"pointer"}})]})},...T},src:e.blobUrl||(0,o.Q)(f),onLoad:t=>{var a,n;if(e.imagLoaded=!0,P){let a=t.target;e.calcViewMode(null==a?void 0:a.naturalWidth,null==a?void 0:a.naturalHeight)}null===(a=(n=e.props).onLoad)||void 0===a||a.call(n,t)},onError:t=>{var a,n;e.isError=!0,e.imagLoaded=!0,null===(a=(n=e.props).onError)||void 0===a||a.call(n,t)},referrerPolicy:M?"no-referrer":void 0}):(N||e.isError&&h)&&(0,n.jsx)("img",{src:e.blobUrl||(0,o.Q)(e.isError&&h?h:N),onClick:()=>{null==w||w()},alt:"",ref:t=>{e.imgEl=t},...D,onLoad:t=>{var a,n;e.imagLoaded=!0,null===(a=(n=e.props).onLoad)||void 0===a||a.call(n,t)},onError:t=>{var a,n;e.isError=!0,e.imagLoaded=!0,null===(a=(n=e.props).onError)||void 0===a||a.call(n,t)},referrerPolicy:M?"no-referrer":void 0}),v&&!e.originImagLoaded&&(0,n.jsx)("img",{className:g.hideImage,src:f,onLoad:()=>{e.originImagLoaded=!0}})]})]})})},37231:function(e,t,a){a.d(t,{I:function(){return m}});var n=a(71576),i=a(34491),o=a(88882),r=a(78716),s=a.n(r),l=a(70151),c=a(46731),d={input:"input--lwUSZ","text-ellipsis":"text-ellipsis--D6tEl",textEllipsis:"text-ellipsis--D6tEl","input-size-default":"input-size-default--_K_0f",inputSizeDefault:"input-size-default--_K_0f","input-size-middle":"input-size-middle--eOtSK",inputSizeMiddle:"input-size-middle--eOtSK","input-size-large":"input-size-large--W0_uQ",inputSizeLarge:"input-size-large--W0_uQ","input-size-small":"input-size-small--tzmoO",inputSizeSmall:"input-size-small--tzmoO","input-disabled":"input-disabled--uGfKM",inputDisabled:"input-disabled--uGfKM","input-search":"input-search--NOcJ_",inputSearch:"input-search--NOcJ_","search-icon":"search-icon--tik7O",searchIcon:"search-icon--tik7O","close-icon":"close-icon--DwuKe",closeIcon:"close-icon--DwuKe",small:"small--Oc1XS","input-password":"input-password--dFjAZ",inputPassword:"input-password--dFjAZ","password-icon":"password-icon--xCWP8",passwordIcon:"password-icon--xCWP8","input-addon-after":"input-addon-after--oiCh7",inputAddonAfter:"input-addon-after--oiCh7","addon-content":"addon-content--TJ1ic",addonContent:"addon-content--TJ1ic","input-addon-before":"input-addon-before--lWPcg",inputAddonBefore:"input-addon-before--lWPcg","input-default-theme":"input-default-theme--ujGK4",inputDefaultTheme:"input-default-theme--ujGK4","input-blue-theme":"input-blue-theme--LbHbA",inputBlueTheme:"input-blue-theme--LbHbA"},u=a(66084),h=a(52921);class p extends i.PN{handleChangePasswordVisible(){this.isPasswordVisible=!this.isPasswordVisible,this.type=this.isPasswordVisible?"text":"password"}onViewCreate(){this.type=this.props.type||"text",this.props.autofocus?setTimeout(()=>{var e;null===(e=this.el)||void 0===e||e.focus()}):this.props.autoSelectAll&&setTimeout(()=>{var e,t,a;null===(e=this.el)||void 0===e||e.focus(),null===(a=this.el)||void 0===a||a.setSelectionRange(0,null===(t=this.el)||void 0===t?void 0:t.value.length)})}onViewDestroy(){}constructor(...e){super(...e),(0,u._)(this,"props",void 0),(0,u._)(this,"el",null),(0,u._)(this,"type","text"),(0,u._)(this,"isPasswordVisible",!1)}}(0,h.gn)([i.SB],p.prototype,"type",void 0),(0,h.gn)([i.SB],p.prototype,"isPasswordVisible",void 0);let m=i._Y.createComponent("Input",p,e=>{let{value:t,onChange:a,onClear:i,onEscape:r,onEnter:u,onEnterWithoutCtrl:h,onKeydown:p,getInputRef:m,onCompositionEnd:g,onCompositionStart:v,onFocus:f,placeholder:y,width:b,disabled:C,type:S="text",size:I="default",theme:k="default",addonAfter:w=null,spellCheck:T=!0,className:x,originInputProps:P,onlyInteger:_,stopPropagation:L,searchIconColor:M="currentColor",addonContentClassName:D,textEllipsis:A,addonBefore:N}=e.props,E=(0,n.jsx)("input",{className:s()(d.input,{[d.inputDisabled]:C,[d.inputSizeLarge]:"large"===I,[d.inputSizeDefault]:"default"===I,[d.inputSizeMiddle]:"middle"===I,[d.inputSizeSmall]:"small"===I,[d["input-".concat(k,"-theme")]]:k,[d.textEllipsis]:A},"monica-input",x),ref:t=>{e.el=t,t&&(null==m||m(t))},spellCheck:T,value:t,style:{width:b?"".concat(b,"px"):"100%"},onChange:e=>{let t=e.target.value;_?/^\d*$/.test(t)&&(null==a||a(t)):null==a||a(e.target.value)},onCompositionStart:()=>{null==v||v()},onCompositionEnd:()=>{null==g||g()},placeholder:y,disabled:C,type:"search"===e.type?"text":e.type,onKeyDown:e=>{null==p||p(e),L&&e.stopPropagation(),(0,l.P6)(["mod+enter","ctrl+enter"],e)&&u&&(e.stopPropagation(),e.preventDefault(),u()),(0,l.P6)("Enter",e)&&h&&(e.stopPropagation(),e.preventDefault(),h()),(0,l.P6)("esc",e)&&r&&(e.stopPropagation(),e.preventDefault(),r())},onMouseDown:e=>{e.stopPropagation()},onFocus:f,...P});return"search"===S?(0,n.jsxs)("div",{className:s()(d.inputSearch,{[d.small]:"small"===I}),children:[E,(0,n.jsx)("span",{style:{[o.a.rtl?"right":"left"]:"small"===I?8:16},className:d.searchIcon,children:(0,n.jsx)(c.J,{name:"monicaInputSearch",color:M})}),(0,n.jsx)("span",{style:{[o.a.rtl?"left":"right"]:"small"===I?8:12,display:t?"flex":"none"},className:d.closeIcon,onClick:()=>{null==a||a(""),null==i||i()},children:(0,n.jsx)(c.J,{name:"closeFill",color:"currentColor",size:16})})]}):"password"===S?(0,n.jsxs)("div",{className:s()(d.inputPassword),children:[E,(0,n.jsx)("span",{className:d.passwordIcon,onClick:()=>{e.handleChangePasswordVisible()},children:e.isPasswordVisible?(0,n.jsx)(c.J,{name:"eye",size:20}):(0,n.jsx)(c.J,{name:"eye-close",size:20})})]}):w?(0,n.jsxs)("div",{className:s()(d.inputAddonAfter),children:[E,(0,n.jsx)("span",{className:s()(d.addonContent,D),children:w})]}):N?(0,n.jsxs)("div",{className:s()(d.inputAddonBefore),children:[(0,n.jsx)("span",{className:s()(d.addonContent,D),children:N}),E]}):E})},61658:function(e,t,a){a.d(t,{g:function(){return c}});var n=a(71576),i=a(78716),o=a.n(i),r=a(75087),s=a(46731),l={loading:"loading--WKrVP",geistLoading:"geist-loading--VOpbY",spin:"spin--IgvsF",searchLoading:"search-loading--U2FBr",fullscreen:"fullscreen--ahHVo"};let c=(0,r.memo)(e=>{let{size:t=24,className:a,wrapperClassName:i,fullScreen:r=!1,color:c,styles:d,type:u="default",iconName:h="loading"}=e;if("geist"===u){var p;let t=null!=c?c:"#444";return(0,n.jsxs)("span",{className:o()(l.geistLoading,a),style:{"--size":"".concat(null!==(p=e.size)&&void 0!==p?p:4,"px"),...d},children:[(0,n.jsx)("i",{style:{backgroundColor:t},className:l.spin}),(0,n.jsx)("i",{style:{backgroundColor:t},className:l.spin}),(0,n.jsx)("i",{style:{backgroundColor:t},className:l.spin})]})}if("search"===u)return(0,n.jsx)("span",{className:o()(l.searchLoading,i),children:(0,n.jsx)(s.J,{name:"searchLoading",size:t})});let m=(0,n.jsx)(s.J,{size:t,name:h,color:null!=c?c:"var(--theme-icon-brand)",className:o()(l.loading,a)});return r?(0,n.jsx)("div",{className:o()(l.fullscreen,i),style:d,children:m}):m})},34891:function(e,t,a){a.d(t,{B:function(){return y}});var n=a(71576),i=a(34491),o=a(82005),r=a(78716),s=a.n(r),l=a(5857),c=a(68104),d=a(66084),u=a(52921),h=a(88882),p=a(11989),m=a(71528),g=a(73047);class v extends i.PN{get S(){return h.S.Global.components.Modal}async onConfirm(){this.okLoading=!0,await this.props.onOk()?(this.okLoading=!1,this.props.onDisposed()):this.okLoading=!1}onCancel(){var e,t;null===(e=(t=this.props).onCancel)||void 0===e||e.call(t),this.props.onDisposed()}registerShortcut(){this.listenerManager.addDocumentEventListener("keydown",e=>{if(p.t.isHotkey(e,["esc"])){this.onCancel(),e.stopPropagation(),e.preventDefault();return}if(p.t.isHotkey(e,["enter"])){this.onConfirm(),e.stopPropagation(),e.preventDefault();return}})}onViewCreate(){this.registerShortcut()}onViewDestroy(){this.listenerManager.removeAll()}constructor(...e){super(...e),(0,d._)(this,"props",void 0),(0,d._)(this,"listenerManager",new m.M),(0,d._)(this,"okLoading",!1)}}(0,u.gn)([i.SB],v.prototype,"okLoading",void 0),(0,u.gn)([g.Fl],v.prototype,"S",null);let f=i._Y.createComponent("ConfirmV2",v,e=>{let{okText:t=e.S.ok,cancelText:a=e.S.cancel,okBtnType:i="primary",cancelBtnType:o="gray",title:r=e.S.productSays,okBtnProps:d,cancelBtnProps:u,hideCancel:h=!1,footerClassName:p,closeOnMaskClick:m,isMobile:g,width:v=340}=e.props;return(0,n.jsxs)(c.u,{className:s()("confirm--PegE2",{"mobile--KZHYQ":g}),width:v,fixed:"dialogRoot"===e.props.insertTarget,closeOnMaskClick:m,onDispose:()=>{var t,a;e.props.onDisposed(),null===(t=(a=e.props).onCancel)||void 0===t||t.call(a)},children:[(0,n.jsx)("div",{className:"confirm-title--ABKK9",children:r}),(0,n.jsx)("div",{className:"confirm-content--AZyQu",children:e.props.content}),(0,n.jsx)("div",{className:s()("footer--INz5x",p),children:(0,n.jsxs)("div",{className:s()("btn-group--ax6i7",{"btn-group-full--YFkdp":e.props.btnGroupFull}),children:[!h&&(0,n.jsx)(l.z,{type:o,noBorder:!0,...u,onClick:()=>{e.onCancel()},children:a}),(0,n.jsx)(l.z,{type:i,...d,loading:e.okLoading,onClick:()=>{e.onConfirm()},children:t})]})})]})}),y=o.t.createOpener(f)},68104:function(e,t,a){a.d(t,{u:function(){return v}});var n=a(71576),i=a(34491),o=a(56607),r=a(78716),s=a.n(r),l=a(82005),c=a(46731),d={monicaModalWrapper:"monica-modal-wrapper--voWWd",blackMask:"black-mask--Gp9b5",monicaModal:"monica-modal--pWulA",close:"close--Vza3L"},u=a(66084),h=a(52921),p=a(11989),m=a(77233);class g extends i.PN{onViewCreate(){this.keydownHelper.init({handleKeydown:e=>{p.t.isHotkey(e,["esc"])&&this.props.closeWhenEsc&&(this.props.onDispose(),e.preventDefault(),e.stopPropagation())}})}onViewDestroy(){this.keydownHelper.destroy()}constructor(...e){super(...e),(0,u._)(this,"props",void 0),(0,u._)(this,"keydownHelper",new m.T),(0,u._)(this,"someState",!0)}}(0,h.gn)([i.SB],g.prototype,"someState",void 0);let v=i._Y.createComponent("Modal",g,e=>{let{width:t=350,closeIconVisible:a=!0,maskType:i="black",className:r,closeCls:u,closeOnMaskClick:h=!0,onDispose:p,fixed:m=!1,closeOffset:g=16,closeOffsetY:v=g,wrapperClassName:f,wrapperStyle:y={}}=e.props,b=o.o.isWeb||m;return(0,n.jsx)("div",{className:s()(d.monicaModalWrapper,f,"monica-modal-wrapper",{[d.blackMask]:"black"===i}),style:{position:b?"fixed":"absolute",...y},onMouseDown:e=>{h&&(null==p||p(),e.preventDefault()),e.stopPropagation()},children:(0,n.jsxs)("div",{className:s()(d.monicaModal,r),style:{width:t,...e.props.style||{},...l.t.inDesktopDialogRenderer?{width:"100%",borderRadius:10}:{}},onClick:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},ref:t=>{var a,n;null===(a=(n=e.props).getRef)||void 0===a||a.call(n,t)},children:[a&&(0,n.jsx)("div",{className:s()(d.close,u),style:{insetInlineEnd:g,insetBlockStart:v},onClick:()=>{null==p||p()},children:(0,n.jsx)(c.J,{color:"currentColor",size:20,name:"close"})}),e.props.children]})})})},75372:function(e,t,a){a.d(t,{x:function(){return p}});var n=a(71576),i=a(34491),o=a(82005),r=a(56607),s=a(65779),l=a(78716),c=a.n(l),d=a(66084),u=a(52921);class h extends i.PN{setOpen(e){var t,a,n,i;void 0!==this.props.open?null===(t=(a=this.props).onOpenChange)||void 0===t||t.call(a,e):(this.open=e,null===(n=(i=this.props).onOpenChange)||void 0===n||n.call(i,e))}onViewCreate(){}onViewDestroy(){this.setOpen(!1)}get offset(){let e=this.props.placement;return"bottom"===e||"left"===e||"top"===e||"right"===e?[0,0]:"bottomRight"===e?[8,0]:"bottomLeft"===e?[-8,0]:"leftTop"===e?[0,-8]:"leftBottom"===e?[0,8]:"topLeft"===e?[-8,0]:"topRight"===e?[8,0]:"rightBottom"===e?[0,8]:"rightTop"===e?[0,-8]:[0,0]}constructor(...e){super(...e),(0,d._)(this,"props",void 0),(0,d._)(this,"open",!1)}}(0,u.gn)([i.SB],h.prototype,"open",void 0);let p=i._Y.createComponent("PopoverV2",h,e=>{let{children:t,content:a,fullWidth:i,fullHeight:l,closeAfterContentClick:d,open:u,onOpenChange:h,wrapperClassName:p,triggerNode:m,useDefaultContainer:g=!1,...v}=e.props,f=c()("popover-content-wrapper--zvn5S",p,{"fullWidth--vGBGu":i}),y=void 0!==u?u:e.open;return(0,n.jsx)(s.Z,{align:{offset:e.offset},open:y,onOpenChange:t=>{e.setOpen(t)},...v,content:(0,n.jsx)("span",{"data-draggable":"false",className:f,onClick:()=>{d&&e.setOpen(!1)},children:a}),overlayClassName:c()(v.overlayClassName,"popover-overlay--WIcJB"),getTooltipContainer:g?void 0:t=>e.props.getTooltipContainer?e.props.getTooltipContainer(t):e.props.useParentContainer&&t.parentElement?t.parentElement:r.o.isWeb?o.t.dialogRoot||document.body:o.t.dialogRoot,children:m||(0,n.jsx)("span",{className:f,style:l?{height:"100%"}:void 0,children:t})})})},25157:function(e,t,a){a.d(t,{I:function(){return c}});var n=a(71576),i=a(34491),o=a(53040),r=a(66084),s=a(52921);class l extends i.PN{onViewCreate(){}onViewDestroy(){}constructor(...e){super(...e),(0,r._)(this,"props",void 0),(0,r._)(this,"someState",!0)}}(0,s.gn)([i.SB],l.prototype,"someState",void 0);let c=i._Y.createComponent("TeamAvatar",l,e=>{let{src:t,word:a,size:i=40,radius:r=8}=e.props;return(0,n.jsx)("div",{className:"team-avatar--Q197C",style:{width:i,height:i,borderRadius:r,fontSize:i/2,background:t?"none":"#7B96F7"},children:t?(0,n.jsx)(o.E,{skeleton:!0,src:t}):a})})},48023:function(e,t,a){a.d(t,{u:function(){return m}});var n=a(71576),i=a(34491),o=a(82005),r=a(92396),s=a(78716),l=a.n(s),c=a(75087),d=a(71376),u=a(66084),h=a(52921);class p extends i.PN{onViewCreate(){}onViewDestroy(){}constructor(...e){super(...e),(0,u._)(this,"props",void 0),(0,u._)(this,"open",!1)}}(0,h.gn)([i.SB],p.prototype,"open",void 0);let m=i._Y.createComponent("Tooltip",p,e=>{let{title:t,width:a,overlayClassName:i,disabled:s,forceOpen:u,useParentContainer:h,placement:p="top",showArrow:m=!1,forceOpenInNextTick:g,lightMode:v=!1,arrow:f,useDefaultContainer:y=!1,controlled:b=!1,isIgnoredMaxWidth:C=!1}=e.props;(0,c.useEffect)(()=>{void 0!==e.props.open&&(e.open=e.props.open)},[e.props.open,e]),(0,c.useEffect)(()=>{s&&(e.open=!1)},[s,e]),(0,c.useEffect)(()=>{g&&setTimeout(()=>{e.open=!0})},[e,g]);let{children:S,onOpenChange:I,...k}=e.props;if(s)return(0,n.jsx)(n.Fragment,{children:S});let w=!!t&&e.open;return(0,n.jsx)(r.Z,{align:p.startsWith("top")?{offset:[0,-8]}:void 0,placement:p,...k,showArrow:m,arrow:"boolean"==typeof m&&!!m||f,open:!!u||w,overlayClassName:l()(i,d.Z.tooltip,{[d.Z.lightMode]:v,[d.Z.ignoreMaxWidth]:C}),onOpenChange:t=>{b?null==I||I(t):e.open=t},overlayStyle:{width:a||"max-content"},getTooltipContainer:y?void 0:t=>{let{getTooltipContainer:a}=e.props;return a?a(t):h?t.parentElement:o.t.dialogRoot},children:S})})},58812:function(e,t,a){a.d(t,{s:function(){return m}});var n=a(71576),i=a(34491),o=a(78716),r=a.n(o),s=a(75087),l=a(61658),c=a(48023),d={baseIcon:"base-icon--_lenS",button:"button--YfH00",active:"active--ey8a3",disabled:"disabled--FjFPv"},u=a(66084),h=a(52921);class p extends i.PN{getBaseIconData(e){let{iconData:t}=this.props;t.content||console.warn("WARNING:[BaseIconVm] please confirm icon is not exist");let a=t.content,n={},i=[...a.matchAll(/url\(#([^)]+)\)/g)].map(e=>e[1]),o=[...a.matchAll(/id="([^"]+)"/g)].map(e=>e[1]);i.forEach(t=>{if(o.includes(t)){let a="".concat(t,"_").concat(e);n[t]=a}});let r=a;return Object.entries(n).forEach(e=>{let[t,a]=e;r=(r=r.replace(RegExp("url\\(#".concat(t,"\\)"),"g"),"url(#".concat(a,")"))).replace(RegExp('id="'.concat(t,'"'),"g"),'id="'.concat(a,'"'))}),{...t,content:r}}onViewCreate(){}onViewDestroy(){}setColor(e){let t=this.props.stroke||this.props.color,a=this.props.fill||this.props.color;return t&&(e=e.replace(/stroke=['"].+?['"]/g,'stroke="'.concat(t,'"'))),a&&(e=e.replace(/fill=['"].+?['"]/g,'fill="'.concat(a,'"'))),e.trim()}constructor(...e){super(...e),(0,u._)(this,"props",void 0),(0,u._)(this,"someState",!0),(0,u._)(this,"svgRoot",null)}}(0,h.gn)([i.SB],p.prototype,"someState",void 0);let m=i._Y.createComponent("BaseIcon",p,e=>{let t,a;let i=(0,s.useId)(),o=e.getBaseIconData(i),{size:u,fill:h,style:p,color:m,title:g,button:v,padding:f=v?3:0,isActive:y,disabled:b,className:C,useParentContainer:S,onClick:I,onMouseDown:k,placement:w,mouseLeaveDelay:T,isLoading:x}=e.props;if(!o)return null;let{content:P,viewBox:_,fill:L}=o;return P?("object"==typeof u?(t=u.width,a=u.height):(t=u,a=u),v&&x)?(0,n.jsx)("span",{style:{padding:f},className:r()(d.baseIcon),children:(0,n.jsx)(l.g,{size:t})}):(0,n.jsx)(c.u,{title:g||"",mouseLeaveDelay:T||0,useParentContainer:S,placement:w,children:(0,n.jsx)("span",{style:{...p,padding:v?f:void 0},className:r()(d.baseIcon,C,{[d.button]:v,[d.active]:y,[d.disabled]:b}),onClick:e=>{b||null==I||I(e)},onMouseDown:e=>{b||null==k||k(e)},children:(0,n.jsx)("svg",{fill:h||L,style:{minWidth:t,minHeight:a,color:m},width:t||"1em",height:a||"1em",viewBox:_,dangerouslySetInnerHTML:{__html:e.setColor(P)}})})}):null})},87291:function(e,t,a){a.d(t,{b:function(){return c}});var n=a(71576),i=a(58812),o=a(34491),r=a(66084);class s extends o.PN{constructor(...e){super(...e),(0,r._)(this,"props",void 0)}}var l=JSON.parse('{"fill":"none","content":"\\n<path fill-rule=\\"evenodd\\" clip-rule=\\"evenodd\\" d=\\"M8 2.625C5.03147 2.625 2.625 5.03147 2.625 8C2.625 10.9685 5.03147 13.375 8 13.375C10.9685 13.375 13.375 10.9685 13.375 8C13.375 5.03147 10.9685 2.625 8 2.625ZM1.375 8C1.375 4.34111 4.34111 1.375 8 1.375C11.6589 1.375 14.625 4.34111 14.625 8C14.625 11.6589 11.6589 14.625 8 14.625C4.34111 14.625 1.375 11.6589 1.375 8ZM5.8125 6.42188C5.8125 5.21648 6.79782 4.25 8 4.25C9.20218 4.25 10.1875 5.21648 10.1875 6.42188C10.1875 7.12174 9.85359 7.74279 9.34064 8.13816C9.11886 8.30911 8.92897 8.46901 8.79447 8.63371C8.66265 8.79513 8.625 8.91143 8.625 9C8.625 9.34518 8.34518 9.625 8 9.625C7.65482 9.625 7.375 9.34518 7.375 9C7.375 8.51903 7.59135 8.13075 7.82629 7.84305C8.05856 7.55864 8.34821 7.32488 8.57753 7.14813C8.79901 6.97742 8.9375 6.71485 8.9375 6.42188C8.9375 5.91865 8.5237 5.5 8 5.5C7.4763 5.5 7.0625 5.91865 7.0625 6.42188C7.0625 6.76705 6.78268 7.04688 6.4375 7.04688C6.09232 7.04688 5.8125 6.76705 5.8125 6.42188ZM8.8125 11.0312C8.8125 11.4627 8.46272 11.8125 8.03125 11.8125C7.59978 11.8125 7.25 11.4627 7.25 11.0312C7.25 10.5998 7.59978 10.25 8.03125 10.25C8.46272 10.25 8.8125 10.5998 8.8125 11.0312Z\\" fill=\\"#868692\\"/>\\n</svg>\\n","viewBox":"0 0 16 16"}');let c=o._Y.createComponent("HelpIcon",s,e=>(0,n.jsx)(i.s,{...e.props,name:"HelpIcon",iconData:l}))},663:function(e,t,a){a.d(t,{D:function(){return P},m:function(){return L}});var n=a(66084),i=a(52921),o=a(34491),r=a(22046),s=a(88882),l=a(92235),c=a(92660),d=a(60445),u=a(56607),h=a(82270),p=a(73047),m=a(7472),g=a(87331),v=a(73361),f=a(11502),y=a(92020),b=a(48655),C=a(13942),S=a(47720),I=a(66928),k=a(18918),w=a(15851),T=a(33381),x=a(54560);let P="subscribe-team";class _{get teamPlanKey(){return"month"===this.teamInterval?"team_monthly":"team_yearly"}get decreaseSeatCountDisabled(){return this.teamSeatCount<=this.teamSeatCountInputMinValue}get increaseSeatCountDisabled(){return this.teamSeatCount>=this.teamSeatCountInputMaxValue}get teamSeatCountInputMaxValue(){var e,t;return k.teamController.isAdditionalPurchase?999999-(null!==(t=null===(e=k.teamController.currentTeamInfo)||void 0===e?void 0:e.totalSeats)&&void 0!==t?t:0):999999}get currentTeamPlan(){return S.serverConfigController.teamPlanList.find(e=>e.interval===this.teamInterval)}get currentPlan(){if(T.userController.userVipStatus){let{vipVersion:e,interval:t}=T.userController.userVipStatus,a="".concat(e,"_").concat("year"===t?"yearly":"monthly");return S.serverConfigController.planList.find(e=>e.key===a)||null}return null}get planStatus(){let e=T.userController.userVipStatus,t=(null==e?void 0:e.vipVersion)||"free",a=null==e?void 0:e.interval,n=null==e?void 0:e.versionAtPeriodEnd,i=null==e?void 0:e.intervalAtPeriodEnd,o=null==e?void 0:e.usingGiveawayVip,r="free"!==t&&(null==e?void 0:e.cancelAtPeriodEnd),s="starter"===t,l="boost"===t,c="basic"===t;return{currentVipVersion:t,currentVipInterval:a,nextVipInterval:i,nextVipVersion:n,usingGiveawayVip:o,isUnsubscribe:r,isDowngrade:!o&&n!==t,isElite:"elite"===t,isStarter:s,isBoost:l,isFree:"free"===t,isIntervalPay:"month"===a||"year"===a,isVip:l||s||c,isBasic:c}}get teamPriceInfo(){var e,t,a,n,i;let o=null===(e=this.currentTeamPlan)||void 0===e?void 0:e.moPrice,r=parseFloat((null==o?void 0:null===(t=o.match(/[\d.]+/))||void 0===t?void 0:t[0])||"0");return{currentPrice:o,moPrice:null===(a=this.currentTeamPlan)||void 0===a?void 0:a.moPrice,originMoPrice:null===(n=this.currentTeamPlan)||void 0===n?void 0:n.originMoPrice,teamPlanTotalPrice:S.serverConfigController.genPrice(Math.round(r*this.teamSeatCount*100)/100),teamPlanTotalPriceYearly:S.serverConfigController.genPrice(Math.round(r*this.teamSeatCount*1200)/100),yearlyDiscount:null===(i=S.serverConfigController.teamPlanList.find(e=>"year"===e.interval))||void 0===i?void 0:i.yearlyDiscountPercent}}get billingS(){return s.S.Global.controllers.planController.Billing}get creditsConfig(){return S.serverConfigController.getStaticConfig("creditsUsage")}get imageSpent(){return I.fI.imageSpent}get videoSpent(){return I.fI.videoSpent}get translateSpent(){return I.fI.translateWord}get tokenSpent(){return I.fI.tokenSpent}get voiceSpent(){return I.fI.voiceSpent}setViews(e){this.views=e}async gotoSubscribeTeam(){var e;if(l.m.getIsPricingPage()){if(this.planType="team",await k.teamController.uncreatedTeamReadSource.waitReady(),k.teamController.uncreatedTeamInfo)(0,m.L)({insertTarget:"dialogRoot"});else{let e=await x.u.subscribe({planKey:this.teamPlanKey,redirectUrl:"",teamSubscribeParams:{seatCount:this.teamSeatCount}});("auto_modify"===e.type||"success"===e.type)&&(await k.teamController.getUnCreatedTeamInfo(),k.teamController.uncreatedTeamInfo&&(0,m.L)({insertTarget:"dialogRoot",isNewTeam:!0})),window.localStorage.setItem(c.storageKeys.hasUncreatedTeam,"true")}return}null===(e=window)||void 0===e||e.open(l.m.getPricingPageUrl({action:P}),"_blank")}async gotoCreateTeam(){var e;null===(e=window)||void 0===e||e.open(l.m.genFullUrl(d.Cl.team),"_blank")}async upgradeTeamSubscription(e){return await x.u.subscribe({planKey:this.teamPlanKey,redirectUrl:"",teamSubscribeParams:e})}async resubscribeTeam(){this.teamResubscribeLoading=!0;try{return await x.u.resubscribe(),await Promise.all([T.userController.fetchVipStatus(),v.gM.updateUsageInfos()]),w.M.success(this.billingS.reSubscribeSuccess),!0}catch(e){return w.M.error(l.m.formatErrorMsg(e)),!1}finally{this.teamResubscribeLoading=!1}}async subscribe(e){var t,a,n,i;if(!u.o.isWeb){x.u.gotoPricingForSubscribe({source:e.source,planKey:e.planKey,autoPay:e.autoPay});return}e.loadingRefer&&(e.loadingRefer.btnLoading=!0,e.loadingRefer.loading=!0),f.M.createUserBehaviorEvent({eventName:"pre_subscribe",extData:{platform:S.serverConfigController.paymentPlatform}});let o=l.m.genId(),r=e.orderPageRedirectUrl||l.m.genFullUrl(l.m.genUrl(d.Cl.tools,{orderId:o,payment_platform:S.serverConfigController.paymentPlatform,space:"space",showPayDialog:"1"})),s=await x.u.subscribe({planKey:e.planKey,redirectUrl:r,eduDiscount:e.eduDiscount,teamSubscribeParams:e.teamSubscribeParams,isDowngrade:e.isDowngrade,discountCode:e.discountCode,discountId:e.discountId});if("auto_modify"===s.type||"success"===s.type){try{await Promise.all([T.userController.fetchVipStatus(),v.gM.updateUsageInfos()]),u.o.isWeb&&await C.P.sendMessageToExt({event:"markPaid",payload:{}}),(u.o.isChatPDF||e.source.includes("chatpdf"))&&(y.ll.setUiFlag("chatPdfPaidTime",Date.now()),g.C.markPaid()),w.M.success(e.successTip||this.billingS.subscribeSuccess),await b.Cc.syncSubscribePlanList(!0),await b.Cc.syncConfig(!0)}catch(e){}"success"!==s.type||(await (null===(t=e.onSuccess)||void 0===t?void 0:t.call(e)),e.disableRedirect||(window.location.href=r))}else if("error"===s.type)s.message&&w.M.error(s.message),null===(a=this.views)||void 0===a||a.openPaymentCompletedDialog({insertTarget:"dialogRoot",paymentStatus:"failed"});else if("canceled"===s.type)null===(n=this.views)||void 0===n||n.openPaymentCompletedDialog({insertTarget:"dialogRoot",paymentStatus:"failed"});else if("open_checkout"===s.type){let{newTab:t=!0}=e;!l.m.getIsMobile()&&t?(window.open(s.checkoutUrl,"_blank"),this.checkOrderId(o,e)):(await (null===(i=e.onSuccess)||void 0===i?void 0:i.call(e)),window.location.href=s.checkoutUrl)}e.loadingRefer&&(e.loadingRefer.btnLoading=!1,e.loadingRefer.loading=!1)}getPlanUsageInfo(e){let t=S.serverConfigController.planUsageInfos.find(t=>t.version===e),a={periodPointCount:0,artistPoint:0,geniusPoint:0,claude2Point:0,claude100kPoint:0};return(null==t?void 0:t.quotaInfo)&&t.quotaInfo.forEach(e=>{"basic_query"===e.module&&(a.periodPointCount=e.planTotal),"artist_bot"===e.module&&(a.artistPoint=e.planTotal),"genius_bot"===e.module&&(a.geniusPoint=e.planTotal),"claude2"===e.module&&(a.claude2Point=e.planTotal),"claude_100k"===e.module&&(a.claude100kPoint=e.planTotal)}),a}async oneTimePurchase(e){var t,a,n;if(!u.o.isWeb){w.M.error(h.nL.paymentPlatformError);return}e.loadingRefer&&(e.loadingRefer.btnLoading=!0,e.loadingRefer.loading=!0);let i=await x.u.oneTimePurchase({productKey:e.productKey});if("success"===i.type)try{await Promise.all([T.userController.fetchVipStatus(),v.gM.updateUsageInfos()]),await C.P.sendMessageToExt({event:"markPaid",payload:{}}),w.M.success(this.billingS.subscribeSuccess),null===(t=this.views)||void 0===t||t.openPaymentCompletedDialog({insertTarget:"dialogRoot",paymentStatus:"success",productType:"credits"}),e.loadingRefer&&(e.loadingRefer.markPaid=!0)}catch(e){}else"error"===i.type?(i.message&&w.M.error(i.message),null===(a=this.views)||void 0===a||a.openPaymentCompletedDialog({insertTarget:"dialogRoot",paymentStatus:"failed"})):"canceled"===i.type&&(null===(n=this.views)||void 0===n||n.openPaymentCompletedDialog({insertTarget:"dialogRoot",paymentStatus:"failed"}));e.loadingRefer&&(e.loadingRefer.btnLoading=!1,e.loadingRefer.loading=!1)}async buyCredits(e){if(!u.o.isWeb||!r.S.location.pathname.includes(d.Cl.credits)){let t=e.source;window.open(l.m.getCreditsPageUrl({productKey:e.productKey,source:t}),"_blank","noopener");return}T.userController.isFreeUser||await this.oneTimePurchase(e)}calcCreditFeatures(e){let t=e=>e>1e5?e%1e6==0?"".concat(e/1e6>>0,"M"):"".concat((e/1e6).toFixed(2),"M"):e>100?(e/10>>0)*10:e;return{imageCount:t(e/this.imageSpent>>0),videoCount:t(e/this.videoSpent>>0),translateWord:t(e*this.translateSpent),tokenLimit:t(e*this.tokenSpent),liveVoiceMinute:t(e/this.voiceSpent>>0)}}setSeatCount(e){this.teamSeatCount=Math.min(Math.max(this.teamSeatCountInputMinValue,Math.floor(e)),this.teamSeatCountInputMaxValue)}initOrderId(){if(u.o.isWeb&&!r.S.isRunInServerSide){let e=new URL(r.S.location.href).searchParams.get("orderId");if(e){let t=localStorage.getItem(c.storageKeys.orderList),a=t?JSON.parse(t):[];a.includes(e)||(a.push(e),localStorage.setItem(c.storageKeys.orderList,JSON.stringify(a)))}}}checkOrderId(e,t){this.subscriptionTimer&&(clearInterval(this.subscriptionTimer),this.subscriptionTimer=null),this.subscriptionTimer=setInterval(async()=>{let a=localStorage.getItem(c.storageKeys.orderList);if((a?JSON.parse(a):[]).includes(e)){var n,i;clearInterval(this.subscriptionTimer),this.subscriptionTimer=null,t.originPageRedirectUrl?(await (null===(n=t.onSuccess)||void 0===n?void 0:n.call(t)),window.location.href=t.originPageRedirectUrl):(Promise.all([T.userController.fetchVipStatus(),v.gM.updateUsageInfos()]),null===(i=this.views)||void 0===i||i.openPaymentCompletedDialog({insertTarget:"dialogRoot",paymentStatus:"success"}))}},1e3)}constructor(){(0,n._)(this,"planType","individual"),(0,n._)(this,"teamInterval","year"),(0,n._)(this,"teamSeatCount",3),(0,n._)(this,"teamSeatCountInputMinValue",3),(0,n._)(this,"teamPlanPreviewLoading",!1),(0,n._)(this,"teamResubscribeLoading",!1),(0,n._)(this,"subscriptionTimer",null),(0,n._)(this,"views",null),(0,p.rC)(this),this.initOrderId()}}(0,i.gn)([o.SB],_.prototype,"planType",void 0),(0,i.gn)([o.SB],_.prototype,"teamInterval",void 0),(0,i.gn)([o.SB],_.prototype,"teamSeatCount",void 0),(0,i.gn)([o.SB],_.prototype,"teamSeatCountInputMinValue",void 0),(0,i.gn)([o.SB],_.prototype,"teamPlanPreviewLoading",void 0),(0,i.gn)([o.SB],_.prototype,"teamResubscribeLoading",void 0),(0,i.gn)([p.Fl],_.prototype,"teamPlanKey",null),(0,i.gn)([p.Fl],_.prototype,"decreaseSeatCountDisabled",null),(0,i.gn)([p.Fl],_.prototype,"increaseSeatCountDisabled",null),(0,i.gn)([p.Fl],_.prototype,"teamSeatCountInputMaxValue",null),(0,i.gn)([p.Fl],_.prototype,"currentTeamPlan",null),(0,i.gn)([p.Fl],_.prototype,"currentPlan",null),(0,i.gn)([p.Fl],_.prototype,"planStatus",null),(0,i.gn)([p.Fl],_.prototype,"teamPriceInfo",null),(0,i.gn)([p.Fl],_.prototype,"billingS",null),(0,i.gn)([p.Fl],_.prototype,"creditsConfig",null),(0,i.gn)([p.Fl],_.prototype,"imageSpent",null),(0,i.gn)([p.Fl],_.prototype,"videoSpent",null),(0,i.gn)([p.Fl],_.prototype,"translateSpent",null),(0,i.gn)([p.Fl],_.prototype,"tokenSpent",null),(0,i.gn)([p.Fl],_.prototype,"voiceSpent",null);let L=new _},34889:function(e,t,a){a.d(t,{Gi:function(){return f},c3:function(){return y},jI:function(){return g},uY:function(){return m}});var n=a(66084),i=a(52921),o=a(34491),r=a(11502),s=a(44469),l=a(92235),c=a(28901),d=a(56607),u=a(88882),h=a(73047),p=a(15851);let m={fail:"File upload failed",abort:"File upload aborted",notAllowed:"Url not in white list"};class g{cancel(){var e;null===(e=this.xhr)||void 0===e||e.abort(),this.canceled=!0}connectXhr(e){this.xhr=e}constructor(){(0,n._)(this,"xhr",void 0),(0,n._)(this,"canceled",!1)}}class v{async getS3PreSignedModuleUrl(e){let t=await r.M.getS3PreSignedModuleUrl(e);if(0!==t.code)throw t.msg;let a=l.m.camelize(t.data);return{preSignedUrl:a.preSignUrl,objectUrl:a.objectUrl,cdnUrl:a.cdnUrl}}async getS3PreSignList(e){let t=await r.M.preSignListByModule(e);if(0!==t.code)throw t.msg;return l.m.camelize(t.data)}async uploadFileToS3(e,t,a,n){let i=t;if(this.isSvgFile(i)&&(i=await c.x.escapeSvg(i)),d.o.isBackground){let{stop:t}=l.m.fakeProgress(10,e=>{null==a||a(e)});try{await fetch(e,{method:"PUT",body:i})}catch(e){throw console.error(e),e}finally{t()}return{status:200,body:""}}return new Promise((t,o)=>{let r=new XMLHttpRequest;r.upload.addEventListener("progress",e=>{null==a||a(Math.floor(e.loaded/e.total*100))}),null==n||n.connectXhr(r),r.addEventListener("load",()=>t({status:r.status,body:r.responseText})),r.addEventListener("error",()=>o(m.fail)),r.addEventListener("abort",()=>o(m.abort)),r.open("PUT",e,!0),r.setRequestHeader("Content-Type",i.type),r.send(i)})}async quickUploadRemoteFileToS3(e){let t,{module:a,link:n,useBgFetch:i}=e,o=l.m.genId();if(i){let e=await r.M.proxyFetch(n,{resolveType:"blob"});t=l.m.dataURLtoFile(e,o)}else{let e=await fetch(n),a=await e.blob();t=new File([a],o,{type:a.type})}let s=await this.getS3PreSignedModuleUrl({module:a,filename:t.name});if(200!==(await this.uploadFileToS3(s.preSignedUrl,t,()=>{},new g)).status)throw m.fail;return s.cdnUrl}async batchUploadRemoteFileToS3(e){let{module:t,links:a,objId:n}=e,i=[];for(let e=0;e<a.length;e++){let t=l.m.genId(),n=await fetch(a[e]),o=await n.blob(),r=new File([o],t,{type:o.type});i.push(r)}let o=await this.getS3PreSignList({module:t,filenameList:i.map(e=>e.name),objId:n}),r=[];if(i.forEach((e,t)=>{r.push(this.uploadFileToS3(o.preSignUrlList[t],e,()=>{},new g))}),(await Promise.all(r)).some(e=>200!==e.status))throw m.fail;return o.cdnUrlList}async downloadAndUploadFile(e,t,a,n){let i;if(d.o.isExtension&&l.m.isLocalFile(e.url)&&!await s.T3.isAllowedFileSchemeAccess())throw Error("not allowed access local file");let{url:o,fileName:r,module:c}=e;if(d.o.isExtension){let e=await s.T3.downloadLocalFile(o);i=l.m.stringToBlob(e)}else i=await fetch(o).then(e=>e.blob());let u=new File([i],r,{type:i.type}),h=l.m.genId(),p=new g;this.uploadFileTasks[h]=p;let{cdnUrl:m,objectUrl:v,preSignedUrl:f}=await this.getS3PreSignedModuleUrl({filename:r,module:c});return this.uploadFileToS3(f,u,e=>{t(e)},p).then(()=>{a({cdnUrl:m,objectUrl:v,name:r,size:u.size,type:u.type}),delete this.uploadFileTasks[h]}).catch(e=>{null==n||n(e)}),{taskId:h}}cancelUploadFile(e){var t;null===(t=this.uploadFileTasks[e])||void 0===t||t.cancel(),delete this.uploadFileTasks[e]}checkMaxSize(e,t){return!(e.size>1048576*t)||(p.M.error(u.S.Base.uploadHelper.fileSizeExceed),!1)}checkIsImage(e){return this.imageFileTypes.includes(e.type)}handleUnSupportFileType(){p.M.error(u.S.Base.uploadHelper.fileTypeNotSupported)}async getFilesFromDataTransfer(e){let t=[];try{let a=e.getData("text/html");if(a){let e=new DOMParser().parseFromString(a,"text/html").querySelectorAll("img");for(let a=0;a<e.length;a++){let n=e[a],i=n.src,o=n.alt||n.title||n.id||n.className;if(o=l.m.sanitizeFilename(o),i.startsWith("https")){let e=await fetch(i),a=await e.blob(),n=new File([a],o,{type:a.type});t.push(n)}else{let e=l.m.dataURLtoFile(i,o);t.push(e)}}}}catch(e){console.log(e)}return t.length>0||Array.from(e.files).forEach(e=>{t.push(e)}),t}isSvgFile(e){return this.svgFileType.includes(e.type)}constructor(){(0,n._)(this,"svgFileType",["image/svg+xml","application/svg+xml"]),(0,n._)(this,"imageFileTypes",["image/jpeg","image/png","image/webp","image/jpg"]),(0,n._)(this,"uploadFileTasks",{})}}let f=new v;class y{async uploadFile(e,t){this.reset();let a=l.m.genId();this.taskId=a;let n="task canceled",i=()=>{if(this.taskId!==a)throw n};if(this.status="loading",this.file=t,t.size>1048576*this.options.maxFileSize){this.status="error",this.errorText=u.S.Base.uploadHelper.fileSizeExceed;return}if(f.checkIsImage(t)){let e=new FileReader;e.readAsDataURL(t),e.onload=async e=>{var t;this.imgPreviewUrl=null===(t=e.target)||void 0===t?void 0:t.result}}try{let a=l.m.getRandomIntForRange(10,40),n=0;if(this.timer=setInterval(()=>{this.setProgress(this.progress+Math.round(5*Math.random())),n=this.progress,this.progress>a&&this.clearTimer()},200),"objId"in e){let t=await f.getS3PreSignList(e);this.uploadResult={cdnUrl:t.cdnUrlList[0],objectUrl:t.objectUrlList[0],preSignedUrl:t.preSignUrlList[0]}}else{let t=await f.getS3PreSignedModuleUrl(e);this.uploadResult={cdnUrl:t.cdnUrl,objectUrl:t.objectUrl,preSignedUrl:t.preSignedUrl}}i();let o=0;await f.uploadFileToS3(this.uploadResult.preSignedUrl,t,e=>{i(),this.clearTimer(),0===o&&(o=100-n),this.setProgress(Math.round(e/100*o),n)}),i(),this.status="success",this.setProgress(100)}catch(e){if(e===n)throw n;this.status="error",this.errorText=l.m.formatMonicaSdkError(e)}}setProgress(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e<=t?this.progress=t:e>=100?this.progress=100:this.progress=e}reset(){this.taskId="",this.status="default",this.progress=0,this.errorText="",this.file=null,this.uploadResult={objectUrl:"",cdnUrl:"",preSignedUrl:""},this.imgPreviewUrl="",this.clearTimer(),this.retry=null}setSuccessImage(e){this.uploadResult.cdnUrl=e,this.uploadResult.objectUrl=e,this.imgPreviewUrl=e,this.status="success"}clearTimer(){this.timer&&(clearInterval(this.timer),this.timer=null)}constructor(e){(0,n._)(this,"options",void 0),(0,n._)(this,"status",void 0),(0,n._)(this,"progress",void 0),(0,n._)(this,"errorText",void 0),(0,n._)(this,"file",void 0),(0,n._)(this,"uploadResult",void 0),(0,n._)(this,"imgPreviewUrl",void 0),(0,n._)(this,"retry",void 0),(0,n._)(this,"timer",void 0),(0,n._)(this,"taskId",void 0),this.options=e,this.status="default",this.progress=0,this.errorText="",this.file=null,this.uploadResult={objectUrl:"",cdnUrl:"",preSignedUrl:""},this.imgPreviewUrl="",this.retry=null,this.timer=null,this.taskId="",(0,h.rC)(this)}}(0,i.gn)([o.SB],y.prototype,"status",void 0),(0,i.gn)([o.SB],y.prototype,"progress",void 0),(0,i.gn)([o.SB],y.prototype,"errorText",void 0),(0,i.gn)([o.SB],y.prototype,"file",void 0),(0,i.gn)([o.SB],y.prototype,"uploadResult",void 0),(0,i.gn)([o.SB],y.prototype,"imgPreviewUrl",void 0)},39936:function(e,t,a){a.d(t,{C:function(){return d}});var n=a(66084),i=a(92235);let o=/(?:\$?CITE_(\d+)\$?)|(?:\[\$CITE_(\d+)\$?\])/gi,r=/\$?PAGE_(\d+),?/gi;function s(e,t){let a=t.trim(),n=/^[A-Za-z]\s*[：:]\s*/,i=a.match(/^(Q?\d+[.:：])\s*(.*[?？؟;])$/);switch(e.looking){case"q":if(""===a)break;return{...e,looking:"a",q:a.replace(n,"")};case"a":if(""===a){if(""===e.a.trim())return e;return{...e,a:"".concat(e.a,"\n")}}if(""===e.a.trim())return{...e,a:a.replace(n,"")};if(null==i?void 0:i[2])return{...e,looking:"other",other:[...e.other,i[2]]};return{...e,a:"".concat(e.a,"\n").concat(a)};case"other":if(null==i?void 0:i[2])return{...e,other:[...e.other,i[2]]}}return e}class l{toChatMessages(e,t,a,n){let o="msg:".concat(i.m.genId()),r={conversationId:e,itemId:"msg:".concat(i.m.genId()),itemType:"reply",summary:a,parentItemId:o,data:{type:"text",questionId:o,content:a}};return[{conversationId:e,itemId:o,itemType:"question",summary:t,data:{type:"text",content:t},parentItemId:n},r]}toChatContent(e){let{question:t,answer:a,suggestions:n}=e,i="".concat(a,"\n\n");return n&&n.length>0&&(i="#### ".concat(t,"\n\n").concat(i)+"\n\n".concat(n.map((e,t)=>{let a="#### ".concat(t+1,". ").concat(e.question);return e.answer?"".concat(a,"\n").concat(e.answer):a}).join("\n\n"))),i}summary(e,t){return this.utils.transformReplyContent("link",e,t.map((e,t)=>({key:(t+1).toString(),sourceType:"link",data:{text:e}})))}questions(e){let{q:t,a,other:n}=function(e){let t=e.split("\n").reduce(s,{q:"",a:"",other:[],looking:"q"});return{q:t.q,a:t.a,other:t.other}}(e);return{msgId:i.m.genId(),question:t,answer:a,suggestions:n.map(e=>({msgId:i.m.genId(),question:e,answer:""}))}}constructor(e){(0,n._)(this,"utils",void 0),this.utils=e}}class c{transformReplyContent(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={},s=t,l=1;if(t.includes("$PAGE_"))s=t.replace(r,"");else if(t.includes("$CITE_"))s="web_search"===e?t.replace(o,(e,t,a)=>{let n=Number(t||a)-1;return this.getCiteLink(n)}):(null==a?void 0:a.length)?t.replace(o,(e,t,a)=>{let[n,i]=d(t||a);return this.getCiteLink(n,i)}):t.replace(o,"");else if(a&&a.length>0&&/\[\d+\]/.test(t)){let e=a.map(e=>{let{key:t}=e;return t}),i=e.includes("0");i&&(a=a.map(e=>{let t=Number(e.key);return isNaN(t)?e:{...e,key:(t+1).toString()}})),s=t.replace(/\[(\d+)\]/g,(t,a)=>{if(!e.includes(a))return n?t:"";if(i){let e=Number(a);return isNaN(e)?"":this.getCiteLink(e+1)}return this.getCiteLink(a)})}else if((null==a?void 0:a.length)&&/\[\^\d+\^\]/.test(t)){let e=a.map(e=>{let{key:t}=e;return t});s=t.replace(/\[\^(\d+)\^\]/g,(t,a)=>{if(!e.includes(a))return t;let[n,i]=d(a);return this.getCiteLink(n,i)})}let c=a||[];return Object.keys(i).length>0&&!1===n&&(c=c.filter(e=>!!i[e.key]).map(e=>{let{key:t,...a}=e;return{key:i[t],...a}}).sort((e,t)=>e.key-t.key).map(e=>{let{key:t,...a}=e;return{key:t.toString(),...a}})),{text:s,sources:c};function d(t){var n,o;let r;return(i[t]?r=i[t]:(r=l,i[t]=r,l++),"article"===e||"web_search"===e||"webpage_chunk"===e)?[r,""]:[Number(r),null===(o=a[Number(t)-1])||void 0===o?void 0:null===(n=o.data)||void 0===n?void 0:n.text]}}normalizeReplyContent(e){return e.replace(o,(e,t)=>"[".concat(t,"]")).trim()}normalizeForSpeak(e){let t=e,a=/\[(.*?)\]\((.*?)\)/g;return a.test(e)&&(t=t.replaceAll(a,"")),t.replaceAll(/\*\*(.*?)\*\*/g,"$1")}getMarkdownLinkStr(e,t){return"[".concat(e,"](").concat(t,")")}parseArtifactContent(e){let t=[],a=a=>{let n,{artifactStart:i,multiArtifactRegex:o,singleArtifactRegex:r}=a;if(!e.includes(i))return null;for(;null!==(n=o.exec(e));){n.index===o.lastIndex&&o.lastIndex++;let a=!0,s="";r.test(n[0])?(s=n[1].trim(),a=!1):s=e.substring(e.lastIndexOf(i)+i.length);let l=s.split("\n");l[0].trim()||l.splice(0,1);let c=e=>{var t;return null===(t=l.slice(0,4).find(t=>t.trim().startsWith("".concat(e,":"))))||void 0===t?void 0:t.replace("".concat(e,":"),"").trim()},d=c("id")||"",u=c("name")||"",h=c("type")||"",p=l.slice(4).map(e=>e.startsWith("  ")?e.slice(2):e).join("\n");if(!d&&!u&&!h&&!e)break;let m={id:d,name:u,type:h.trim(),content:p};t.push({data:m,streaming:a})}return t},n=a({singleArtifactRegex:/````artifact\s?([\s\S]*)````/,multiArtifactRegex:/````artifact\s?\n([\s\S]*?)(?:````|$)/g,artifactStart:"````artifact"});return n||(n=a({singleArtifactRegex:/```artifact\s?([\s\S]*)```/,multiArtifactRegex:/```artifact\s?\n([\s\S]*?)(?:```|$)/g,artifactStart:"```artifact"})),n}transformArtifactContent(e){let t=(e,t)=>"".concat(e,": ").concat(t);return"````artifact\n".concat([t("id",e.id),t("name",e.name),t("type",e.type),"content: |-\n".concat(e.content)].join("\n"),"\n````")}summaryChatItems(e){let t="";return e.forEach(e=>{t+="".concat(e.summary,"/n")}),t}getCiteLink(e,t){return t||(t="#__".concat(e)),"[[".concat(e,"]](").concat(t,")")}constructor(){(0,n._)(this,"searchEnhanceTransformers",new l(this))}}let d=new c},87331:function(e,t,a){a.d(t,{C:function(){return o}});var n=a(66084);class i{markPaid(){this.postMessage("markPaid")}onMarkPaid(e){let t=t=>{var a;(null===(a=t.data)||void 0===a?void 0:a.evtName)==="markPaid"&&e()};return this.broadcaster?(this.broadcaster.addEventListener("message",t),()=>{var e;null===(e=this.broadcaster)||void 0===e||e.removeEventListener("message",t)}):null}postMessage(e){this.broadcaster&&this.broadcaster.postMessage({evtName:e})}constructor(){(0,n._)(this,"broadcaster",void 0);try{this.broadcaster=new BroadcastChannel("monica-web-broadcast")}catch(e){console.log("[Not Support BroadcastChannel]")}}}let o=new i},70460:function(e,t,a){a.d(t,{Z:function(){return p}});var n=a(66084),i=a(88575),o=a(92235),r=a(88882),s=a(82270),l=a(76469),c=a(65324),d=a(73361),u=a(38172);let h=i.c.getLogger("MonicaService");class p{get host(){return this.context.apiHost}get storage(){return this.context.storage}get services(){return this.context.services}async onTabUnload(e){}genTaskId(){return"task:".concat(o.m.genId())}async cancelTask(e){let t=this.pendingTasks[e];h.debug("cancel task",t),t&&(t.abortController.abort(),await this.markTaskFinished(t,t.taskType))}async createGenerationTask(e){let{taskInfo:t,onData:a,onAbort:n,taskData:i,path:o,botData:s,toolData:l}=e;this.pendingTasks[t.taskId]={...t,taskType:i.taskType};let c=t.abortController.signal;if(c.aborted)return;let d=r.a.locale,u=await this.fetchServerGeneration({...i,taskUid:t.taskId,language:e.language,aiRespLanguage:e.aiRespLanguage,locale:d,abortSignal:c,path:o,botUid:i.botUid,botData:s,toolData:l});await this.processStreamingResponse({response:u,onData:a,onAbort:n,onFinished:()=>{this.markTaskFinished(t,i.taskType)}})}async fetchStreamApi(e){let{endpoint:t,data:a,taskInfo:n,onData:i,onAbort:r}=e,s=n.abortController.signal;if(s.aborted)return;let l=await c.Lx.request({url:t,headers:(0,c.D3)(),method:"POST",signal:s,data:JSON.stringify(o.m.underlize(a)),stream:!0});await this.processStreamingResponse({response:l,onAbort:r,onData:i,onFinished:()=>{}})}async fetchServerGeneration(e){let t="".concat(this.context.apiHost).concat(e.path||"/generate/gen"),a={taskUid:e.taskUid,botUid:e.botUid,data:e.data,language:e.language,locale:e.locale,taskType:e.taskType,toolData:e.toolData,botData:e.botData,aiRespLanguage:e.aiRespLanguage};return c.Lx.request({url:t,headers:(0,c.D3)(),method:"POST",signal:e.abortSignal,data:JSON.stringify(o.m.underlize(a)),stream:!0})}findAndCancelTasks(e){for(let t of Object.keys(this.pendingTasks))e(this.pendingTasks[t])&&this.cancelTask(t)}parseStreamResult(e){let t;if(!e)return{text:"",finished:!1};if("[DONE]"===e)return{text:"",finished:!0};try{t=JSON.parse(e)}catch(e){throw h.error("parse msg error",e),s.Eg.invalidMessageContent}let a=o.m.camelize(t);if(a.error){if(10002===a.error.code)throw s.Eg.quotaExceeded;if(10009===a.error.code)throw s.Eg.readingQuotaExceeded;if(10014===a.error.code)throw s.Eg.webSearchExceeded;if(a.error.code===s.E0.creditsQuotaExceed)throw s.Eg.creditsQuotaExceed;if(30025===a.error.code)throw u.W.triggerDeviceExceededLimit(!0),s.Eg.loginDeviceExceeded;throw"(".concat(a.error.code,") ").concat(a.error.msg)}let n=a.finished||!1;return{...a,error:void 0,finished:n}}async markTaskFinished(e,t){delete this.pendingTasks[e.taskId],setTimeout(()=>{"gen_title"!==t&&d.gM.updateUsageInfos(e.usageModules)},1e3)}async processStreamingResponse(e){var t;let{response:a,onAbort:n,onData:i,onFinished:r}=e;if(h.log("start process streaming response"),null===(t=a.contentType)||void 0===t?void 0:t.includes("application/json")){let e;if(!(e="string"==typeof a.data?JSON.parse(a.data):a.data).code)throw h.error(s.Eg.invalidMessageContent),s.Eg.invalidMessageContent;if(30025===e.code)throw h.error(s.Eg.loginDeviceExceeded),u.W.triggerDeviceExceededLimit(!0),s.Eg.loginDeviceExceeded;throw h.error("(".concat(e.code,") ").concat(e.msg||s.Eg.unknownServerError)),"(".concat(e.code,") ").concat(e.msg||s.Eg.unknownServerError)}if(200!==a.status)throw h.error("start process streaming response error ".concat(a.statusText,"(").concat(a.status,")")),"".concat(a.statusText,"(").concat(a.status,")");let l=new TextDecoder,c=a.data,d=!1,p="",m=/\r?\n\r?\n/,g=/\r?\n\r?\n$/,v=!1;c.on("data",e=>{try{let t=l.decode(e);if(p+=t,!g.test(p))return;let a=p.trim().split(m);for(let e of(p="",a)){let t=e.replace(/^data:/,"").trim(),a=null;try{a=this.parseStreamResult(t)}catch(e){i({finished:!0,text:"",error:o.m.formatMonicaSdkError(e)});break}h.log("get chunkData",a);let{text:n=""}=a;d||(n=n.replace(/^\n*/,"")),n.length>0&&(d=!0),i({...a,text:n}),a.agentStatus||(v=!0),a.finished&&r()}}catch(e){v?n():i({finished:!0,text:"",error:o.m.formatMonicaSdkError(e)})}}),c.on("error",e=>{o.m.formatMonicaSdkError(e).includes("network error")?(i({finished:!0,text:""}),i({text:"",partialStart:!0,finished:!1}),i({text:"",error:"Failed to fetch, please check your network",finished:!0})):v||"AbortError"===e.name?n():i({finished:!0,text:"",error:o.m.formatMonicaSdkError(e)})})}constructor(e){(0,n._)(this,"context",void 0),(0,n._)(this,"events",void 0),(0,n._)(this,"initReady",void 0),(0,n._)(this,"pendingTasks",void 0),this.context=e,this.events=new l.v,this.initReady=!1,this.pendingTasks={},this.init().then(()=>{this.initReady=!0,this.events.emit("initReady")})}}},91433:function(e,t,a){a.d(t,{Q7:function(){return s},Z9:function(){return n},f2:function(){return l},qJ:function(){return i},tW:function(){return o},vH:function(){return r}});let n={monica:a(92660).yT,genius:"genius",artist:"artist",notification:"notification",artifactBuilder:"artifact_builder"},i={makeItMore:"makeItMore",rizzBot:"rizz_bot",gpt4o:"gpt_4_o_chat",claude3Sonnet:"claude_3_sonnet",claude3Opus:"claude_3_opus",claude35Sonnet:"claude_3.5_sonnet",claude37Sonnet:"claude_3_7_sonnet",claude:"claude",llama370b:"llama_3_70b",gemini15Pro:"gemini_1_5",deepseekR1:"deepseek_reasoner"},o={searchAgent:"search_agent",writingAgent:"writing_agent",autoAgent:"auto_agent"},r={dalle3:"dalle3"},s="gpt-4o-mini",l="gpt-4o"},3978:function(e,t,a){a.d(t,{aS:function(){return h}});var n=a(83260),i=a(66084),o=a(88882),r=a(56607),s=a(65324),l=a(55180),c=a(74024),d=a(91433);class u extends l.b{async onInit(){this.storage.addChangeListener(e=>{e.allChatBotList&&this.emit("allChatBotListChange",e.allChatBotList),e.allArtistBotList&&this.emit("allArtistBotListChange",e.allArtistBotList),e.compareBotList&&this.emit("compareBotListChange",e.compareBotList),e.monicaLastMsgTime&&this.emit("monicaLastMsgTimeChange",e.monicaLastMsgTime),e.recentBotsDeleteTime&&this.emit("recentBotsDeleteTimeChange",e.recentBotsDeleteTime)}),o.a.on("localeChange",()=>{this.getAllChatBotList({useCache:!1}),this.getAllArtistBotList({useCache:!1}),this.getCompareBotList({useCache:!1})}),this.services.user.on("userLogout",()=>{this.storage.update({allArtistBotList:[],allChatBotList:[],monicaLastMsgTime:null,recentBotsDeleteTime:null})}),this.services.user.on("userInfoChange",e=>{e&&r.o.isExtension&&(this.getAllChatBotList({useCache:!1}),this.getAllArtistBotList({useCache:!1}))})}getAllChatBotList(e){return this._fetchWithCache("allChatBotList",async()=>{var e,t,a;let n=await s.Cb.botFrameworkService.customBotApi.listMyPinedBot({});return[...null!==(e=n.data.pinBots)&&void 0!==e?e:[],...(null!==(t=n.data.featured)&&void 0!==t?t:[]).map(e=>({...e,isFeatured:!0})),...null!==(a=n.data.recent)&&void 0!==a?a:[]].reduce((e,t)=>{let a=e.findIndex(e=>e.uid===t.uid);return -1!==a?t.isFeatured&&(e[a]=t):e.push(t),e},[])},e)}getAllArtistBotList(e,t){return this._fetchWithCache("allArtistBotList",async()=>{let e=await s.Cb.botFrameworkService.customBotApi.listArtistBot({tab:"explore",exploreExcludeMine:!1,classification:"all"});return setTimeout(()=>{null==t||t()},0),e.data.items||[]},e)}async searchExploreBots(e){let{data:t}=await s.Cb.botFrameworkService.customBotApi.searchChatBots(e);return t.items||[]}async toggleBotPin(e,t,a){let n="chat"===a?"allChatBotList":"allArtistBotList",i=await this.getStorage(n),o=i.findIndex(t=>t.uid===e.uid);if(-1===o){let a={...e,userAction:{...e.userAction,actionPinned:t,actionPinnedTime:new Date().toString()}};i.push(a)}else i[o]={...i[o],userAction:{...i[o].userAction,actionPinned:t,actionPinnedTime:new Date().toString()}};return this.setStorage(n,i),await s.Cb.botFrameworkService.customBotApi.pinBot({uid:e.uid,pin:t})}async updateBotLastMsgTime(e){let t=await this.getStorage("allChatBotList")||[];if(e===d.Z9.monica){this.setStorage("monicaLastMsgTime",new Date().toString());return}let a=t.findIndex(t=>t.uid===e);-1!==a&&(t[a]={...t[a],lastMessageInfo:{lastMessageTime:new Date().toString()}}),this.setStorage("allChatBotList",t)}async updateRecentBotDeletedTime(e){let t=await this.getStorage("recentBotsDeleteTime")||{};t[e]=new Date().getTime(),this.setStorage("recentBotsDeleteTime",t)}async getRecentBotsDeletedTime(){return this.getStorage("recentBotsDeleteTime")}async getBotDetail(e){return s.Cb.botFrameworkService.customBotApi.getBotDetail({uid:e})}async updateCustomBotConfig(e){let t=await this.getStorage("allChatBotList")||[],a=t.findIndex(t=>t.uid===e.uid);if(-1===a)return;let n=t[a],i=(0,c.Z)(n,e);t[a]=i,await this.setStorage("allChatBotList",t)}async addChatBot(e){let t=await this.getStorage("allChatBotList")||[];t.some(t=>t.uid===e.uid)||t.push(e),await this.setStorage("allChatBotList",t)}async userAction(e){return s.Cb.appsApi.userAction(e)}async getCompareBotList(e){return this._fetchWithCache("compareBotList",async()=>{let{data:e}=await s.Cb.botFrameworkService.customBotApi.listCompareBot({});return e.items||[]},e)}async getStorage(e){return this.storage.get(e)}async setStorage(e,t){this.storage.set(e,t)}async feedbackChatLike(e){return s.Cb.botFrameworkService.feedbackApi.chatLike(e)}constructor(...e){super(...e),(0,i._)(this,"meta",{key:"bot",name:"BotServiceV2"}),(0,i._)(this,"dependencies",["user"]),(0,i._)(this,"defaultStorageValues",{allChatBotList:[],allArtistBotList:[],compareBotList:[],monicaLastMsgTime:null,recentBotsDeleteTime:null})}}let h=new n.x(u)},95362:function(e,t,a){var n,i;a.d(t,{MonicaChatTypeCheckers:function(){return n}}),(i=n||(n={})).isErrorReply=function(e){return"reply"===e.itemType&&"error"===e.data.type},i.isGuide=function(e){return"guide"===e.itemType},i.isIntent=function(e){return"intent"===e.itemType},i.isReply=function(e){return"reply"===e.itemType},i.isQuestion=function(e){return"question"===e.itemType},i.isTextQuestion=function(e){return"question"===e.itemType&&"text"===e.data.type},i.isChatMessage=function(e){return"reply"===e.itemType||"question"===e.itemType},i.isReadEnhanceReply=function(e){return"reply"===e.itemType&&"read_enhance"===e.data.type},i.isSavedMemoReply=function(e){return"reply"===e.itemType&&"memo"===e.data.type},i.isVideoSummaryReply=function(e){return"reply"===e.itemType&&"video_summary"===e.data.type},i.isAIFormReply=function(e){var t,a;return"reply"===e.itemType&&(null===(a=e.data)||void 0===a?void 0:null===(t=a.agentStatus)||void 0===t?void 0:t.some(e=>"ai_form"===e.type))},i.isChatPdfQuestion=function(e){return(null==e?void 0:e.itemType)==="question"&&"chat_pdf"===e.data.type}},24900:function(e,t,a){a.d(t,{Tn:function(){return X}});var n=a(83260),i=a(66084),o=a(56607),r=a(92235),s=a(60445),l=a(65324),c=a(55180),d=a(40814),u=a(58756),h=a(14527),p=a(70460);class m extends p.Z{async init(){}async onTabUnload(e){this.findAndCancelTasks(t=>t.tabId===e)}async generate(e,t){let a;return a=e.taskId?e.taskId:this.genTaskId(),this.createGenerationTask({language:"auto",path:"/smart_action/use",taskData:{taskType:"apps:action_use_task",data:e},taskInfo:{taskId:a,abortController:new AbortController,usageModules:["basic_query"]},onData:t,onAbort:()=>{console.log("generation aborted")}}).catch(e=>{console.error(e),t({text:"",error:r.m.formatMonicaSdkError(e),finished:!0})}),{taskId:a}}}class g extends p.Z{async init(){}async onTabUnload(e){this.findAndCancelTasks(t=>t.tabId===e)}async generate(e,t,a){let n=this.genTaskId();console.log(t,a);let i="",o="".concat(this.pathPrefix,"/generate");return this.createGenerationTask({language:"auto",path:o,taskData:{taskType:t.skillUid?"apps:exec_skill_task":"apps:preview_skill_task",data:t},taskInfo:{taskId:n,tabId:e,abortController:new AbortController,usageModules:["basic_query"]},onData:e=>{let{text:t,finished:n,error:o}=e;t&&(i+=t),a({text:t,fullText:i},n,o)},onAbort:()=>{console.log("generation aborted")}}).catch(e=>{console.error(e),a(null,!0,"".concat(e))}),{taskId:n}}constructor(...e){super(...e),(0,i._)(this,"pathPrefix","/apps")}}var v=a(39936),f=a(95362),y=a(3978),b=a(91433),C=a(11502),S=a(88575),I=a(92660),k=a(82270),w=a(88882),T=a(2151),x=a(73047);class P{async init(){}async get(e){return await this.storage.get(e)}async set(e,t){try{await this.storage.set(e,t);let a=await this.storage.get("conversationIds")||[];a.includes(e)||(a.push(e),await this.storage.set("conversationIds",a)),a&&a.length>this.getMaxStorageSize()+3&&this.removeOutdatedStorage([e])}catch(a){await this.removeAllChatStorage(),await this.storage.set(e,t),await this.storage.set("conversationIds",[e])}}async delete(e){await this.storage.delete(e);let t=await this.storage.get("conversationIds");if(t){let a=t.filter(t=>t!==e);await this.storage.set("conversationIds",a)}}async removeOutdatedStorage(e){let t=this.getMaxStorageSize(),a=await this.storage.get("conversationIds");if(a&&a.length>t){let n=await this.storage.getByKeys(a),i=[],o=[];for(let e=0;e<a.length;e++){let t=a[e],r=n[t];r?i.push(r):o.push(t)}if(i.length>t){i.sort((e,t)=>{let a=e.lastMessageTime||e.updatedAt||e.createdAt||0;return(t.lastMessageTime||t.updatedAt||t.createdAt||0)-a});let n=i.length-t;for(let t=0;t<n;t++){let n=i[i.length-1-t].id;e.includes(n)||(await this.storage.delete(n),a=a.filter(e=>e!==n))}o.length>0&&(a=a.filter(e=>!o.includes(e))),await this.storage.set("conversationIds",a)}}}async removeAllChatStorage(){let e=await this.storage.get("conversationIds");if(e)for(let t=0;t<e.length;t++){let a=e[t];await this.delete(a)}}getMaxStorageSize(){return o.o.isWeb?5:10}constructor(e){(0,i._)(this,"storage",void 0),this.storage=e}}let _=S.c.getLogger("MonicaService");class L extends p.Z{async init(){setTimeout(async()=>{this.conversations=new P(this.storage),await this.conversations.init(),this.readySource.markReady()})}async createConversation(e){let{botInfo:t,tabInfo:a}=e,n="conv:".concat(r.m.genId()),i=this.createReply(n,I.om,void 0);return{id:n,items:[i],createdAt:Date.now(),updatedAt:Date.now(),chatBotUid:t.id,origin:null==a?void 0:a.url,originPageTitle:null==a?void 0:a.title}}async retryQuestion(e,t,a){let{conversationId:n,questionId:i,type:o}=e,r=await this.getConversation(n,"cacheFirst"),s=(null==r?void 0:r.items.find(e=>f.MonicaChatTypeCheckers.isQuestion(e)&&e.itemId===i))||null;if(!s)throw k.Eg.questionNotFound;return this.doAskQuestion(s,e.tabInfo,e.botInfo,t,e.conversationOptions,{type:o},void 0,a)}async askQuestion(e,t,a,n){var i;if(!e.content.trim()&&!e.imgUrl&&!(null===(i=e.fileInfos)||void 0===i?void 0:i.length))throw k.Eg.messageIsEmpty;await this.checkCreateConversation(e.conversationInfo);let o=this.createQuestion(e.conversationInfo.id,e.content,e.parentItemId,e.type,e.quoteContent,e.fromBotTask);o.data.imgUrl=e.imgUrl,o.data.actionId=e.actionId,o.data.atBotInfo=e.atBotInfo,o.data.fileInfos=e.fileInfos,o.data.chatModel=e.conversationOptions.chatModel,o.data.skillCardInfo=e.skillCard,o.data.chatTemplate=e.chatTemplate,o.data.pdfInfos=e.pdfInfos,o.data.maxToken=e.conversationOptions.maxToken,o.data.chatPdfWithGenMindMap=e.chatPdfWithGenMindMap,o.data.isIncognito=e.conversationOptions.isIncognito;let{taskId:r,reply:s}=await this.doAskQuestion(o,e.tabInfo,e.botInfo,t,e.conversationOptions,void 0,a,n);return{taskId:r,question:o,reply:s}}async compareQuestion(e,t){var a,n;if(!e.content.trim()&&!e.imgUrl&&!(null===(a=e.fileInfos)||void 0===a?void 0:a.length))throw k.Eg.messageIsEmpty;await this.checkCreateConversation(e.conversationInfo);let i=await this.getConversation(e.conversationInfo.id,"cacheFirst"),{botInfo:r,conversationOptions:s,tabInfo:l}=e,c=this.createQuestion(i.id,e.content,e.parentItemId||this.getLastItemId(i),e.type,e.quoteContent,e.fromBotTask);c.data.imgUrl=e.imgUrl,c.data.actionId=e.actionId,c.data.atBotInfo=e.atBotInfo,c.data.fileInfos=e.fileInfos,c.data.chatModel=s.chatModel,c.data.chatTemplate=e.chatTemplate,c.data.skillCardInfo=e.skillCard,c.data.isIncognito=e.conversationOptions.isIncognito;let d=this.genTaskId(),u=c.conversationId,h=this.createReply(u,"",c.itemId);h.data.questionId=c.itemId;let p=h.itemId;c.data.atBotInfo&&(h.data.atBotInfo=c.data.atBotInfo);let m=e=>{_.error(e);let a="".concat(e),n=this.createErrorReply(h,a);t(n,!0,a),this.addChatItem(n)};try{let a="chat",{respondLanguage:i="auto",aiRespLanguage:g,useModel:v,knowledgeSource:f,isVip:b,sysSkills:C,useNewMemory:S,useMemorySuggestion:I}=JSON.parse(JSON.stringify(s||{})),k=(null==s?void 0:s.manualWebSearchEnabled)||!1,w=null==C?void 0:C.find(e=>"web_access"===e.uid);(null==w?void 0:w.enable)&&!b&&(k=!0),h.data.fromTaskType=a,h.data.manualWebSearchEnabled=k,h.data.useModel=c.data.atBotInfo?null===(n=c.data.atBotInfo)||void 0===n?void 0:n.useMode:null==s?void 0:s.useModel;let T=!1,x=["gpt-4"===v?"genius_bot":r.usageModule];k&&x.push("web_search"),o.o.isChatPDF&&x.push("reading_pdf"),"file_with_text"===c.data.type&&x.push("reading_pdf");let P=0;this.createGenerationTask({language:i,aiRespLanguage:g,path:"/custom_bot/compare_chat",taskData:{taskType:a,data:{conversationId:u,items:[c],preGeneratedReplyId:h.itemId,preParentItemId:h.parentItemId||"",origin:l.url,originPageTitle:l.title.trim().slice(0,120),triggerBy:"auto",useModel:v,knowledgeSource:f,useNewMemory:S,useMemorySuggestion:I},botUid:e.atBotInfo.uid},taskInfo:{taskId:d,conversationId:u,abortController:new AbortController,usageModules:x},onData:e=>{let a=e.partialStart;if(a){P++;let e=h.itemId;h.itemId="".concat(p,"-").concat(P),h.data.content="",h.data.agentStatus=[],h.summary="",h.parentItemId=e}let n=e.finished||!!e.error;if(this.updateReplyData(h,e),e.error&&(h.data.type="error",h.summary=e.error,h.data.content=e.error),t(h,n,e.error,a),n){var i;T=!0,y.aS.updateBotLastMsgTime((null===(i=c.data.atBotInfo)||void 0===i?void 0:i.uid)||r.id),_.debug("reply finished successfully",h)}},onAbort:()=>{!T&&h.data.content.trim()&&_.debug("aborted, save partial message",h)}}).catch(m)}catch(e){m(e)}return{taskId:d,reply:h,question:c}}async runSaveMemoAction(e){let{conversationInfo:t,actionId:a,question:n}=e;await this.checkCreateConversation(t);let i=await this.getConversation(t.id,"cacheFirst"),o=this.createQuestion(i.id,n,this.getLastItemId(i));o.data.type="action",o.data.actionId=a;let r=[o];return i.items.push(...r),await this.updateConversionChatItems(i.id,i.items),r}async afterSaveMemoAction(e){let{conversationInfo:t,memoInfo:a}=e,n=await this.getConversation(t.id,"cacheFirst"),i=this.createReply(n.id,w.S.Global.services.monicaService.savedMemoForYou,this.getLastItemId(n));i.data.type="memo",i.data.memoInfo=a,i.data.memoSource="create";let o=[i];return n.items.push(...o),await this.updateConversionChatItems(n.id,n.items),o}async continueScreenRecognitionInChat(e){let{conversationInfo:t,firstQuestion:a,firstQuestionAnswer:n,imgUrl:i}=e;await this.checkCreateConversation(t);let o=await this.getConversation(t.id,"cacheFirst"),r=this.createQuestion(o.id,a,this.getLastItemId(o));r.data.imgUrl=i,r.data.type="image_with_text";let s=this.createReply(o.id,n,r.itemId),l=[r,s];return o.items.push(...l),await this.updateConversionChatItems(o.id,o.items),l}async continueQuickActionInChat(e){var t;let{conversationInfo:a,promptContent:n,result:i,selectedText:o}=e;await this.checkCreateConversation(a);let r=await this.getConversation(a.id,"cacheFirst"),s=await this.createIntentCandidate({conversationInfo:a,type:"selection",content:o,parentItemId:this.getLastItemId(r)}),l=this.createQuestion(s.conversationId,n,null===(t=s.data.replies[s.data.replies.length-1])||void 0===t?void 0:t.itemId);l.data.intentId=s.itemId;let c=this.createReply(r.id,i,l.itemId),d=[s,...s.data.replies,l,c];return r.items.push(...d),await this.updateConversionChatItems(r.id,r.items),d}async continueSearchEnhanceInChat(e){let{conversationInfo:t,question:a,response:n,agentStatus:i}=e;await this.checkCreateConversation(t);let o=await this.getConversation(t.id,"cacheFirst"),r=this.createQuestion(o.id,a,this.getLastItemId(o)),s=this.createReply(o.id,n,r.itemId);s.data.agentStatus=i;let l=[r,s];return o.items.push(...l),await this.updateConversionChatItems(o.id,o.items),l}async continueVideoSummaryInChat(e){let{conversationInfo:t,summaryInfo:a,agentStatus:n}=e;await this.checkCreateConversation(t);let i=await this.getConversation(t.id,"cacheFirst"),o=v.C.getMarkdownLinkStr(a.videoTitle,a.videoUrl),r=this.createQuestion(i.id,(0,w.x)(w.S.Global.services.monicaService.videoSummaryProceed,{videoTitle:o}),this.getLastItemId(i)),s=this.createReply(i.id,a.summary,r.itemId);s.data.type="video_summary",s.data.videoSummaryInfo=a,s.data.agentStatus=n;let l=[r,s];return i.items.push(...l),await this.updateConversionChatItems(i.id,i.items),l}async continueReadingInChat(e){let{conversationInfo:t,summary:a,suggestions:n,title:i,url:o}=e;await this.checkCreateConversation(t);let r=await this.getConversation(t.id,"cacheFirst"),s=v.C.getMarkdownLinkStr(i,o),l=this.getLastItemId(r),c=this.createQuestion(r.id,(0,w.x)(w.S.Global.services.monicaService.readingSummaryProceed,{articleTitle:s}),l),d=this.createReply(r.id,a,c.itemId);d.data.type="read_enhance",d.data.suggestions=n,e.hideWelcomeReply&&(d.parentItemId=l);let u=e.hideWelcomeReply?[d]:[c,d];return r.items.push(...u),await this.updateConversionChatItems(r.id,r.items),u}async quickAskContinueInChat(e){let{conversationInfo:t,question:a,quote:n,content:i}=e;await this.checkCreateConversation(t);let o=await this.getConversation(t.id,"cacheFirst"),r=this.createQuestion(o.id,a,this.getLastItemId(o));n&&(r.data.quoteContent=n,r.data.type="quote");let s=this.createReply(o.id,i,r.itemId),l=[r,s];return o.items.push(...l),await this.updateConversionChatItems(o.id,o.items),l}async realtimeContinueInChat(e){let{conversationInfo:t,items:a}=e;await this.checkCreateConversation(t);let n=await this.getConversation(t.id,"cacheFirst"),i=this.getLastItemId(n),o=a.map(e=>{if("user"===e.role){let t=this.createQuestion(n.id,e.formatted.transcript,i);return i=t.itemId,t}let t=this.createReply(n.id,e.formatted.transcript,i);return i=t.itemId,t});return await this.updateConversionChatItems(n.id,o),o}async commonContinueInChat(e){let{conversationInfo:t,content:a}=e;await this.checkCreateConversation(t);let n=await this.getConversation(t.id,"cacheFirst"),i=this.createQuestion(n.id,a,this.getLastItemId(n)),o=this.createReply(n.id,a,i.itemId),r=[i,o];return n.items.push(...r),await this.updateConversionChatItems(n.id,n.items),r}async fetchPdfConversationList(e,t){let{offset:a,pdfId:n}=e,i="MonicaChatPdf:".concat(n),{useCache:o=!1,cacheOnly:r}=t||{},s=async()=>{let n=await l.Cb.taskApi.getChatpdfConversationList(e,t);if(0===a&&i){var o;let e=await this.storage.get("conversationList");e[i]=null!==(o=n.conversationList.itemList)&&void 0!==o?o:[],await this.storage.update({conversationList:e})}return n};if(i&&0===a&&o){let e=await this.storage.get("conversationList");return r||s(),{conversationList:{itemList:e[i]||[],total:a}}}return s()}async updateConversationTitle(e,t,a){await l.Cb.taskApi.updateConversation({conversationId:e,title:t});let n=await this.conversations.get(e);n&&await this.conversations.set(e,{...n,title:t});let i=await this.storage.get("conversationList");if(i[a]){let n=i[a].map(a=>a.conversationId===e?{...a,title:t}:a);i[a]=n,this.storage.update({conversationList:i})}}async clearConversationList(e){let t=await l.Cb.taskApi.clearConversationList(e);if(t){let t=await this.storage.get("conversationList");e.botUid&&[e.botUid]&&(t[e.botUid]=[],this.storage.update({conversationList:t}))}return t}async removeConversationHistory(e){let{botId:t,conversationId:a}=e;await l.Cb.taskApi.delConversation({conversationId:a});let n=await this.storage.get("conversationList");if(n[t]){let e=n[t].filter(e=>e.conversationId!==a);n[t]=e,this.storage.update({conversationList:n})}}async deleteConversationList(e){await l.Cb.taskApi.deleteConversationList(e)}async doAskQuestion(e,t,a,n,i,r,s,l){let c=this.genTaskId(),d=e.conversationId,u=this.createReply(d,"",e.itemId);u.data.questionId=e.itemId;let h=u.itemId;e.data.atBotInfo&&(u.data.atBotInfo=e.data.atBotInfo),(null==r?void 0:r.deletedReplyId)&&(u.itemId=r.deletedReplyId);let p=e=>{_.error(e);let t="".concat(e),a=this.createErrorReply(u,t);n(a,!0,t),this.addChatItem(a)};try{var m,g;let v="chat";(null==a?void 0:a.sendTaskType)?v=a.sendTaskType:a.id===b.Z9.monica?v="chat":a.id===b.Z9.genius&&(v="bot_chat");let{respondLanguage:f="auto",aiRespLanguage:S,useModel:I,knowledgeSource:k,isVip:w,sysSkills:T,createBotData:x,chatWithMemoEnabled:P,manualArtifactEnabled:L,useNewMemory:M,useMemorySuggestion:D,renderItemsToSync:A}=JSON.parse(JSON.stringify(i||{})),N=void 0!==x,E=(null==i?void 0:i.manualWebSearchEnabled)||!1,j=null==T?void 0:T.find(e=>"web_access"===e.uid);(null==j?void 0:j.enable)&&!w&&(E=!0),u.data.fromTaskType=v,u.data.manualWebSearchEnabled=E,u.data.useModel=e.data.atBotInfo?null===(m=e.data.atBotInfo)||void 0===m?void 0:m.useMode:null==i?void 0:i.useModel,r||await this.addChatItem(e);let B=!1,{itemsToSync:R}=await this.getNewItemsForSync(d),F=this.mergeChatItemsToSync(A||[],R),U=["gpt-4"===I?"genius_bot":a.usageModule,"credits"];E&&U.push("web_search"),o.o.isChatPDF&&U.push("reading_pdf"),"file_with_text"===e.data.type&&U.push("reading_pdf");let z=0,O=t=>{var a,n,i,o,r,s,l,c,d,u,h,p,m,g,v,f,y,b,C,S,I,k;if(E&&(j?(j.enable=!0,j.forceEnable=!0):null===(l=t.sysSkillList)||void 0===l||l.push({uid:"web_access",forceEnable:!0,enable:!0})),P){let e=null===(c=t.sysSkillList)||void 0===c?void 0:c.find(e=>"chat_with_memo"===e.uid);e?e.enable=!0:null===(d=t.sysSkillList)||void 0===d||d.push({uid:"chat_with_memo",enable:!0})}else t.sysSkillList=null===(u=t.sysSkillList)||void 0===u?void 0:u.filter(e=>"chat_with_memo"!==e.uid);if((null===(a=e.data.skillCardInfo)||void 0===a?void 0:a.skillType)==="search"){let e=null===(h=t.sysSkillList)||void 0===h?void 0:h.find(e=>"web_access"===e.uid);e?(e.enable=!0,e.forceEnable=!0):null===(p=t.sysSkillList)||void 0===p||p.push({uid:"web_access",enable:!0,forceEnable:!0})}if((null===(n=e.data.skillCardInfo)||void 0===n?void 0:n.skillType)==="draw"){let e=null===(m=t.sysSkillList)||void 0===m?void 0:m.find(e=>"draw_image"===e.uid);e?(e.enable=!0,e.forceEnable=!0):null===(g=t.sysSkillList)||void 0===g||g.push({uid:"draw_image",enable:!0,forceEnable:!0})}if((null===(i=e.data.skillCardInfo)||void 0===i?void 0:i.skillType)==="code_interpreter"){let e=null===(v=t.sysSkillList)||void 0===v?void 0:v.find(e=>"code_interpreter"===e.uid);e?(e.enable=!0,e.forceEnable=!0):null===(f=t.sysSkillList)||void 0===f||f.push({uid:"code_interpreter",enable:!0,forceEnable:!0})}if((null===(o=e.data.skillCardInfo)||void 0===o?void 0:o.skillType)==="artifacts"||L){let e=null===(y=t.sysSkillList)||void 0===y?void 0:y.find(e=>"artifacts"===e.uid);e?(e.enable=!0,e.forceEnable=!0):null===(b=t.sysSkillList)||void 0===b||b.push({uid:"artifacts",enable:!0,forceEnable:!0})}if((null===(r=e.data.skillCardInfo)||void 0===r?void 0:r.skillType)==="book_calendar"){let e=null===(C=t.sysSkillList)||void 0===C?void 0:C.find(e=>"book_calendar"===e.uid);e?(e.enable=!0,e.forceEnable=!0):null===(S=t.sysSkillList)||void 0===S||S.push({uid:"book_calendar",enable:!0,forceEnable:!0})}if(e.data.fromBotTask){let e=null===(I=t.sysSkillList)||void 0===I?void 0:I.find(e=>"run_task"===e.uid);e?(e.enable=!0,e.forceEnable=!0):null===(k=t.sysSkillList)||void 0===k||k.push({uid:"run_task",enable:!0,forceEnable:!0})}t.sysSkillList=null===(s=t.sysSkillList)||void 0===s?void 0:s.filter(e=>e.enable||e.forceEnable||"memo_access"!==e.uid)};this.createGenerationTask({language:f,aiRespLanguage:S,botData:(()=>{if(N)return x.toolData&&O(x.toolData),x})(),toolData:(()=>{var t;if(N)return;let a={};return a.sysSkillList=T,O(a),"skill_card"===e.data.type&&(null===(t=e.data.skillCardInfo)||void 0===t?void 0:t.skillType)==="search"&&(a.clientSearch=!(null==i?void 0:i.isVip)),a})(),path:N?"/custom_bot/preview_chat":"/custom_bot/chat",taskData:{taskType:v,data:{conversationId:d,items:F,preGeneratedReplyId:u.itemId,preParentItemId:u.parentItemId||"",origin:t.url,originPageTitle:t.title.trim().slice(0,120),triggerBy:r?r.type:"auto",useModel:I,knowledgeSource:k,isIncognito:e.data.isIncognito,useNewMemory:M,useMemorySuggestion:D},botUid:a.id},taskInfo:{taskId:c,conversationId:d,abortController:new AbortController,usageModules:U},onData:t=>{if(t.task){null==l||l(t.task);return}let i=t.partialStart;if(i){z++;let e=u.itemId;this.addChatItem(u),u.itemId="".concat(h,"-").concat(z),u.data.content="",u.data.agentStatus=[],u.summary="",u.parentItemId=e}u.data.agentStatus&&(u.data.agentStatus=this.mergeAgentStatus(u.data.agentStatus));let o=t.finished||!!t.error;if(this.updateReplyData(u,t),t.error&&(u.data.type="error",u.summary=t.error,u.data.content=t.error),n(u,o,t.error,i),o){var r;B=!0,y.aS.updateBotLastMsgTime((null===(r=e.data.atBotInfo)||void 0===r?void 0:r.uid)||a.id),_.debug("reply finished successfully",u),this.addChatItem(u).then(()=>{t.error||this.markItemsAsSynced(F)})}},onAbort:()=>{!B&&u.data.content.trim()&&this.addChatItem(u)}}).catch(p);let{source:V,...q}=s||{};C.M.createUserBehaviorEvent({eventName:"send_msg",source:V,extData:{...q,botId:a.id,atBotId:null===(g=e.data.atBotInfo)||void 0===g?void 0:g.uid}})}catch(e){p(e)}return{taskId:c,reply:u}}async markItemsAsSynced(e){if(e.length>0){let t=e[0].conversationId;if(t){let a=await this.conversations.get(t);a&&(null==a||a.items.forEach(t=>{e.find(e=>e.itemId===t.itemId)&&(t.synced=!0)}),await this.conversations.set(t,a),this.context.services.monica.chatItemsSynced(e.map(e=>e.itemId)))}}}async getNewItemsForSync(e){let t=await this.getConversation(e,"cacheFirst");return{conv:t,itemsToSync:t.items.filter(e=>!e.synced)}}async createIntentCandidate(e){let t=e.conversationInfo.id,a="intent:".concat(r.m.genId()),n={itemId:a,itemType:"intent",conversationId:t,summary:e.content,parentItemId:e.parentItemId,data:{type:e.type,content:e.content,replies:[this.createReply(t,w.S.Global.services.monicaService.selectionIntentGuide,a)]}};return n.data.replies.forEach(e=>e.data.intentId=a),n}async deleteConversation(e){this.findAndCancelTasks(t=>t.conversationId===e),await this.conversations.delete(e)}async shareConversation(e){return l.Cb.taskApi.shareConversation(e)}async createConversationTitle(e,t){let a=this.genTaskId(),n="";return this.createGenerationTask({language:"auto",taskData:{taskType:"gen_title",data:{conversationId:e,regenerate:!1},locale:"auto",language:"auto"},path:"/custom_bot/gen_conversation_title",taskInfo:{taskId:a,conversationId:e,abortController:new AbortController,usageModules:[]},onData:async a=>{if(n+=a.text||"",a.finished){let a=await this.conversations.get(e);a&&(a.title=n,await this.conversations.set(e,{...a}),null==t||t(a))}},onAbort:()=>{}}).catch(e=>{_.error(e)}),{taskId:a}}async syncMessagesToServer(e){let{conversationId:t,origin:a,originPageTitle:n}=e,{conv:i,itemsToSync:o}=await this.getNewItemsForSync(t);return o.length?(await l.Cb.taskApi.syncChatItems({conversationId:t,items:o,origin:a,originPageTitle:n,botUid:e.botUid}),await this.markItemsAsSynced(o),i.title||this.createConversationTitle(t,()=>{this.services.botFramework.refreshConversationList()}),o):[]}async genNewConversationTitle(e,t,a){let n=this.genTaskId(),i="";return this.createGenerationTask({language:"auto",taskData:{taskType:"gen_title",data:{conversationId:e,regenerate:!0},locale:"auto",language:"auto"},path:"/custom_bot/regen_conv_title",taskInfo:{taskId:n,conversationId:e,abortController:new AbortController,usageModules:[]},onData:async e=>{if(i+=e.text||"",e.finished){t(i);return}if(e.error){a(e.error);return}},onAbort:()=>{}}).catch(e=>{_.error(e),a(e.message)}),{taskId:n}}async updateConversionChatItems(e,t){await this.loadConversation();let a=await this.conversations.get(e);if(!a){await this.conversations.set(e,{items:t,id:e});return}await this.conversations.set(e,{...a,items:t})}async checkCreateConversation(e){await this.loadConversation(),await this.conversations.get(e.id)||await this.conversations.set(e.id,e)}async getConversationFromCache(e){return await this.loadConversation(),await this.conversations.get(e)}async fetchConversation(e){var t,a,n,i;let o=await l.Cb.botFrameworkService.customBotApi.getChatItemListV2({limit:40,...e});null===(a=o.data.chatItemList)||void 0===a||null===(t=a.itemList)||void 0===t||t.forEach(e=>{e.data||(e.data={})});let r=((null===(n=o.data.chatItemList)||void 0===n?void 0:n.itemList)||[]).flatMap(e=>e.conversationId&&e.itemId&&e.itemType&&e.data?[{itemId:e.itemId,conversationId:e.conversationId,itemType:e.itemType,summary:e.summary||"",data:e.data,parentItemId:e.parentItemId,synced:!0,seq:e.seq}]:[]).sort((e,t)=>(e.seq||0)-(t.seq||0)),s=e=>{if(void 0!==e)return new Date(e).getTime()},c=o.data.conversation;if(!c.conversationId)throw k.Eg.conversationNotFound;let d={id:c.conversationId,items:r,title:c.title,chatBotName:c.chatBotName,chatBotUid:c.chatBotUid,createdAt:s(c.createdAt),updatedAt:s(c.updatedAt),origin:c.origin,originPageTitle:c.originPageTitle,lastMessage:c.lastMessage,lastMessageTime:s(c.lastMessageTime),isFavorite:c.isFavorite};void 0===e.seq&&await this.conversations.set(d.id,d);let u=null===(i=r[0])||void 0===i?void 0:i.seq;return{conversation:d,hasMore:1!==u,nextSeq:u}}createQuestion(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"text",i=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0;return{conversationId:e,itemId:"msg:".concat(r.m.genId()),itemType:"question",summary:t,parentItemId:a,data:{type:n,content:t,quoteContent:i,fromBotTask:o,chatModel:s}}}createReply(e,t,a,n){return{itemId:"msg:".concat(r.m.genId()),conversationId:e,itemType:"reply",summary:t,data:{type:"text",content:t,questionId:null,renderInStreaming:n},parentItemId:a}}createErrorReply(e,t){let a=(0,T.Z)(e);return a.data.type="error",a.summary=t,a.data.content=t,a}async loadConversation(){await this.readySource.waitReady()}async updateChatItem(e){let t=JSON.parse(JSON.stringify(e)),a=t.conversationId;await this.loadConversation();let n=await this.conversations.get(a);if(n){let e=n.items.findIndex(e=>e.itemId===t.itemId);e>-1?n.items[e]=t:n.items.push(t),await this.conversations.set(a,n)}}updateReplyData(e,t){var a;let n=e.data.content||"";t.textBackspace&&(n=n.slice(0,-t.textBackspace)),e.data.content=n+(t.text||""),e.summary=e.data.content,t.agentStatus&&(e.data.agentStatus?e.data.agentStatus.push(t.agentStatus):e.data.agentStatus=[t.agentStatus]),t.sources&&(e.data.sources=t.sources),t.suggestionLoading&&(e.data.suggestionLoading=!0),(null===(a=t.suggestions)||void 0===a?void 0:a.length)&&(e.data.suggestions=this.normalizeSuggestions(t.suggestions),e.data.suggestionLoading&&delete e.data.suggestionLoading),t.extraFlags&&(e.data.extraFlags={...t.extraFlags})}async addChatItem(e){let t=JSON.parse(JSON.stringify(e)),a=t.conversationId,n=await this.getConversation(a,"cacheFirst"),i=n.items.findIndex(e=>e.itemId===t.itemId);i>-1?n.items[i]=t:n.items.push(t),await this.updateConversionChatItems(a,n.items)}normalizeSuggestions(e){return e.map(e=>"string"==typeof e?{text:e}:e)}getLastItemId(e){var t;return null===(t=e.items[e.items.length-1])||void 0===t?void 0:t.itemId}async getConversation(e,t){let a=await this.getConversationFromCache(e);if(a)return"cacheWithUpdate"===t&&this.fetchConversation({conversationId:e}),a;try{return(await this.fetchConversation({conversationId:e})).conversation}catch(e){throw _.error(e),k.Eg.conversationNotFound}}mergeAgentStatus(e){let t=[];for(let c=0;c<e.length;c++){let d=e[c];if(d.uid){let e=t.findIndex(e=>e.uid===d.uid);if(e>-1){let c=(0,x.ZN)(t.find(e=>e.uid===d.uid));if(c&&"thinking_detail_stream"===c.type){var a,n,i,o,r,s,l;c.metadata||(c.metadata={}),(null===(a=d.metadata)||void 0===a?void 0:a.title)&&(c.metadata.title=(c.metadata.title||"")+d.metadata.title),(null===(n=d.metadata)||void 0===n?void 0:n.description)&&(c.metadata.description=(c.metadata.description||"")+(null===(r=d.metadata)||void 0===r?void 0:r.description)),(null===(i=d.metadata)||void 0===i?void 0:i.reasoningDetail)&&(c.metadata.reasoningDetail=(c.metadata.reasoningDetail||"")+(null===(s=d.metadata)||void 0===s?void 0:s.reasoningDetail)),(null===(o=d.metadata)||void 0===o?void 0:o.reasoningReflection)&&(c.metadata.reasoningReflection=(c.metadata.reasoningReflection||"")+(null===(l=d.metadata)||void 0===l?void 0:l.reasoningReflection)),t[e]=c}else t[e]=d}else t.push(d)}else t.push(d)}return t}mergeChatItemsToSync(e,t){let a=[...e];for(let e=0;e<t.length;e++){let n=t[e],i=a.findIndex(e=>e.itemId===n.itemId);-1===i?a.push(n):a[i]=n}return a}constructor(...e){super(...e),(0,i._)(this,"conversations",void 0),(0,i._)(this,"readySource",r.m.createReadySource())}}class M extends p.Z{async init(){}async onTabUnload(e){this.findAndCancelTasks(t=>t.tabId===e)}async compose(e,t,a){let n=this.genTaskId(),i="";return this.createGenerationTask({language:t.language.key,taskData:{taskType:"compose",data:{command:t.command,tone:t.tone.key,format:t.format.key,length:t.length.key,useModel:t.useModel||b.Q7}},taskInfo:{taskId:n,tabId:e,abortController:new AbortController,usageModules:["gpt-4o"===t.useModel?"genius_bot":"basic_query"]},onData:e=>{let{text:t,finished:n,error:o}=e;t&&(i+=t),a({text:t,fullText:i},n,o)},onAbort:()=>{console.log("generation aborted")}}).catch(e=>{console.error(e),a(null,!0,"".concat(e))}),{taskId:n}}async composeReply(e,t,a){let n=this.genTaskId(),i="";return this.createGenerationTask({language:t.language.key,taskData:{taskType:"compose_for_reply",data:{command:t.command,tone:t.tone.key,format:t.format.key,length:t.length.key,context:t.context,useModel:t.useModel||b.Q7}},taskInfo:{taskId:n,tabId:e,abortController:new AbortController,usageModules:[t.useModel===b.f2?"genius_bot":"basic_query"]},onData:e=>{let{text:t,finished:n,error:o}=e;t&&(i+=t),a({text:t,fullText:i},n,o)},onAbort:()=>{console.log("generation aborted")}}).catch(e=>{console.error(e),a(null,!0,"".concat(e))}),{taskId:n}}composeWithTemplate(e,t,a){let n=this.genTaskId();return this.createGenerationTask({language:"auto",taskData:{taskType:"compose_with_template",data:{count:1,...t}},taskInfo:{taskId:n,tabId:e,abortController:new AbortController,usageModules:[t.useModel===b.f2?"genius_bot":"basic_query"]},onData:e=>{let{text:t,finished:n,error:i}=e;a(t,n,i)},onAbort:()=>{console.log("generation aborted")}}).catch(e=>{console.error(e),a(null,!0,"".concat(e))}),{taskId:n}}}let D=e=>e&&["gpt-4o","llama3-70b","claude-3.7-sonnet"].includes(e);class A extends p.Z{doSummary(e,t){let a=this.genTaskId(),n="",i="",o="# A_KEY:\n",r="# R_KEY:",s=[],l=e.language||"auto",{aiRespLanguage:c,pageContent:d,useModel:u}=e;return this.createGenerationTask({path:"/github_summary/generate",language:l,aiRespLanguage:c,taskData:{taskType:"github_summary",data:{pageContent:d,useModel:u}},taskInfo:{taskId:a,abortController:new AbortController,usageModules:[D(u)?"genius_bot":"basic_query"]},onData:e=>{let{text:a,finished:l,error:c}=e;if(a&&(n+=a,i=n),n.includes(r)){let e=n.lastIndexOf(r);i=i.slice(0,e),s=n.slice(e+r.length).split("\n").map(e=>{let t=e.trim();return t.startsWith("- ")?t.slice(2):t}).filter(e=>!!e&&!e.startsWith("===="))}0===o.indexOf(i.slice(0,o.length))&&(i=i.slice(o.length)),t({replyText:i,suggestions:s},l,c)},onAbort:()=>{console.log("generation aborted")}}).catch(e=>{console.error(e),t(null,!0,"".concat(e))}),{taskId:a}}async init(){}}class N extends p.Z{async init(){}fixGrammar(e,t,a){let n=this.genTaskId(),i="",o="".concat(this.pathPrefix,"/fix_grammar");return this.createGenerationTask({language:t.composeLanguage,path:o,taskData:{taskUid:n,taskType:"writing:fix_grammar",data:t},taskInfo:{taskId:n,tabId:e,abortController:new AbortController,usageModules:[t.useModel===b.f2?"genius_bot":"basic_query"]},onData:e=>{let{text:t,finished:n,error:o}=e;a(i+=t,n,o)},onAbort:()=>{console.log("writing aborted")}}).catch(e=>{console.error(e),a(null,!0,"".concat(e))}),{taskId:n}}async onTabUnload(e){this.findAndCancelTasks(t=>t.tabId===e)}constructor(...e){super(...e),(0,i._)(this,"pathPrefix","/writing")}}let E={"6.7.0":async e=>{let t=e.getStorage();t.delete("tabConversationMap"),t.delete("tabActiveConversationMap"),t.delete("conversations")}};class j extends p.Z{doSummary(e,t){let a=this.genTaskId(),n="",i=e.language||"auto";return this.createGenerationTask({path:"/custom_bot/gen_mind_map",language:i,aiRespLanguage:i,taskData:{taskType:"gen_mind_map",data:{content:e.content,type:e.type,fileUid:e.fileUid,nodeTexts:e.nodeTexts,subtitle:e.subtitle}},taskInfo:{taskId:a,abortController:new AbortController,usageModules:["basic_query","genius_bot","mindmap"]},onData:e=>{let{text:a,finished:i,error:o}=e;a&&(n+=a),t({fullText:n},i,o)},onAbort:()=>{console.log("generation aborted")}}).catch(e=>{console.error(e),t(null,!0,"".concat(e))}),{taskId:a}}async init(){}}class B extends p.Z{async init(){}doTranslate(e,t,a,n,i){let o=this.genTaskId(),r=[n.enableGpt4?"genius_bot":"basic_query"],s="";return this.createGenerationTask({language:a.targetLanguage,taskData:{taskUid:o,taskType:t,data:a},taskInfo:{taskId:o,tabId:e,abortController:new AbortController,usageModules:r},onData:e=>{let{text:t,finished:a,error:n}=e;i(s+=t,a,n)},onAbort:()=>{console.log("translating aborted")}}).catch(e=>{console.error(e),i(null,!0,"".concat(e))}),{taskId:o}}async doTranslateImage(e,t){return l.Cb.generateService.imageToolsApi.translate(t)}async getTranslateImageTaskStatus(e){return l.Cb.imageToolsApi.loopResult({imageToolsId:e},{ignoreGlobalErrorHandler:!0})}async onTabUnload(e){this.findAndCancelTasks(t=>t.tabId===e)}}var R=a(90180),F=a(10043);class U extends p.Z{async init(){}async triggerSelectionQuickAction(e,t,a){let n=this.genTaskId(),i="",o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,F._z)(e)?"/quick_action/translate":(0,F.Go)(e)?"/quick_action/explain":(0,F.as)(e)?"/quick_action/common":""}(t.systemKey),r={taskType:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,F._z)(e)?"quick_action:translate":(0,F.Go)(e)?"quick_action:explain":"quick_action"}(t.systemKey),data:{systemKey:t.systemKey,actionType:"selection",actionPrompt:t.promptContent,actionLang:t.actionLang,reference:t.selectedText,useModel:t.useModel,actionInput:t.selectedText,fullContext:t.fullContext}};return"quick_action:translate"===r.taskType&&(r.data.enableGlossary=R.A.translationGlossaryEnabled),this.createGenerationTask({language:t.language.key,path:o,taskData:r,taskInfo:{taskId:n,tabId:e,abortController:new AbortController,usageModules:"gpt-4o"===t.useModel?["genius_bot"]:["basic_query"]},onData:e=>{let{text:t,finished:n,error:o}=e;t&&(i+=t),a({text:t,fullText:i},n,o)},onAbort:()=>{console.log("quick action aborted")}}).catch(e=>{console.error(e),a(null,!0,"".concat(e))}),{taskId:n}}async onTabUnload(e){this.findAndCancelTasks(t=>t.tabId===e)}async instantOpen(e){return await l.Cb.botFrameworkService.quickActionApi.instantOpen(e)}async triggerQuickAskActions(e,t,a){let n=this.genTaskId(),i="";return this.createGenerationTask({language:"auto",path:"/quick_action/ask_ai",taskData:{data:t,taskType:"quick_action:ask_ai"},taskInfo:{taskId:n,tabId:e,abortController:new AbortController,usageModules:"gpt-4o"===t.useModel?["genius_bot"]:["basic_query"]},onData:e=>{let{text:t,finished:n,error:o,agentStatus:r}=e;t&&(i+=t),a({text:t,fullText:i,agentStatus:r},n,o)},onAbort:()=>{a(null,!0,"quick action aborted"),console.log("quick action aborted")}}).catch(e=>{console.error(e),a(null,!0,"".concat(e))}),{taskId:n}}}class z extends p.Z{async init(){}genReading(e,t,a){let n=this.genTaskId(),i="",o=new AbortController;return this.createGenerationTask({path:"/reading/gen_reading",language:t.language,aiRespLanguage:t.aiRespLanguage,taskData:{taskType:t.taskType,data:{...t}},taskInfo:{taskId:n,tabId:e,abortController:o,usageModules:"gpt-4"===t.useModel?["genius_bot"]:["basic_query"],...t},onData:e=>{if(e.error){a(null,!0,r.m.formatErrorMsg(e.error));return}let{text:t,finished:n,sources:o,suggestions:s,suggestionLoading:l}=e;e.textBackspace?i=i.slice(0,-(e.textBackspace+2)):t&&(i+=t),a({text:t,fullText:i,sources:o,suggestions:s,suggestionLoading:l},n)},onAbort:()=>{}}).catch(e=>{a(null,!0,r.m.formatErrorMsg(e))}),{taskId:n}}}class O extends p.Z{async init(){}triggerScreenRecognition(e,t,a){let n=this.genTaskId(),i="";return this.createGenerationTask({language:t.language,taskData:{taskType:"screenshot:qa",data:t.data},taskInfo:{taskId:n,tabId:e,abortController:new AbortController,usageModules:["screenshot_qa"]},onData:e=>{let{text:t,finished:n,error:o}=e;t&&(i+=t),a({text:t,fullText:i},n,o)},onAbort:()=>{console.log("screen recognition aborted")},path:"/generate/create_screenshot_task"}).catch(e=>{console.error(e),a(null,!0,"".concat(e))}),{taskId:n}}async onTabUnload(e){this.findAndCancelTasks(t=>t.tabId===e)}}class V extends p.Z{async init(){}async sendQuestion(e,t){var a;let n=this.genTaskId(),i=new AbortController,o=["gpt-4o","llama3-70b","claude-3.7-sonnet"].includes(null!==(a=e.useModel)&&void 0!==a?a:"")?"genius_bot":"basic_query",r="";return this.createGenerationTask({taskInfo:{taskId:n,abortController:i,usageModules:[o]},language:e.language,taskData:{taskType:e.taskType,data:{keyword:e.keyword,items:e.items,isManual:e.isManual,isRetry:e.isRetry,useModel:e.useModel}},onData:e=>{let{text:a,finished:n,error:i}=e;t(r+=a,n,i)},onAbort:()=>{console.log("generation aborted")},path:"/generate/gen_search_enhance"}).catch(e=>{t(null,!0,"".concat(e))}),{taskId:n}}}class q extends p.Z{async init(){}gen(e){var t;let{onData:a,taskData:n,tabId:i,taskType:o}=e,r=this.genTaskId(),s="",l=(null===(t=n.config)||void 0===t?void 0:t.composeLanguage)||"auto";return Array.isArray(n.config.tone)&&(n.config.tone=n.config.tone[0]),this.createGenerationTask({language:l,path:"/site_integration/generate",taskData:{taskUid:r,taskType:o,data:n},taskInfo:{taskId:r,tabId:i,abortController:new AbortController,usageModules:["genius_bot","basic_query"]},onData:e=>{let{text:t,finished:n,error:i}=e;a(s+=t,n,i)},onAbort:()=>{console.log("writing aborted")}}).catch(e=>{console.error(e),a(null,!0,"".concat(e))}),{taskId:r}}async onTabUnload(e){this.findAndCancelTasks(t=>t.tabId===e)}}class W extends p.Z{async init(){}doSummary(e,t,a){let n=this.genTaskId(),i="",o="".concat(this.pathPrefix,"/generate");return this.createGenerationTask({language:t.language,path:o,taskData:{taskType:t.taskType,data:t,taskUid:n},taskInfo:{taskId:n,tabId:e,abortController:new AbortController,usageModules:["youtube_summarize"]},onData:e=>{let{text:t,finished:n,error:o}=e;a(i+=t,n,o)},onAbort:()=>{console.log("quick action aborted")}}).catch(e=>{console.error(e),a(null,!0,r.m.formatMonicaSdkError(e))}),{taskId:n}}doSummaryWithoutSubtitle(e,t,a){let n=this.genTaskId(),i={taskId:n,tabId:e,abortController:new AbortController,usageModules:["youtube_summarize"]};return this.tasks[i.taskId]={...i},l.Cb.youtubeSummarizeApi.generateWithoutSubtitle({language:t.language,taskType:t.taskType,taskUid:n,data:t,locale:w.a.locale},{abortSignal:i.abortController.signal}).then(e=>{let{data:t}=e;a(t||null,!0)}).catch(e=>{console.error(e),a(null,!0,r.m.formatMonicaSdkError(e))}),{taskId:n}}async loopSegmentationResult(e){return l.Cb.generateService.youtubeSummarizeApi.loopSegmentationResult(e)}async onTabUnload(e){this.findAndCancelTasks(t=>t.tabId===e)}async cancelSummaryWithoutSubtitleTask(e){let t=this.tasks[e];console.debug("cancel task",t),t&&await this.makeTaskFinished(t)}async makeTaskFinished(e){e.abortController.abort(),delete this.tasks[e.taskId]}constructor(...e){super(...e),(0,i._)(this,"pathPrefix","/youtube_summarize"),(0,i._)(this,"tasks",{})}}class G extends p.Z{async init(){}doWriting(e,t,a,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"/generate",o=this.genTaskId(),r="",s=[];"writing:improve_text"===t?a.useModel===b.f2?s.push("genius_bot"):s.push("basic_query"):a.config.useModel===b.f2?s.push("genius_bot"):s.push("basic_query");let l="auto";return a.config&&(l=a.config.composeLanguage),this.createGenerationTask({language:l,path:"".concat(this.pathPrefix).concat(i),taskData:{taskUid:o,taskType:t,data:a},taskInfo:{taskId:o,tabId:e,abortController:new AbortController,usageModules:s},onData:e=>{let{text:t,finished:a,error:i}=e;n(r+=t,a,i)},onAbort:()=>{console.log("writing aborted")}}).catch(e=>{console.error(e),n(null,!0,"".concat(e))}),{taskId:o}}async onTabUnload(e){this.findAndCancelTasks(t=>t.tabId===e)}constructor(...e){super(...e),(0,i._)(this,"pathPrefix","/writing")}}class Q extends p.Z{async init(){}async onTabUnload(e){this.findAndCancelTasks(t=>t.tabId===e)}async generate(e,t){let a;return a=e.taskId?e.taskId:this.genTaskId(),this.createGenerationTask({language:"auto",path:"/profession_ability/translate_v2",taskData:{taskType:"apps:translate_use_task",data:e},taskInfo:{taskId:a,abortController:new AbortController,usageModules:["basic_query"]},onData:e=>{t({text:e.text,finished:e.finished,error:e.error||"",index:"number"==typeof e.index?e.index:-1})},onAbort:()=>{console.log("generation aborted")}}).catch(e=>{console.error(e),t({text:"",error:r.m.formatMonicaSdkError(e),finished:!0,index:-1})}),{taskId:a}}}class J extends p.Z{async init(){}async bypass(e){let{onData:t,taskData:a,taskType:n}=e,i=this.genTaskId(),o="";return this.createGenerationTask({path:"/ai_content_detect/bypassv2",taskData:{taskUid:i,taskType:n,data:a},taskInfo:{taskId:i,abortController:new AbortController,usageModules:["bypass","credits"]},onData:e=>{let{text:a,finished:n,error:i}=e;t(o+=a,n,i)},onAbort:()=>{t(o,!0,"aborted")},language:"auto"}).catch(e=>{t(null,!0,r.m.formatErrorMsg(e))}),{taskId:i}}}var K=a(51018),H=a(74024);class Z extends p.Z{async init(){}async generate(e,t){let a=this.genTaskId(),n="",i="".concat(this.pathPrefix,"/summary"),o="";return this.createGenerationTask({language:e.language,path:i,taskData:{taskType:"audio_summary",data:{uid:e.uid,stream:!0}},taskInfo:{taskId:a,abortController:new AbortController,usageModules:["basic_query"]},onData:e=>{let{text:a,finished:i,error:s}=e;a&&(n+=a);try{let e=r.m.camelize(K.c.parsePartialJson(n));JSON.stringify(e).length>o.length&&t((0,H.Z)({keywords:[],reviews:[],summary:""},e),i,s),o=JSON.stringify(e)}catch(e){}},onAbort:()=>{console.log("generation aborted")}}).catch(e=>{console.error(e),t(null,!0,"".concat(e))}),{taskId:a}}constructor(...e){super(...e),(0,i._)(this,"pathPrefix","/audio_tool")}}class Y extends c.b{async onInit(){this.context={apiHost:l.Xo,storage:this.storage,parent:this,services:{...this.services,monica:this}},this.chatProvider=new L(this.context),this.actionProvider=new m(this.context),this.composeProvider=new M(this.context),this.quickActionProvider=new U(this.context),this.searchEnhanceProvider=new V(this.context),this.videoSummaryProvider=new W(this.context),this.writingProvider=new G(this.context),this.monicaTranslateProvider=new B(this.context),this.appsProvider=new g(this.context),this.screenRecognitionProvider=new O(this.context),this.grammarProvider=new N(this.context),this.readingProvider=new z(this.context),this.gitHubSummaryProvider=new A(this.context),this.siteIntegrationProvider=new q(this.context),this.mindMapProvider=new j(this.context),this.translateProvider=new Q(this.context),this.aiContentDetectProvider=new J(this.context),this.audioProvider=new Z(this.context),this.storage.addChangeListener(e=>{void 0!==e.templateList&&this.emit("templateListChange",{templateList:e.templateList}),void 0!==e.chatTemplateData&&this.emit("chatTemplateDataChange",{chatTemplateData:e.chatTemplateData})}),(0,d.uJ)(e=>{let{tabs:t}=e;t.onRemoved.addListener(async e=>{this.chatProvider.onTabUnload(e),this.composeProvider.onTabUnload(e),this.monicaTranslateProvider.onTabUnload(e)})}),this.services.user.on("userLogout",async()=>{let e=await this.storage.get("conversationIds");await Promise.all([...e.map(e=>this.storage.delete(e)),this.storage.delete("conversationIds")])})}async onContentAppCreated(){var e;if(null===(e=this.lastCaller)||void 0===e?void 0:e.tabId){let{tabId:e}=this.lastCaller;this.chatProvider.onTabUnload(e),this.composeProvider.onTabUnload(e),this.monicaTranslateProvider.onTabUnload(e),e&&this.autoTriggerTabId===e&&(console.log("auto trigger for tab",e),this.autoTriggerTabId=null,h.Y.sendMessage({tabId:e,name:"runMonica",data:{}}))}}async refreshTabAndOpenMonica(e){(0,d.uJ)(t=>{let{tabs:a}=t;this.autoTriggerTabId=e,a.reload(e)})}async deleteConversation(e){return this.chatProvider.deleteConversation(e)}async createConversation(e){return this.chatProvider.createConversation(e)}async retryQuestion(e,t,a){return this.chatProvider.retryQuestion(e,t,a)}async askQuestion(e,t,a,n){var i;let o=(null===(i=e.atBotInfo)||void 0===i?void 0:i.uid)||e.botInfo.id;return this.services.bot.updateBotLastMsgTime(o),this.chatProvider.askQuestion(e,t,a,n)}async createConversationTitle(e,t){return this.chatProvider.createConversationTitle(e,e=>{null==t||t(e)})}async genNewConversationTitle(e,t,a){return this.chatProvider.genNewConversationTitle(e,t,a)}async triggerSelectionQuickAction(e,t){var a;return this.quickActionProvider.triggerSelectionQuickAction(null===(a=this.lastCaller)||void 0===a?void 0:a.tabId,e,t)}async triggerQuickAskActions(e,t){var a;return this.quickActionProvider.triggerQuickAskActions(null===(a=this.lastCaller)||void 0===a?void 0:a.tabId,e,t)}async quickAskInstantOpen(e){return this.quickActionProvider.instantOpen(e)}async runSaveMemoAction(e){return this.chatProvider.runSaveMemoAction(e)}async afterSaveMemoAction(e){return this.chatProvider.afterSaveMemoAction(e)}async continueQuickActionInChat(e){return this.chatProvider.continueQuickActionInChat(e)}async continueScreenRecognitionInChat(e){return this.chatProvider.continueScreenRecognitionInChat(e)}async continueSearchEnhanceInChat(e){return this.chatProvider.continueSearchEnhanceInChat(e)}async continueVideoSummaryInChat(e){return this.chatProvider.continueVideoSummaryInChat(e)}async continueReadingInChat(e){return this.chatProvider.continueReadingInChat(e)}async quickAskContinueInChat(e){return this.chatProvider.quickAskContinueInChat(e)}async realtimeContinueInChat(e){return this.chatProvider.realtimeContinueInChat(e)}async commonContinueInChat(e){return this.chatProvider.commonContinueInChat(e)}async cancelTask(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"chat";return"githubSummary"===t?this.gitHubSummaryProvider.cancelTask(e):"mindMap"===t?this.mindMapProvider.cancelTask(e):"quickAction"===t?this.quickActionProvider.cancelTask(e):"compose"===t?this.composeProvider.cancelTask(e):"youtubeSummary"===t?this.videoSummaryProvider.cancelTask(e):"writing"===t?this.writingProvider.cancelTask(e):"monicaTranslate"===t?this.monicaTranslateProvider.cancelTask(e):"screenRecognition"===t?this.screenRecognitionProvider.cancelTask(e):"grammar"===t?this.grammarProvider.cancelTask(e):"reading"===t?this.readingProvider.cancelTask(e):"dynamicAction"===t?this.actionProvider.cancelTask(e):"aiContentDetect"===t?this.aiContentDetectProvider.cancelTask(e):"siteIntegration"===t?this.siteIntegrationProvider.cancelTask(e):this.chatProvider.cancelTask(e)}async doVideoSummary(e,t){var a;return this.videoSummaryProvider.doSummary(null===(a=this.lastCaller)||void 0===a?void 0:a.tabId,e,t)}async doVideoSummaryWithoutSubtitle(e,t){var a;return this.videoSummaryProvider.doSummaryWithoutSubtitle(null===(a=this.lastCaller)||void 0===a?void 0:a.tabId,e,t)}async doWriting(e,t,a,n){var i;return this.writingProvider.doWriting(null===(i=this.lastCaller)||void 0===i?void 0:i.tabId,e,t,a,n)}async doSiteIntegrationWriting(e,t,a,n){return this.siteIntegrationProvider.gen({onData:a,taskData:t,taskType:e,tabId:n})}async doTranslate(e,t,a,n){var i;return this.monicaTranslateProvider.doTranslate(null===(i=this.lastCaller)||void 0===i?void 0:i.tabId,e,t,a,n)}async doTranslateImage(e){var t;return this.monicaTranslateProvider.doTranslateImage(null===(t=this.lastCaller)||void 0===t?void 0:t.tabId,e)}async getTranslateImageStatus(e){return this.monicaTranslateProvider.getTranslateImageTaskStatus(e)}async createIntentCandidate(e){return this.chatProvider.createIntentCandidate(e)}async shareConversation(e){return this.chatProvider.shareConversation(e)}async createShare(e){return l.Cb.generateService.chatShareApi.createShare(e)}async getShare(e){return l.Cb.generateService.chatShareApi.getShare(e)}async updateShare(e){return l.Cb.generateService.chatShareApi.updateShare(e)}async compose(e,t){var a;return this.composeProvider.compose(null===(a=this.lastCaller)||void 0===a?void 0:a.tabId,e,t)}async composeReply(e,t){var a;return this.composeProvider.composeReply(null===(a=this.lastCaller)||void 0===a?void 0:a.tabId,e,t)}async composeWithTemplate(e,t){var a;return this.composeProvider.composeWithTemplate(null===(a=this.lastCaller)||void 0===a?void 0:a.tabId,e,t)}async fixGrammar(e,t){var a;return this.grammarProvider.fixGrammar(null===(a=this.lastCaller)||void 0===a?void 0:a.tabId,e,t)}async getComposeTemplates(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return this._fetchWithCache("templateList",async()=>(await l.Cb.taskApi.getTemplateList()).templateList,{useCache:e})}async fetchPdfConversationList(e,t){return this.chatProvider.fetchPdfConversationList(e,t)}async getConversationInfo(e){return await l.Cb.taskApi.getConversationInfo({conversationId:e})}async searchConversation(e){return await l.Cb.taskApi.searchConversation(e)}async removeConversationHistory(e){return await this.chatProvider.removeConversationHistory(e)}async updateConversationTitle(e,t,a){return await this.chatProvider.updateConversationTitle(e,t,a)}async updateChatItems(e,t){return this.chatProvider.updateConversionChatItems(e,t)}async collectConversation(e){return await l.Cb.taskApi.collectConversation(e)}async clearConversationList(e){return await this.chatProvider.clearConversationList(e)}async deleteConversationList(e){return await l.Cb.taskApi.deleteConversationList(e)}async askSearchEnhanceQuestion(e,t){return this.searchEnhanceProvider.sendQuestion(e,t)}async cancelSearchEnhanceTask(e){return this.searchEnhanceProvider.cancelTask(e)}async runApp(e,t){var a;return this.appsProvider.generate(null===(a=this.lastCaller)||void 0===a?void 0:a.tabId,e,t)}async syncMessagesToServer(e){return this.chatProvider.syncMessagesToServer(e)}async loopSegmentationResult(e){return this.videoSummaryProvider.loopSegmentationResult(e)}cancelSummaryWithoutSubtitleTask(e){return this.videoSummaryProvider.cancelSummaryWithoutSubtitleTask(e)}async triggerScreenRecognition(e,t){var a;return this.screenRecognitionProvider.triggerScreenRecognition(null===(a=this.lastCaller)||void 0===a?void 0:a.tabId,e,t)}async contextMenuClick(e){let t={imageAnimator:"imageAnimator",removeBackground:"removeBackground",removeText:"removeText",removeBrushedArea:"removeBrushedArea",removeObject:"removeObject",changeBackground:"changeBackground",upscale:"upscale"},a=t[e.menuItemId];if(!t[a])return;let n=e.srcUrl;if(n&&o.o.isDesktop){let e=r.m.genUrl("".concat(r.m.getWebOrigin()).concat("imageAnimator"===a?s.oo.videoTool:s.oo.imageTool),{key:a,url:n});u.y.getService().openBrowserPage(e);return}}async createFile(e){let{taskId:t,...a}=e;return this.abortControllerMap[t]=new AbortController,l.Cb.botFrameworkService.filesApi.createFile(a,{abortSignal:this.abortControllerMap[t].signal})}cancelRequest(e){e in this.abortControllerMap&&(this.abortControllerMap[e].abort(),delete this.abortControllerMap[e])}async getFile(e){let{taskId:t,...a}=e;return this.abortControllerMap[t]=new AbortController,l.Cb.botFrameworkService.filesApi.getFile(a,{abortSignal:this.abortControllerMap[t].signal})}async deleteFile(e){return l.Cb.botFrameworkService.filesApi.deleteFile(e)}async genSummary(e,t){var a;return this.readingProvider.genReading(null===(a=this.lastCaller)||void 0===a?void 0:a.tabId,e,t)}async genCompare(e,t){var a;let n=(null===(a=e.atBotInfo)||void 0===a?void 0:a.uid)||e.botInfo.id;return this.services.bot.updateBotLastMsgTime(n),this.chatProvider.compareQuestion(e,t)}async getRelatedQuestion(e){var t;let a="".concat(this.context.apiHost,"/generate/follow_suggestion"),n=await l.Lx.request({url:a,method:"POST",headers:(0,l.D3)(),data:JSON.stringify(r.m.underlize(e))});return(null==n?void 0:null===(t=n.data)||void 0===t?void 0:t.data)||[]}async genGitHubSummary(e,t){return this.gitHubSummaryProvider.doSummary(e,t)}async genCustomAction(e,t){return this.actionProvider.generate(e,t)}async genTranslate(e,t){return this.translateProvider.generate(e,t)}async cancelGitHubSummaryTask(e){return this.gitHubSummaryProvider.cancelTask(e)}async genMindMap(e,t){return this.mindMapProvider.doSummary(e,t)}getStorage(){return this.storage}async _doMigrations(){try{await E["6.7.0"](this)}catch(e){console.error("migration error",e)}}async getChatTemplateList(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(this.templateFetching)return null;this.templateFetching=!0;let t=await this._fetchWithCache("chatTemplateData",async()=>(await l.Cb.botFrameworkService.chatTemplateApi.list({limit:1e6,offset:0})).data,{useCache:e});return this.templateFetching=!1,t}async editChatTemplate(e){let t=await this.storage.get("chatTemplateData");if(null==t?void 0:t.templates){let a=t.templates.findIndex(t=>t.uid===e.uid),n=Date.now();-1!==a?t.templates[a]={...t.templates[a],...e,updatedAt:n}:t.templates.push({...e,updatedAt:n,createdAt:n}),await this.storage.update({chatTemplateData:t})}return l.Cb.botFrameworkService.chatTemplateApi.edit(e)}async deleteChatTemplate(e){let t=await this.storage.get("chatTemplateData");if(null==t?void 0:t.templates){let a=t.templates.findIndex(t=>t.uid===e.uid);a>-1&&(t.templates.splice(a,1),this.storage.update({chatTemplateData:t}))}return l.Cb.botFrameworkService.chatTemplateApi.delete(e)}async batchCreateLLMFile(e){return l.Cb.botFrameworkService.filesApi.batchCreateLlmFile({data:e})}async batchGetFile(e){return l.Cb.botFrameworkService.filesApi.batchGetFile({fileUids:e})}async preCalcPdfToken(e){return l.Cb.taskApi.preCalPdfToken(e)}async downloadLocalPdf(e){let t=await (await fetch(e)).blob();return await r.m.blobToString(t)}async createPdf(e){return l.Cb.taskApi.chatpdfCreate(e)}async createMindMap(e){return l.Cb.generateService.mindMapManagerApi.create(e)}async fetchConversation(e){return await this.chatProvider.fetchConversation(e)}async getConversationFromCache(e){return this.chatProvider.getConversationFromCache(e)}async simplifyParagraph(e){return l.Cb.botFrameworkService.quickActionApi.simplify(e)}async generateHumanize(e,t){return this.aiContentDetectProvider.bypass({taskType:"ai_content_detect:detect",taskData:{content:e,stream:!0},onData:t})}async fetchMedia(e){let t=await (await fetch(e)).arrayBuffer();return btoa(new Uint8Array(t).reduce((e,t)=>e+String.fromCharCode(t),""))}async fetchS3JsonData(e){let t=await fetch(e);return await t.json()}async audioToTextGenSummary(e,t){return this.audioProvider.generate(e,t)}async chatItemsSynced(e){this.emit("chatItemsSynced",{ids:e})}constructor(...e){super(...e),(0,i._)(this,"meta",{key:"monica",name:"MonicaService",storagePrefix:"ai"}),(0,i._)(this,"dependencies",["user","bot","botFramework","config"]),(0,i._)(this,"defaultStorageValues",{templateList:[],chatTemplateData:null,conversationList:{},conversationIds:[]}),(0,i._)(this,"context",void 0),(0,i._)(this,"chatProvider",void 0),(0,i._)(this,"actionProvider",void 0),(0,i._)(this,"composeProvider",void 0),(0,i._)(this,"videoSummaryProvider",void 0),(0,i._)(this,"writingProvider",void 0),(0,i._)(this,"grammarProvider",void 0),(0,i._)(this,"quickActionProvider",void 0),(0,i._)(this,"searchEnhanceProvider",void 0),(0,i._)(this,"appsProvider",void 0),(0,i._)(this,"monicaTranslateProvider",void 0),(0,i._)(this,"screenRecognitionProvider",void 0),(0,i._)(this,"readingProvider",void 0),(0,i._)(this,"gitHubSummaryProvider",void 0),(0,i._)(this,"siteIntegrationProvider",void 0),(0,i._)(this,"mindMapProvider",void 0),(0,i._)(this,"translateProvider",void 0),(0,i._)(this,"aiContentDetectProvider",void 0),(0,i._)(this,"audioProvider",void 0),(0,i._)(this,"autoTriggerTabId",null),(0,i._)(this,"abortControllerMap",{}),(0,i._)(this,"templateFetching",!1)}}let X=new n.x(Y)},10043:function(e,t,a){a.d(t,{ED:function(){return d},Go:function(){return i},Pj:function(){return o},UX:function(){return r},_z:function(){return n},as:function(){return c},hz:function(){return s},uh:function(){return l}});let n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"selectionAction:Translate"===e||"translate"===e},i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"selectionAction:explain"===e},o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"selectionAction:Grammar"===e},r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"selectionAction:Rewrite"===e},s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"selectionAction:Expand"===e},l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"selectionAction:ExplainCodes"===e},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return["selectionAction:Summarize","selectionAction:Grammar","selectionAction:Rewrite","selectionAction:Expand"].includes(e)},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"humanize"===e}}}]);